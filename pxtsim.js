var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},pxsim;!function(t){!function(t){var e;t.makeFocusable=function(t){t.setAttribute("focusable","true"),t.setAttribute("tabindex","0")},t.enableKeyboardInteraction=function(t,e,n){e&&t.addEventListener("keydown",function(t){var n="number"==typeof t.which?t.which:t.keyCode;32!==n&&13!==n||e()}),n&&t.addEventListener("keyup",function(t){var e="number"==typeof t.which?t.which:t.keyCode;32!==e&&13!==e||n()})},t.setAria=function(t,e,n){e&&!t.hasAttribute("role")&&t.setAttribute("role",e),n&&!t.hasAttribute("aria-label")&&t.setAttribute("aria-label",n)},t.setLiveContent=function(t){e||((e=document.createElement("div")).setAttribute("role","status"),e.setAttribute("aria-live","polite"),e.setAttribute("aria-hidden","false"),e.setAttribute("style","position: absolute !important;display: block;visibility: visible;overflow: hidden;width: 1px;height: 1px;margin: -1px;border: 0;padding: 0;clip: rect(0 0 0 0);"),document.body.appendChild(e));e.textContent!==t&&(e.textContent=t)}}(t.accessibility||(t.accessibility={}))}(pxsim||(pxsim={}));var pxsim;!function(t){function e(t){var e=!1;if("string"!=typeof t&&"breadboard"===t.type){var n=t.row;e=0<=["a","b","c","d","e"].indexOf(n)}return e}function n(t){var n=[t.start,t.end],i=n.map(function(t){return"ground"===t}),r=n.map(function(t){return"threeVolt"===t}),o=n.map(function(t){return e(t)}),s=l(i),a=l(r),u=l(o);return{topGround:s&&!u,topThreeVolt:a&&!u,bottomGround:s&&u,bottomThreeVolt:a&&u,singleGround:s,singleThreeVolt:a}}function i(t){var e=t.reduce(function(t,e){return{topGround:t.topGround||e.topGround,topThreeVolt:t.topThreeVolt||e.topThreeVolt,bottomGround:t.bottomGround||e.bottomGround,bottomThreeVolt:t.bottomThreeVolt||e.bottomThreeVolt,singleGround:e.singleGround?null===t.singleGround:t.singleGround,singleThreeVolt:e.singleThreeVolt?null===t.singleThreeVolt:t.singleThreeVolt}},{topGround:!1,topThreeVolt:!1,bottomGround:!1,bottomThreeVolt:!1,singleGround:null,singleThreeVolt:null});return e.singleGround&&(e.topGround=e.bottomGround=!1),e.singleThreeVolt&&(e.topThreeVolt=e.bottomThreeVolt=!1),e}function r(t,e){var n={};for(var i in t)n[i]=t[i];for(var r in e)n[r]=e[r];return n}function o(t,e,n){return r(r(t,e),n)}function s(e){t.U.assert(!!e,"Invalid pin: "+e);var n=/^(\w+)\..*((P|A|D)\d+)$/.exec(e);return n?n[2]:void 0}function a(t){return"-Z"===t.orientation&&"male"===t.style}var u=function(t){return t.reduce(function(t,e){return t+(e?1:0)},0)},l=function(t){return u(t)>0};t.readPin=s;var c=function(){function e(e){this.availablePowerPins={top:{threeVolt:t.mkRange(26,51).map(function(t){return{type:"breadboard",row:"+",col:""+t}}),ground:t.mkRange(26,51).map(function(t){return{type:"breadboard",row:"-",col:""+t}})},bottom:{threeVolt:t.mkRange(1,26).map(function(t){return{type:"breadboard",row:"+",col:""+t}}),ground:t.mkRange(1,26).map(function(t){return{type:"breadboard",row:"-",col:""+t}})}},this.opts=e}return e.prototype.allocPartIRs=function(e,n,i){var r=this,o=[],a=function(e,n,r,o){for(var s=[],a=0;a<e.numberOfPins;a++){var u=e.pinDefinitions[a],l=void 0;if("string"==typeof u.target)l=u.target;else{var c=u.target.pinInstantiationIdx;t.U.assert(!!r&&void 0!==r[c],"No pin found for PinInstantiationIdx: "+c+'. (Is the part missing an ArguementRole or "trackArgs=" annotations?)'),l=r[c]}var p=e.visual.pinLocations[a],d=i.yOffset+p.y,h=Math.round(d/e.visual.pinDistance),f=d-h*e.visual.pinDistance,m=i.xOffset+p.x,v=Math.round(m/e.visual.pinDistance),g={partRelativeRowIdx:h,partRelativeColIdx:v,xOffset:m-v*e.visual.pinDistance,yOffset:f};s.push({def:u,loc:p,target:l,bbFit:g})}return{name:n,def:e,pins:s,partParams:o||{},bbFit:i}};if("singleton"===e.instantiation.kind)o.push(a(e,n));else if("function"===e.instantiation.kind){var u=e.instantiation,l=u.fullyQualifiedName.split(","),c={};l.forEach(function(t){r.opts.fnArgs[t]&&r.opts.fnArgs[t].forEach(function(t){c[t]=1})});var p=Object.keys(c);t.U.assert(!!p&&!!p.length,"Failed to read pin(s) from callsite for: "+l),p.forEach(function(i){var r=i.split(",");t.U.assert(r.length===u.argumentRoles.length,"Mismatch between number of arguments at callsite (function name: "+l+") vs number of argument roles in part definition (part: "+n+").");var c=[],p={};r.forEach(function(t,e){var n=u.argumentRoles[e];if(void 0!==n.partParameter&&(p[n.partParameter]=t),void 0!==n.pinInstantiationIdx){var i=n.pinInstantiationIdx,r=s(t);c[i]=r}}),o.push(a(e,n,c,p))})}return o},e.prototype.computePartDimensions=function(e,n){var i=e.visual.pinLocations,r=e.pinDefinitions,s=e.numberOfPins;t.U.assert(i.length===s,'Mismatch between "numberOfPins" and length of "visual.pinLocations" for "'+n+'"'),t.U.assert(r.length===s,'Mismatch between "numberOfPins" and length of "pinDefinitions" for "'+n+'"'),t.U.assert(s>0,'Part "'+n+'" has no pins');var a,u,l,c,p=i.map(function(t,e){return o({idx:e},t,r[e])}).filter(function(t){return"-Z"===t.orientation}),d=p.length>0,h=e.visual.pinDistance;if(d){var f=p[0],m=Math.ceil(f.x/h),v=Math.ceil(f.y/h);a=m*h-f.x,u=v*h-f.y,l=Math.ceil((a+e.visual.width)/h)+1,c=Math.ceil((u+e.visual.height)/h)+1}else l=Math.ceil(e.visual.width/h),c=Math.ceil(e.visual.height/h),a=l*h-e.visual.width,u=c*h-e.visual.height;return{xOffset:a,yOffset:u,rowCount:c,colCount:l}},e.prototype.allocColumns=function(e){var n=e.length,i=t.visuals.BREADBOARD_MID_COLS-e.map(function(t){return t.colCount}).reduce(function(t,e){return t+e},0);i<=0&&console.log("Not enough breadboard space!");var r=Math.floor(i/(n-1+2)),o=i-r*(n-1),s=Math.floor(o/2),a=(Math.ceil(o/2),1+s);return e.map(function(t){var e=a;return a+=t.colCount+r,e})},e.prototype.placeParts=function(e){var n=t.visuals.BREADBOARD_MID_ROWS+2,i=this.allocColumns(e.map(function(t){return t.bbFit})),o=e.map(function(t){var e=n-t.bbFit.rowCount,i=Math.floor(e/2);return i>4&&(i=4),i<1&&(i=1),i});return e.map(function(t,e){var n=o[e];return r({startColumnIdx:i[e],startRowIdx:n},t)})},e.prototype.nextColor=function(){return(!this.availableWireColors||this.availableWireColors.length<=0)&&(this.availableWireColors=t.visuals.GPIO_WIRE_COLORS.map(function(t){return t})),this.availableWireColors.pop()},e.prototype.allocWireIRs=function(e){var n=this,i=[],o=e.pins.map(function(r,o){var s,u=r.target,l=e.startColumnIdx+r.bbFit.partRelativeColIdx,c=t.visuals.getColumnName(l),p=e.startRowIdx+r.bbFit.partRelativeRowIdx;if(p>=7&&(p-=2),a(r.def))s={type:"breadboard",row:d=p<5?"j":"a",col:c,style:r.def.style};else{var d=t.visuals.getRowName(p);s={type:"breadboard",row:d,col:c,xOffset:r.bbFit.xOffset/e.def.visual.pinDistance,yOffset:r.bbFit.yOffset/e.def.visual.pinDistance,style:r.def.style}}var h;return h="ground"===u?"blue":"threeVolt"===u?"red":"number"==typeof r.def.colorGroup?i[r.def.colorGroup]?i[r.def.colorGroup]:i[r.def.colorGroup]=n.nextColor():n.nextColor(),{start:s,end:u,color:h,pinIdx:o}});return r(e,{wires:o})},e.prototype.allocLocation=function(e,n){var i=this;if("ground"===e||"threeVolt"===e){if("ground"===e&&this.powerUsage.singleGround)return{type:"dalboard",pin:this.getBoardGroundPin()};if("threeVolt"===e&&this.powerUsage.singleThreeVolt)return{type:"dalboard",pin:this.getBoardThreeVoltPin()};t.U.assert(!!n.referenceBBPin);var r=this.opts.getBBCoord(n.referenceBBPin),o=[this.availablePowerPins.top.ground[0]||this.availablePowerPins.top.threeVolt[0],this.availablePowerPins.bottom.ground[0]||this.availablePowerPins.bottom.threeVolt[0]].map(function(t){return i.opts.getBBCoord(t)});o[0]&&o[1]||console.debug('No more available "'+e+'" locations!');var s=0==t.visuals.findClosestCoordIdx(r,o),a=void 0;s?"ground"===e?a=this.availablePowerPins.top.ground:"threeVolt"===e&&(a=this.availablePowerPins.top.threeVolt):"ground"===e?a=this.availablePowerPins.bottom.ground:"threeVolt"===e&&(a=this.availablePowerPins.bottom.threeVolt);var u=a.map(function(t){return i.opts.getBBCoord(t)}),l=t.visuals.findClosestCoordIdx(r,u),c=a[l];return s?(this.availablePowerPins.top.ground.splice(l,1),this.availablePowerPins.top.threeVolt.splice(l,1)):(this.availablePowerPins.bottom.ground.splice(l,1),this.availablePowerPins.bottom.threeVolt.splice(l,1)),c}if("breadboard"===e.type)return e;if("MOSI"===e||"MISO"===e||"SCK"===e)return this.opts.boardDef.spiPins||console.debug("No SPI pin mappings found!"),{type:"dalboard",pin:c=this.opts.boardDef.spiPins[e]};if("SDA"===e||"SCL"===e)return this.opts.boardDef.i2cPins||console.debug("No I2C pin mappings found!"),{type:"dalboard",pin:c=this.opts.boardDef.i2cPins[e]};t.U.assert("string"==typeof e,"Unknown location type: "+e);var p=e,d=this.opts.boardDef.gpioPinMap[p];return t.U.assert(!!d,"Unknown pin: "+e),{type:"dalboard",pin:d}},e.prototype.getBoardGroundPin=function(){var t=this.opts.boardDef.groundPins[0]||null;return t||console.log("No available ground pin on board!"),t},e.prototype.getBoardThreeVoltPin=function(){var t=this.opts.boardDef.threeVoltPins[0]||null;return t||console.log("No available 3.3V pin on board!"),t},e.prototype.allocPowerWires=function(t){var e,n,i=this.getBoardGroundPin(),r=this.getBoardThreeVoltPin(),o={type:"breadboard",row:"-",col:"26"},s={type:"breadboard",row:"-",col:"1"},a={type:"breadboard",row:"-",col:"50"},u={type:"breadboard",row:"-",col:"25"};this.opts.boardDef.attachPowerOnRight?(e=a,n=u):(e=o,n=s);var l=[],c=[];t.bottomGround&&t.topGround&&l.push({start:this.allocLocation("ground",{referenceBBPin:e}),end:this.allocLocation("ground",{referenceBBPin:n}),color:"blue"}),t.topGround?l.push({start:this.allocLocation("ground",{referenceBBPin:e}),end:{type:"dalboard",pin:i},color:"blue"}):t.bottomGround&&l.push({start:this.allocLocation("ground",{referenceBBPin:n}),end:{type:"dalboard",pin:i},color:"blue"}),t.bottomThreeVolt&&t.bottomGround&&c.push({start:this.allocLocation("threeVolt",{referenceBBPin:e}),end:this.allocLocation("threeVolt",{referenceBBPin:n}),color:"red"}),t.topThreeVolt?c.push({start:this.allocLocation("threeVolt",{referenceBBPin:e}),end:{type:"dalboard",pin:r},color:"red"}):t.bottomThreeVolt&&c.push({start:this.allocLocation("threeVolt",{referenceBBPin:n}),end:{type:"dalboard",pin:r},color:"red"});var p=[];l.length>0&&p.push({wireIndices:l.map(function(t,e){return e})});var d=l.length;return c.length>0&&p.push({wireIndices:c.map(function(t,e){return e+d})}),{wires:l.concat(c),assembly:p}},e.prototype.allocWire=function(t){var e=this,n=[t.start,t.end],i=n.map(function(t){return"ground"===t||"threeVolt"===t}),r=n.map(function(t,n){return i[n]?null:e.allocLocation(t,{})});return r=r.map(function(t,i){if(t)return t;var o=r[1-i];return e.allocLocation(n[i],{referenceBBPin:o})}),{start:r[0],end:r[1],color:t.color}},e.prototype.allocPart=function(e){var n=e.pins.filter(function(t){return a(t.def)}).map(function(n){var i=e.startRowIdx+n.bbFit.partRelativeRowIdx;i>=7&&(i-=2);var r=t.visuals.getRowName(i),o=e.startColumnIdx+n.bbFit.partRelativeColIdx;return{type:"breadboard",row:r,col:t.visuals.getColumnName(o)}});return{name:e.name,visual:e.def.visual,bbFit:e.bbFit,startColumnIdx:e.startColumnIdx,startRowIdx:e.startRowIdx,breadboardConnections:n,params:e.partParams,simulationBehavior:e.def.simulationBehavior}},e.prototype.allocAll=function(){var t=this,e=this.opts.partsList.map(function(e){return{name:e,def:t.opts.partDefs[e]}}).filter(function(t){return!!t.def});if(e.length>0){e.map(function(t){return t.name}),e.map(function(t){return t.def});var r=e.map(function(e){return t.computePartDimensions(e.def,e.name)}),o=[];e.forEach(function(e,n){var i=r[n],s=t.allocPartIRs(e.def,e.name,i);o=o.concat(s)});var s=this.placeParts(o).map(function(e){return t.allocWireIRs(e)}),a=s.map(function(t){return t.wires}).reduce(function(t,e){return t.concat(e)},[]).map(function(t){return n(t)});this.powerUsage=i(a);var u=this.allocPowerWires(this.powerUsage),l=s.map(function(e,n){var i=t.allocPart(e),r=e.wires.map(function(e){return t.allocWire(e)}),o=[];return e.wires.forEach(function(t,e){o[t.pinIdx]=e}),{part:i,wires:r,assembly:e.def.assembly.map(function(t){return{part:t.part,wireIndices:(t.pinIndices||[]).map(function(t){return o[t]})}})}}),c=[u].concat(l);return{partsAndWires:c,requiresBreadboard:c.some(function(t){return t.part&&t.part.breadboardConnections&&t.part.breadboardConnections.length>0||t.wires&&t.wires.some(function(t){return"breadboard"==t.end.type&&"croc"!=t.end.style||"breadboard"==t.start.type&&"croc"!=t.start.style})})}}return{partsAndWires:[]}},e}();t.allocateDefinitions=function(t){return new c(t).allocAll()}}(pxsim||(pxsim={}));var pxsim;!function(t){!function(t){var e=function(){return function(t){this.seq=0,this.type=t}}();t.Message=e;var n=function(t){function e(e,n){t.call(this,"response"),this.request_seq=e.seq,this.command=e.command,n?(this.success=!1,this.message=n):this.success=!0}return __extends(e,t),e}(e);t.Response=n;var i=function(t){function e(e,n){t.call(this,"event"),this.event=e,n&&(this.body=n)}return __extends(e,t),e}(e);t.Event=i;var r=function(){return function(t,e,n,i,r){void 0===n&&(n=0),this.name=t,this.path=e,this.sourceReference=n,i&&(this.origin=i),r&&(this.adapterData=r)}}();t.Source=r;var o=function(){return function(t,e,n){void 0===n&&(n=!1),this.name=t,this.variablesReference=e,this.expensive=n}}();t.Scope=o;var s=function(){return function(t,e,n,i,r){void 0===i&&(i=0),void 0===r&&(r=0),this.id=t,this.source=n,this.line=i,this.column=r,this.name=e}}();t.StackFrame=s;var a=function(){return function(t,e){this.id=t,this.name=e||"Thread #"+t}}();t.Thread=a;var u=function(){return function(t,e,n,i,r){void 0===n&&(n=0),this.name=t,this.value=e,this.variablesReference=n,"number"==typeof r&&(this.namedVariables=r),"number"==typeof i&&(this.indexedVariables=i)}}();t.Variable=u;var l=function(){return function(t,e,n,i){this.verified=t;var r=this;"number"==typeof e&&(r.line=e),"number"==typeof n&&(r.column=n),i&&(r.source=i)}}();t.Breakpoint=l;var c=function(){return function(t,e){this.id=t,this.name=e}}();t.Module=c;var p=function(){return function(t,e,n){void 0===n&&(n=0),this.label=t,this.start=e,this.length=n}}();t.CompletionItem=p;var d=function(t){function e(e,n,i){void 0===i&&(i=null),t.call(this,"stopped"),this.body={reason:e,threadId:n},i&&(this.body.text=i)}return __extends(e,t),e}(i);t.StoppedEvent=d;var h=function(t){function e(e,n){t.call(this,"continued"),this.body={threadId:e},"boolean"==typeof n&&(this.body.allThreadsContinued=n)}return __extends(e,t),e}(i);t.ContinuedEvent=h;var f=function(t){function e(){t.call(this,"initialized")}return __extends(e,t),e}(i);t.InitializedEvent=f;var m=function(t){function e(e){t.call(this,"terminated"),"boolean"==typeof e&&(this.body={restart:e})}return __extends(e,t),e}(i);t.TerminatedEvent=m;var v=function(t){function e(e,n,i){void 0===n&&(n="console"),t.call(this,"output"),this.body={category:n,output:e},void 0!==i&&(this.body.data=i)}return __extends(e,t),e}(i);t.OutputEvent=v;var g=function(t){function e(e,n){t.call(this,"thread"),this.body={reason:e,threadId:n}}return __extends(e,t),e}(i);t.ThreadEvent=g;var b=function(t){function e(e,n){t.call(this,"breakpoint"),this.body={reason:e,breakpoint:n}}return __extends(e,t),e}(i);t.BreakpointEvent=b;var y=function(t){function e(e,n){t.call(this,"module"),this.body={reason:e,module:n}}return __extends(e,t),e}(i);t.ModuleEvent=y;var w=function(){function e(){this._pendingRequests={}}return e.prototype.start=function(t){var e=this;this._sequence=1,this.host=t,this.host.onData(function(t){if("request"===t.type)e.dispatchRequest(t);else if("response"===t.type){var n=t,i=e._pendingRequests[n.seq];i&&(delete e._pendingRequests[n.seq],i(n))}})},e.prototype.stop=function(){this.host&&this.host.close()},e.prototype.sendEvent=function(t){this.send("event",t)},e.prototype.sendResponse=function(t){t.seq>0?console.error("attempt to send more than one response for command "+t.command):this.send("response",t)},e.prototype.sendRequest=function(e,n,i,r){var o=this,s={command:e};if(n&&Object.keys(n).length>0&&(s.arguments=n),this.send("request",s),r){this._pendingRequests[s.seq]=r;var a=setTimeout(function(){clearTimeout(a);var e=o._pendingRequests[s.seq];e&&(delete o._pendingRequests[s.seq],e(new t.Response(s,"timeout")))},i)}},e.prototype.send=function(t,e){if(e.type=t,e.seq=this._sequence++,this.host){var n=JSON.stringify(e);this.host.send(n)}},e.prototype.dispatchRequest=function(t){},e}();t.ProtocolServer=w;var x=function(e){function n(){e.apply(this,arguments),this._debuggerLinesStartAt1=!1,this._debuggerColumnsStartAt1=!1,this._clientLinesStartAt1=!0,this._clientColumnsStartAt1=!0}return __extends(n,e),n.prototype.shutdown=function(){},n.prototype.dispatchRequest=function(e){var n=new t.Response(e);try{if("initialize"===e.command){var i=e.arguments;if("boolean"==typeof i.linesStartAt1&&(this._clientLinesStartAt1=i.linesStartAt1),"boolean"==typeof i.columnsStartAt1&&(this._clientColumnsStartAt1=i.columnsStartAt1),"path"!==i.pathFormat)this.sendErrorResponse(n,2018,"debug adapter only supports native paths",null);else{var r=n;r.body={},this.initializeRequest(r,i)}}else"launch"===e.command?this.launchRequest(n,e.arguments):"attach"===e.command?this.attachRequest(n,e.arguments):"disconnect"===e.command?this.disconnectRequest(n,e.arguments):"setBreakpoints"===e.command?this.setBreakPointsRequest(n,e.arguments):"setFunctionBreakpoints"===e.command?this.setFunctionBreakPointsRequest(n,e.arguments):"setExceptionBreakpoints"===e.command?this.setExceptionBreakPointsRequest(n,e.arguments):"configurationDone"===e.command?this.configurationDoneRequest(n,e.arguments):"continue"===e.command?this.continueRequest(n,e.arguments):"next"===e.command?this.nextRequest(n,e.arguments):"stepIn"===e.command?this.stepInRequest(n,e.arguments):"stepOut"===e.command?this.stepOutRequest(n,e.arguments):"stepBack"===e.command?this.stepBackRequest(n,e.arguments):"restartFrame"===e.command?this.restartFrameRequest(n,e.arguments):"goto"===e.command?this.gotoRequest(n,e.arguments):"pause"===e.command?this.pauseRequest(n,e.arguments):"stackTrace"===e.command?this.stackTraceRequest(n,e.arguments):"scopes"===e.command?this.scopesRequest(n,e.arguments):"variables"===e.command?this.variablesRequest(n,e.arguments):"setVariable"===e.command?this.setVariableRequest(n,e.arguments):"source"===e.command?this.sourceRequest(n,e.arguments):"threads"===e.command?this.threadsRequest(n):"evaluate"===e.command?this.evaluateRequest(n,e.arguments):"stepInTargets"===e.command?this.stepInTargetsRequest(n,e.arguments):"gotoTargets"===e.command?this.gotoTargetsRequest(n,e.arguments):"completions"===e.command?this.completionsRequest(n,e.arguments):this.customRequest(e.command,n,e.arguments)}catch(t){this.sendErrorResponse(n,1104,"{_stack}",{_exception:t.message,_stack:t.stack})}},n.prototype.initializeRequest=function(t,e){t.body.supportsConditionalBreakpoints=!1,t.body.supportsHitConditionalBreakpoints=!1,t.body.supportsFunctionBreakpoints=!1,t.body.supportsConfigurationDoneRequest=!0,t.body.supportsEvaluateForHovers=!1,t.body.supportsStepBack=!1,t.body.supportsSetVariable=!1,t.body.supportsRestartFrame=!1,t.body.supportsStepInTargetsRequest=!1,t.body.supportsGotoTargetsRequest=!1,t.body.supportsCompletionsRequest=!1,this.sendResponse(t)},n.prototype.disconnectRequest=function(t,e){this.sendResponse(t),this.shutdown()},n.prototype.launchRequest=function(t,e){this.sendResponse(t)},n.prototype.attachRequest=function(t,e){this.sendResponse(t)},n.prototype.setBreakPointsRequest=function(t,e){this.sendResponse(t)},n.prototype.setFunctionBreakPointsRequest=function(t,e){this.sendResponse(t)},n.prototype.setExceptionBreakPointsRequest=function(t,e){this.sendResponse(t)},n.prototype.configurationDoneRequest=function(t,e){this.sendResponse(t)},n.prototype.continueRequest=function(t,e){this.sendResponse(t)},n.prototype.nextRequest=function(t,e){this.sendResponse(t)},n.prototype.stepInRequest=function(t,e){this.sendResponse(t)},n.prototype.stepOutRequest=function(t,e){this.sendResponse(t)},n.prototype.stepBackRequest=function(t,e){this.sendResponse(t)},n.prototype.restartFrameRequest=function(t,e){this.sendResponse(t)},n.prototype.gotoRequest=function(t,e){this.sendResponse(t)},n.prototype.pauseRequest=function(t,e){this.sendResponse(t)},n.prototype.sourceRequest=function(t,e){this.sendResponse(t)},n.prototype.threadsRequest=function(t){this.sendResponse(t)},n.prototype.stackTraceRequest=function(t,e){this.sendResponse(t)},n.prototype.scopesRequest=function(t,e){this.sendResponse(t)},n.prototype.variablesRequest=function(t,e){this.sendResponse(t)},n.prototype.setVariableRequest=function(t,e){this.sendResponse(t)},n.prototype.evaluateRequest=function(t,e){this.sendResponse(t)},n.prototype.stepInTargetsRequest=function(t,e){this.sendResponse(t)},n.prototype.gotoTargetsRequest=function(t,e){this.sendResponse(t)},n.prototype.completionsRequest=function(t,e){this.sendResponse(t)},n.prototype.customRequest=function(t,e,n){this.sendErrorResponse(e,1014,"unrecognized request",null)},n.prototype.sendErrorResponse=function(t,e,i,r){var o;"number"==typeof e?(o={id:e,format:i},r&&(o.variables=r),o.showUser=!0):o=e,t.success=!1,n.formatPII(o.format,!0,o.variables),t.body||(t.body={}),t.body.error=o,this.sendResponse(t)},n.prototype.convertClientLineToDebugger=function(t){return this._debuggerLinesStartAt1?this._clientLinesStartAt1?t:t+1:this._clientLinesStartAt1?t-1:t},n.prototype.convertDebuggerLineToClient=function(t){return this._debuggerLinesStartAt1?this._clientLinesStartAt1?t:t-1:this._clientLinesStartAt1?t+1:t},n.prototype.convertClientColumnToDebugger=function(t){return this._debuggerColumnsStartAt1?this._clientColumnsStartAt1?t:t+1:this._clientColumnsStartAt1?t-1:t},n.prototype.convertDebuggerColumnToClient=function(t){return this._debuggerColumnsStartAt1?this._clientColumnsStartAt1?t:t-1:this._clientColumnsStartAt1?t+1:t},n.prototype.convertClientPathToDebugger=function(t){return this._clientPathsAreURIs!=this._debuggerPathsAreURIs?this._clientPathsAreURIs?n.uri2path(t):n.path2uri(t):t},n.prototype.convertDebuggerPathToClient=function(t){return this._debuggerPathsAreURIs!=this._clientPathsAreURIs?this._debuggerPathsAreURIs?n.uri2path(t):n.path2uri(t):t},n.path2uri=function(t){var e=t.replace(/\\/g,"/");return"/"!==e[0]&&(e="/"+e),encodeURI("file://"+e)},n.uri2path=function(t){return t},n.formatPII=function(t,e,i){return t.replace(n._formatPIIRegexp,function(t,n){return e&&n.length>0&&"_"!==n[0]?t:i[n]&&i.hasOwnProperty(n)?i[n]:t})},n._formatPIIRegexp=/{([^}]+)}/g,n}(w);t.DebugSession=x}(t.protocol||(t.protocol={}))}(pxsim||(pxsim={}));var pxsim;!function(t){!function(t){function e(t){var e=[];return(t=t.replace(/\\/g,"/")).split("/").forEach(function(t){".."===t&&e.length?e.pop():t&&"."!==t&&e.push(t)}),e}t.injectPolyphils=function(){Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:Array.prototype.slice,writable:!0,enumerable:!0}),Uint8Array.prototype.fill||Object.defineProperty(Uint8Array.prototype,"fill",{writable:!0,enumerable:!0,value:function(t){if(null==this)throw new TypeError("this is null or not defined");for(var e=Object(this),n=e.length>>>0,i=arguments[1]>>0,r=i<0?Math.max(n+i,0):Math.min(i,n),o=arguments[2],s=void 0===o?n:o>>0,a=s<0?Math.max(n+s,0):Math.min(s,n);r<a;)e[r]=t,r++;return e}})};var n=function(){function t(t){this._func=t,this._evaluated=!1}return Object.defineProperty(t.prototype,"value",{get:function(){return this._evaluated||(this._value=this._func(),this._evaluated=!0),this._value},enumerable:!0,configurable:!0}),t}();t.Lazy=n,t.getNormalizedParts=e,t.normalizePath=function(t){return e(t).join("/")},t.relativePath=function(t,n){for(var i=e(t),r=e(n),o=0;i[o]===r[o]&&++o!==i.length&&o!==r.length;);for(var s=i.slice(o),a=r.slice(o),u=0;u<s.length;u++)a.unshift("..");return a.join("/")},t.pathJoin=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var n="";return t.forEach(function(t){t.replace(/\\/g,"/"),t.lastIndexOf("/")===t.length-1&&(t=t.slice(0,t.length-1)),n+="/"+t}),n}}(t.util||(t.util={}))}(pxsim||(pxsim={}));var pxsim;!function(t){t.getWarningMessage=function(e){for(var n={type:"debugger",subtype:"warning",breakpointIds:[],message:e},i=t.runtime.currFrame;null!=i;)n.breakpointIds.push(i.lastBrkId),i=i.parent;return n};var e=function(){function t(t){var e=this;this.fileMap={},this.idMap={},t.forEach(function(t){var n=t[0],i=t[1];e.fileMap[i.source.path]||(e.fileMap[i.source.path]=[]),e.fileMap[i.source.path].push(t),e.idMap[n]=i});for(var n in this.fileMap){var i=this.fileMap[n];this.fileMap[n]=i.sort(function(t,e){var n=t[1],i=e[1];return n.line===i.line?i.endLine===n.endLine?n.column-i.column:i.endLine-n.endLine:n.line-i.line})}}return t.prototype.getById=function(t){return this.idMap[t]},t.prototype.verifyBreakpoint=function(t,e){var n,i=this.fileMap[t];if(i)for(var r=0,o=i;r<o.length;r++){var s=o[r],a=s[0],u=s[1];u.line<=e.line&&u.endLine>=e.line&&(n=[a,u])}return n?(n[1].verified=!0,n):[-1,{verified:!1}]},t}();t.BreakpointMap=e,t.getBreakpointMsg=function(e,n){function i(e){switch(typeof e){case"string":case"number":case"boolean":return e;case"function":return{text:"(function)"};case"undefined":return null;case"object":return e?e instanceof t.RefObject?{id:e.id}:{text:"(object)"}:null;default:throw new Error}}function r(t){for(var e={},n=0,r=Object.keys(t);n<r.length;n++){var o=r[n];/___\d+$/.test(o)&&(e[o]=i(t[o]))}return e}for(var o={type:"debugger",subtype:"breakpoint",breakpointId:n,globals:r(t.runtime.globals),stackframes:[]};null!=e;){var s=e.fn?e.fn.info:null;s&&o.stackframes.push({locals:r(e),funcInfo:s,breakpointId:e.lastBrkId}),e=e.parent}return o};var n=function(e){function n(n){var i=this;e.call(this);var r={onDebuggerBreakpoint:function(t){return i.onDebuggerBreakpoint(t)},onDebuggerWarning:function(t){return i.onDebuggerWarning(t)},onDebuggerResume:function(){return i.onDebuggerResume()},onStateChanged:function(t){return i.onStateChanged(t)}};this.driver=new t.SimulatorDriver(n,r)}return __extends(n,e),n.prototype.runCode=function(e,n,i,r,o){this.breakpoints=r,this.projectDir&&this.fixBreakpoints(),this.sendEvent(new t.protocol.InitializedEvent),this.driver.run(e,{parts:n,fnArgs:i,boardDefinition:o})},n.prototype.stopSimulator=function(t){void 0===t&&(t=!1),this.driver.stop(t)},n.prototype.initializeRequest=function(t,e){t.body.supportsConditionalBreakpoints=!1,t.body.supportsHitConditionalBreakpoints=!1,t.body.supportsFunctionBreakpoints=!1,t.body.supportsEvaluateForHovers=!1,t.body.supportsStepBack=!1,t.body.supportsSetVariable=!1,t.body.supportsRestartFrame=!1,t.body.supportsStepInTargetsRequest=!1,t.body.supportsGotoTargetsRequest=!1,t.body.supportsCompletionsRequest=!1,t.body.supportsConfigurationDoneRequest=!0,this.sendResponse(t)},n.prototype.disconnectRequest=function(t,e){this.sendResponse(t),this.shutdown()},n.prototype.launchRequest=function(e,n){this.projectDir||(this.projectDir=t.util.normalizePath(n.projectDir),this.breakpoints&&this.fixBreakpoints()),this.sendResponse(e)},n.prototype.setBreakPointsRequest=function(e,n){var i=this;e.body={breakpoints:[]};var r=[];n.breakpoints.forEach(function(o){if(i.breakpoints){var s=i.breakpoints.verifyBreakpoint(t.util.relativePath(i.projectDir,n.source.path),o),a=s[0],u=s[1];e.body.breakpoints.push(u),u.verified&&r.push(a)}else e.body.breakpoints.push({verified:!1})}),this.driver.setBreakpoints(r),this.sendResponse(e)},n.prototype.continueRequest=function(e,n){this.driver.resume(t.SimulatorDebuggerCommand.Resume),this.sendResponse(e)},n.prototype.nextRequest=function(e,n){this.driver.resume(t.SimulatorDebuggerCommand.StepOver),this.sendResponse(e)},n.prototype.stepInRequest=function(e,n){this.driver.resume(t.SimulatorDebuggerCommand.StepInto),this.sendResponse(e)},n.prototype.stepOutRequest=function(e,n){this.driver.resume(t.SimulatorDebuggerCommand.StepOut),this.sendResponse(e)},n.prototype.pauseRequest=function(e,n){this.driver.resume(t.SimulatorDebuggerCommand.Pause),this.sendResponse(e)},n.prototype.threadsRequest=function(t){t.body={threads:[{id:n.THREAD_ID,name:"main"}]},this.sendResponse(t)},n.prototype.stackTraceRequest=function(t,e){if(this.lastBreak){var n=this.state.getFrames();t.body={stackFrames:n}}this.sendResponse(t)},n.prototype.scopesRequest=function(t,e){this.state&&(t.body={scopes:this.state.getScopes(e.frameId)}),this.sendResponse(t)},n.prototype.variablesRequest=function(t,e){this.state&&(t.body={variables:this.state.getVariables(e.variablesReference)}),this.sendResponse(t)},n.prototype.onDebuggerBreakpoint=function(e){this.lastBreak=e,this.state=new i(this.lastBreak,this.breakpoints,this.projectDir),e.exceptionMessage?this.sendEvent(new t.protocol.StoppedEvent("exception",n.THREAD_ID,e.exceptionMessage)):this.sendEvent(new t.protocol.StoppedEvent("breakpoint",n.THREAD_ID))},n.prototype.onDebuggerWarning=function(t){},n.prototype.onDebuggerResume=function(){this.sendEvent(new t.protocol.ContinuedEvent(n.THREAD_ID,!0))},n.prototype.onStateChanged=function(e){switch(e){case t.SimulatorState.Paused:break;case t.SimulatorState.Running:this.sendEvent(new t.protocol.ContinuedEvent(n.THREAD_ID,!0));break;case t.SimulatorState.Stopped:this.sendEvent(new t.protocol.TerminatedEvent);break;case t.SimulatorState.Unloaded:}},n.prototype.fixBreakpoints=function(){for(var e in this.breakpoints.idMap){var n=this.breakpoints.idMap[e];n.source.path=t.util.pathJoin(this.projectDir,n.source.path),n.line=this.convertDebuggerLineToClient(n.line),n.endLine=this.convertDebuggerLineToClient(n.endLine),n.column=this.convertDebuggerColumnToClient(n.column),n.endColumn=this.convertDebuggerColumnToClient(n.endColumn)}},n.THREAD_ID=1,n}(t.protocol.DebugSession);t.SimDebugSession=n;var i=function(){function e(t,e,n){this._message=t,this._map=e,this._dir=n,this._currentId=1,this._frames={},this._vars={};var i=this.nextId();this._vars[i]=this.getVariableValues(this._message.globals),this._globalScope={name:"Globals",variablesReference:i,expensive:!1}}return e.prototype.getFrames=function(){var t=this;return this._message.stackframes.map(function(e,n){var i=t._map.getById(e.breakpointId);if(i)return t._frames[e.breakpointId]=e,{id:e.breakpointId,name:e.funcInfo?e.funcInfo.functionName:0===n?"main":"anonymous",line:i.line,column:i.column,endLine:i.endLine,endColumn:i.endLine,source:i.source}}).filter(function(t){return!!t})},e.prototype.getScopes=function(t){var e=this._frames[t];if(e){var n=this.nextId();return this._vars[n]=this.getVariableValues(e.locals),[{name:"Locals",variablesReference:n,expensive:!1},this._globalScope]}return[this._globalScope]},e.prototype.getVariables=function(t){var e=this._vars[t];return e&&e.value||[]},e.prototype.getVariableValues=function(e){var n=this;return new t.util.Lazy(function(){var t=[];for(var i in e){var r=e[i],o=void 0,s=0;null===r?o="null":void 0===r?o="undefined":"object"==typeof r?(o="(object)",s=n.nextId(),n._vars[s]=n.getVariableValues(r)):o=r.toString();var a=i.substr(0,i.lastIndexOf("___"));t.push({name:a,value:o,variablesReference:s})}return t})},e.prototype.nextId=function(){return this._currentId++},e}()}(pxsim||(pxsim={}));var pxsim;!function(t){function e(t){"undefined"!=typeof window&&window.parent&&window.parent!==window&&window.parent.postMessage(t,"*")}!function(e){function n(e){e.origin;var n=e.data||{},u=n.type||"";if(u)switch(u||""){case"run":r(n);break;case"stop":i();break;case"mute":o(n.mute);break;case"custom":t.handleCustomMessage&&t.handleCustomMessage(n);break;case"pxteditor":break;case"debugger":a&&a.handleDebuggerMsg(n);break;default:s(n)}}function i(){a&&(a.kill(),a.board&&a.board.kill())}function r(e){i(),e.mute&&o(e.mute),e.localizedStrings&&t.localization.setLocalizedStrings(e.localizedStrings),(a=new t.Runtime(e)).board.initAsync(e).done(function(){a.run(function(e){t.dumpLivePointers(),t.Runtime.postMessage({type:"toplevelcodefinished"})})})}function o(e){t.AudioContextManager.mute(e)}function s(t){a&&!a.dead&&a.board.receiveMessage(t)}e.start=function(){window.addEventListener("message",n,!1);var e=window.location.hash.slice(1);t.Runtime.postMessage({type:"ready",frameid:e})};var a;e.stop=i,e.run=r}(t.Embed||(t.Embed={})),t.tickEvent=function(t,n){e({type:"pxtsim",action:"event",tick:t,data:n})},t.reportError=function(t,n,i){e({type:"pxtsim",action:"event",tick:"error",category:t,message:n,data:i})}}(pxsim||(pxsim={})),pxsim.util.injectPolyphils(),"undefined"!=typeof window&&window.addEventListener("load",function(t){pxsim.Embed.start()});var pxsim;!function(t){!function(e){function n(t,e){t.classList?t.classList.add(e):t.className.indexOf(e)<0&&(t.className+=" "+e)}function i(e){return t.visuals.mkBoardView({visual:e}).getView()}function r(){return new t.visuals.Breadboard({}).getSVGAndSize()}function o(e,n){var i=document.createElementNS("http://www.w3.org/2000/svg","svg"),r={l:0,t:0,w:0,h:0},o=document.createElementNS("http://www.w3.org/2000/svg","svg");i.appendChild(o),o.appendChild(e.el);var s={viewBox:e.x+" "+e.y+" "+e.w+" "+e.h,preserveAspectRatio:"xMidYMid"};r.w=e.w,r.h=e.h;var a=function(t){r.h*=t,r.w*=t,s.width=r.w,s.height=r.h};n.cmpScale&&a(n.cmpScale),n.cmpWidth&&n.cmpWidth<r.w?a(n.cmpWidth/r.w):n.cmpHeight&&n.cmpHeight<r.h&&a(n.cmpHeight/r.h),t.svg.hydrate(o,s);var u={l:r.l,t:r.t,w:r.w,h:r.h},l=function(t){if(t<r.l){var e=r.l-t;r.l=t,r.w+=e}},c=function(t){var e=r.l+r.w;if(e<t){var n=t-e;r.w+=n}},p=function(t){if(t<r.t){var e=r.t-t;r.t=t,r.h+=e}},d=function(t){var e=r.t+r.h;if(e<t){var n=t-e;r.h+=n}},h=[-.3,.3],f=h[0],m=h[1],v=[1.4,1];if(n&&n.top){var g=(P=n.topSize)/v[0],b=P/v[1],C=[u.l+u.w/2,u.t-y-b/2],R=C[0],k=C[1],I=t.visuals.mkTxt(R,k,P,0,n.top,f,m);t.svg.addClass(I,"cmp-lbl"),i.appendChild(I);B=g*n.top.length;p(k-b/2),l(R-B/2),c(R+B/2)}if(n&&n.bot){var g=(P=n.botSize)/v[0],b=P/v[1],E=[u.l+u.w/2,u.t+u.h+y+b/2],R=E[0],k=E[1],I=t.visuals.mkTxt(R,k,P,0,n.bot,f,m);t.svg.addClass(I,"cmp-lbl"),i.appendChild(I);B=g*n.bot.length;d(k+b/2),l(R-B/2),c(R+B/2)}if(n&&n.right){var g=(P=n.rightSize)/v[0],b=P/v[1],B=g*n.right.length,D=[u.l+u.w+w+B/2,u.t+u.h/2],R=D[0],S=D[1],I=t.visuals.mkTxt(R,S,P,0,n.right,f,m);t.svg.addClass(I,"cmp-lbl"),i.appendChild(I),p(S-b/2),c(R+B/2),d(S+b/2)}if(n&&n.left){var P=n.leftSize,g=P/v[0],b=P/v[1],B=g*n.left.length,_=[u.l-x-B/2,u.t+u.h/2],R=_[0],S=_[1],I=t.visuals.mkTxt(R,S,P,0,n.left,f,m);t.svg.addClass(I,"cmp-lbl"),i.appendChild(I),p(S-b/2),l(R-B/2),d(S+b/2)}var T={viewBox:r.l+" "+r.t+" "+r.w+" "+r.h,width:r.w*M,height:r.h*M,preserveAspectRatio:"xMidYMid"};t.svg.hydrate(i,T);var A=document.createElement("div");return A.appendChild(i),A}function s(e,n){var i,r=t.runtime.board;if("wire"==e)i=t.visuals.mkWirePart([0,0],n.wireClr||"red",n.crocClips);else{var s=e;i="string"==typeof s.builtIn?(0,r.builtinPartVisuals[s.builtIn])([0,0]):t.visuals.mkGenericPartSVG(s)}return o(i,n)}function a(e){var n=t.allocateDefinitions(e),i=[],r=[],o=1;n.partsAndWires.forEach(function(t){var e=t.part,n=t.wires;t.assembly.forEach(function(t,s){t.part&&e&&(r[o+s]=[e]),t.wireIndices&&t.wireIndices.length>0&&n&&(i[o+s]=t.wireIndices.map(function(t){return n[t]}))}),o+=t.assembly.length});var s=o-1,a=n.partsAndWires.map(function(t){return t.part}).filter(function(t){return!!t}),u=n.partsAndWires.map(function(t){return t.wires||[]}).reduce(function(t,e){return t.concat(e)},[]),l={},c=[];return u.forEach(function(t){l[t.color]||(l[t.color]=[],c.push(t.color)),l[t.color].push(t)}),{boardDef:e.boardDef,cmpDefs:e.partDefs,fnArgs:e.fnArgs,allAlloc:n,stepToWires:i,stepToCmps:r,allWires:u,allCmps:a,lastStep:s,colorToWires:l,allWireColors:c}}function u(e,n,i){void 0===i&&(i=!1);var r={state:t.runtime.board,boardDef:e.boardDef,forceBreadboardLayout:!0,forceBreadboardRender:e.allAlloc.requiresBreadboard,partDefs:e.cmpDefs,maxWidth:n+"px",fnArgs:e.fnArgs,wireframe:i,partsList:[]},o=new t.visuals.BoardHost(t.visuals.mkBoardView({visual:r.boardDef.visual,wireframe:r.wireframe}),r),s=o.getView();return t.svg.addClass(s,"board-svg"),o}function l(e,n,i){var r=e.getView();n>0&&t.svg.addClass(r,"grayed");for(var o=0;o<=n;o++)!function(r){var o=i.stepToCmps[r];o&&o.forEach(function(i){var o=e.addPart(i);r===n&&(i.breadboardConnections.forEach(function(t){return e.highlightBreadboardPin(t)}),t.svg.addClass(o.element,"notgrayed"))});var s=i.stepToWires[r];s&&s.forEach(function(t){var i=e.addWire(t);r===n&&("breadboard"==t.start.type?e.highlightBreadboardPin(t.start):e.highlightBoardPin(t.start.pin),"breadboard"==t.end.type?e.highlightBreadboardPin(t.end):e.highlightBoardPin(t.end.pin),e.highlightWire(i))})}(o)}function c(){var t=document.createElement("div");return n(t,"instr-panel"),t}function p(t){var e=c(),a=o(i(t.boardDef.visual),{left:g(1),leftSize:v,cmpScale:L});e.appendChild(a);var u=o(r(),{left:g(1),leftSize:v,cmpScale:O});return e.appendChild(u),t.allCmps.forEach(function(t){var i=1;"buttonpair"===t.visual.builtIn&&(i=2);var r=s(t.visual,{left:g(i),leftSize:v,cmpScale:N});n(r,"partslist-cmp"),e.appendChild(r)}),t.allWireColors.forEach(function(i){var r=t.colorToWires[i].length,o=s("wire",{left:g(r),leftSize:b,wireClr:i,cmpScale:q,crocClips:t.boardDef.useCrocClips});n(o,"partslist-wire"),e.appendChild(o)}),e}function d(t,e){var i=c(),r=u(e,T,!0);l(r,t,e),i.appendChild(r.getView());var o=document.createElement("div");n(o,"panel-num-outer"),n(o,"noselect"),i.appendChild(o);var a=document.createElement("div");n(a,"panel-num"),a.textContent=t+1+"",o.appendChild(a);var p=document.createElement("div");n(p,"reqs-div"),i.appendChild(p);var d=function(t){if("breadboard"===t.type){var e=t;return"("+e.row+","+e.col+")"}return t.pin};return(e.stepToWires[t]||[]).forEach(function(t){var i=s("wire",{top:d(t.end),topSize:m,bot:d(t.start),botSize:m,wireClr:t.color,cmpHeight:C,crocClips:e.boardDef.useCrocClips});n(i,"cmp-div"),p.appendChild(i)}),(e.stepToCmps[t]||[]).forEach(function(t){("buttonpair"===t.visual.builtIn?[t.breadboardConnections[0],t.breadboardConnections[2]]:[t.breadboardConnections[0]]).forEach(function(e,i){var r;r=e?"("+e.row+","+e.col+")":"";var o=k;"buttonpair"===t.visual.builtIn&&(o*=.5);var a=s(t.visual,{top:r,topSize:m,cmpHeight:R,cmpScale:o});n(a,"cmp-div"),p.appendChild(a)})}),i}function h(t){var e=document.getElementById("front-panel"),n=u(t,A,!1);return n.addAll(t.allAlloc),e.appendChild(n.getView()),[e,t]}function f(t){var e=c();n(e,"back-panel");var i=u(t,F,!1);return i.addAll(t.allAlloc),e.appendChild(i.getView()),e}var m=10,v=30,g=function(t){return t+"x"},b=20,y=3,w=5,x=5,C=45,R=55,k=1.5,I=[816*.95,1056*.95],E=I[0]-86.4,B=I[1]-86.4,D=[1,1],S=D[0],P=D[1],_=E/P-48*P,T=465,A=400,M=2.3,L=.17,O=.25,N=.3,q=.23,F=_-36,U="\n            .instr-panel {\n                margin: 20px;\n                padding: 24px;\n                border-width: 4px;\n                border-color: gray;\n                border-style: solid;\n                border-radius: 20px;\n                display: inline-block;\n                width: "+_+"px;\n                height: "+(B/S-48*S)+"px;\n                position: relative;\n                overflow: hidden;\n                page-break-inside: avoid;\n            }\n            .board-svg {\n                margin: 0 auto;\n                display: block;\n                position: absolute;\n                bottom: 24px;\n                left: "+((_-T)/2+24)+"px;\n            }\n            .panel-num-outer {\n                position: absolute;\n                left: "+-4+"px;\n                top: "+-4+"px;\n                width: 120px;\n                height: 120px;\n                border-width: 4px;\n                border-style: solid;\n                border-color: gray;\n                border-radius: 20px 0 20px 0;\n            }\n            .panel-num {\n                margin: 10px 0;\n                text-align: center;\n                font-size: 80px;\n            }\n            .cmp-div {\n                display: inline-block;\n            }\n            .reqs-div {\n                margin-left: 144px;\n                margin-top: 5px;\n            }\n            .partslist-wire,\n            .partslist-cmp {\n                margin: 10px;\n            }\n            .partslist-wire {\n                display: inline-block;\n            }\n            ";e.renderParts=function(e){var n={type:"run",code:""};t.runtime=new t.Runtime(n),t.runtime.board=null,t.initCurrentRuntime(n);var i=document.createElement("style");document.head.appendChild(i),i.textContent+=U;var r=e.partDefinitions,o=new t.visuals.Breadboard({}),s=a({boardDef:e.boardDef,partDefs:r,partsList:e.parts,fnArgs:e.fnArgs,getBBCoord:o.getCoord.bind(o)}),u=(h(s),p(s));document.body.appendChild(u);for(var l=0;l<=s.lastStep;l++){var c=d(l,s);document.body.appendChild(c)}var m=f(s);document.body.appendChild(m)}}(t.instructions||(t.instructions={}))}(pxsim||(pxsim={}));var pxsim;!function(t){function e(t,e){if(void 0===e&&(e="sim: check failed"),!t)throw new Error(e)}function n(t){return u||void 0!==t?t:0}function i(t){return void 0===t?null:t}function r(n){if(t.runtime&&t.runtime.refCounting&&n instanceof p){var i=n;e(i.refcnt>0),0==--i.refcnt&&(t.runtime.unregisterLiveObject(i),i.destroy())}}function o(t){return t}function s(n){if(!t.runtime||!t.runtime.refCounting)return n;if(n instanceof p){var i=n;e(i.refcnt>0),i.refcnt++}return n}function a(){t.runtime&&t.runtime.dumpLivePointers()}t.quiet=!1,t.check=e;var u=!1,l={},c={};t.noRefCounting=function(){t.runtime&&(t.runtime.refCounting=!1)},t.getConfig=function(t){return c.hasOwnProperty(t+"")?c[t+""]:null},t.getConfigKey=function(t){return l.hasOwnProperty(t)?l[t]:null},t.getAllConfigKeys=function(){return Object.keys(l)},t.setConfig=function(t,e){c[t]=e},t.setConfigData=function(t,e){c=t,l=e},t.enableFloatingPoint=function(){u=!0};var p=function(){function e(){this.refcnt=1,t.runtime?this.id=t.runtime.registerLiveObject(this):this.id=0}return e.prototype.destroy=function(){},e.prototype.print=function(){t.runtime&&t.runtime.refCountingDebug&&console.log("RefObject id:"+this.id+" refs:"+this.refcnt)},e}();t.RefObject=p;var d=function(){return function(t,e,n,i,r,o){this.func=t,this.caps=e,this.a0=n,this.a1=i,this.a2=r,this.cb=o}}();t.FnWrapper=d;var h=function(n){function i(){n.apply(this,arguments),this.fields=[]}return __extends(i,n),i.prototype.destroy=function(){for(var t=this.vtable.refmask,e=0;e<t.length;++e)t[e]&&r(this.fields[e]);this.fields=null,this.vtable=null},i.prototype.isRef=function(t){return e(0<=t&&t<this.fields.length),!!this.vtable.refmask[t]},i.prototype.print=function(){t.runtime&&t.runtime.refCountingDebug&&console.log("RefRecord id:"+this.id+" ("+this.vtable.name+") len:"+this.fields.length)},i}(p);t.RefRecord=h;var f=function(n){function i(){n.apply(this,arguments),this.fields=[]}return __extends(i,n),i.prototype.isRef=function(t){return e(0<=t&&t<this.fields.length),t<this.reflen},i.prototype.ldclo=function(t){return t>>=2,e(0<=t&&t<this.fields.length),this.fields[t]},i.prototype.destroy=function(){for(var t=0;t<this.reflen;++t)r(this.fields[t]);this.fields=null,this.func=null},i.prototype.print=function(){t.runtime&&t.runtime.refCountingDebug&&console.log("RefAction id:"+this.id+" refs:"+this.refcnt+" len:"+this.fields.length)},i}(p);t.RefAction=f;!function(e){function n(e,n,i,r){var o=t.getResume();e instanceof f?(b.incr(e),o(new d(e.func,e.fields,n,i,r,function(){b.decr(e)}))):o(new d(e,null,n,i,r,null))}e.mkAction=function(t,e,n){var i=new f;i.reflen=t,i.func=n;for(var r=0;r<e;++r)i.fields.push(null);return i},e.runAction3=n,e.runAction2=function(t,e,i){n(t,e,i,null)},e.runAction1=function(t,e){n(t,e,null,null)},e.runAction0=function(t){n(t,null,null,null)}}(t.pxtcore||(t.pxtcore={}));var m=function(t){function e(){t.apply(this,arguments),this.v=0}return __extends(e,t),e.prototype.print=function(){},e}(p);t.RefLocal=m;var v=function(e){function n(){e.apply(this,arguments),this.v=null}return __extends(n,e),n.prototype.destroy=function(){r(this.v)},n.prototype.print=function(){t.runtime&&t.runtime.refCountingDebug&&console.log("RefRefLocal id:"+this.id+" refs:"+this.refcnt+" v:"+this.v)},n}(p);t.RefRefLocal=v;var g=function(e){function n(){e.apply(this,arguments),this.vtable=42,this.data=[]}return __extends(n,e),n.prototype.findIdx=function(t){for(var e=0;e<this.data.length;++e)if(this.data[e].key>>1==t)return e;return-1},n.prototype.destroy=function(){e.prototype.destroy.call(this);for(var t=0;t<this.data.length;++t)1&this.data[t].key&&r(this.data[t].val),this.data[t].val=0;this.data=[]},n.prototype.print=function(){t.runtime&&t.runtime.refCountingDebug&&console.log("RefMap id:"+this.id+" refs:"+this.refcnt+" size:"+this.data.length)},n}(p);t.RefMap=g,t.decr=r,t.initString=o,t.incr=s,t.dumpLivePointers=a;!function(t){t.toString=function(t){return null===t?"null":void 0===t?"undefined":o(t.toString())},t.toBoolDecr=function(t){return r(t),!!t},t.toBool=function(t){return!!t}}(t.numops||(t.numops={}));!function(t){t.toInt=function(t){return 0|t},t.toFloat=function(t){return t},t.ignore=function(t){return t}}(t.langsupp||(t.langsupp={}));!function(e){e.incr=t.incr,e.decr=t.decr,e.ptrOfLiteral=function(t){return t},e.debugMemLeaks=function(){a()},e.allocate=function(){t.U.userError("allocate() called in simulator")},e.templateHash=function(){return 0},e.programHash=function(){return 0},e.programSize=function(){return 0},e.afterProgramPage=function(){return 0},e.getConfig=function(e,n){var i=t.getConfig(e);return null==i?n:i},e.toInt=function(t){return t>>0},e.toUInt=function(t){return t>>>0},e.toDouble=function(t){return t},e.toFloat=function(t){return t},e.fromInt=function(t){return t},e.fromUInt=function(t){return t},e.fromDouble=function(t){return t},e.fromFloat=function(t){return t},e.fromBool=function(t){return!!t}}(t.pxtcore||(t.pxtcore={}));var b;!function(r){function o(e){null!==e&&void 0!==e||t.U.userError("Dereferencing null/undefined value.")}r.incr=t.incr,r.decr=t.decr,r.toInt8=function(t){return(255&t)<<24>>24},r.toInt16=function(t){return(65535&t)<<16>>16},r.toInt32=function(t){return 0|t},r.toUInt32=function(t){return t>>>0},r.toUInt8=function(t){return 255&t},r.toUInt16=function(t){return 65535&t},r.nullFix=function(t){return null===t||void 0===t||!1===t?0:!0===t?1:t},r.nullCheck=o,r.panic=function(e){t.U.userError("PANIC! Code "+e)},r.stringToBool=function(t){return r.decr(t),t?1:0},r.ptrToBool=function(t){return r.decr(t),t?1:0},r.emptyToNull=function(t){return""==t?0:t},r.ldfld=function(t,i){o(t),e(!t.isRef(i));var s=n(t.fields[i]);return r.decr(t),s},r.stfld=function(t,n,i){o(t),e(!t.isRef(n)),t.fields[n]=i,r.decr(t)},r.ldfldRef=function(t,n){o(t),e(t.isRef(n));var s=r.incr(i(t.fields[n]));return r.decr(t),s},r.stfldRef=function(t,n,i){o(t),e(t.isRef(n)),r.decr(t.fields[n]),t.fields[n]=i,r.decr(t)},r.ldloc=function(t){return t.v},r.ldlocRef=function(t){return r.incr(t.v)},r.stloc=function(t,e){t.v=e},r.stlocRef=function(t,e){r.decr(t.v),t.v=e},r.mkloc=function(){return new m},r.mklocRef=function(){return new v},r.stclo=function(t,n,i){return e(0<=n&&n<t.fields.length),e(null===t.fields[n]),t.fields[n]=i,t},r.runtimeWarning=function(e){t.Runtime.postMessage(t.getWarningMessage(e))},r.mkMap=function(){return new g},r.mapGet=function(t,e){var n=t.findIdx(e);if(n<0)return r.decr(t),0;var i=t.data[n].val;return r.decr(t),i},r.mapGetRef=function(t,e){var n=t.findIdx(e);if(n<0)return r.decr(t),0;var i=r.incr(t.data[n].val);return r.decr(t),i},r.mapSet=function(t,e,n){var i=t.findIdx(e);i<0?t.data.push({key:e<<1,val:n}):(1&t.data[i].key&&(r.decr(t.data[i].val),t.data[i].key=e<<1),t.data[i].val=n),r.decr(t)},r.mapSetRef=function(t,e,n){var i=t.findIdx(e);i<0?t.data.push({key:e<<1|1,val:n}):(1&t.data[i].key?r.decr(t.data[i].val):t.data[i].key=e<<1|1,t.data[i].val=n),r.decr(t)}}(b=t.pxtrt||(t.pxtrt={}));!function(t){t.mkClassInstance=function(t){e(!!t.methods),e(!!t.refmask);var n=new h;n.vtable=t;for(var i=t.refmask.length,r=0;r<i;++r)n.fields.push(u?void 0:0);return n},t.switch_eq=function(e,n){return e==n&&(t.decr(n),!0)}}(t.pxtcore||(t.pxtcore={}));!function(e){e.panic=b.panic,e.pause=function(e){var n=t.getResume();setTimeout(function(){n()},e)},e.runInBackground=function(e){t.runtime.runFiberAsync(e).done()},e.forever=function(e){function n(){t.runtime.runFiberAsync(e).then(function(){return Promise.delay(20)}).then(n).done()}b.nullCheck(e),s(e),n()}}(t.thread||(t.thread={}))}(pxsim||(pxsim={}));var pxsim;!function(t){function e(t,e){var n=65535&t,i=65535&e;return n*i+((t>>>16&65535)*i+n*(e>>>16&65535)<<16>>>0)|0}var n=function(e){function n(){e.call(this),this.data=[]}return __extends(n,e),n.prototype.destroy=function(){for(var e=this.data,n=0;n<e.length;++n)t.decr(e[n]),e[n]=0;this.data=[]},n.prototype.isValidIndex=function(t){return t>=0&&t<this.data.length},n.prototype.push=function(t){this.data.push(t)},n.prototype.pop=function(){var t=this.data.pop();return void 0==t?0:t},n.prototype.getLength=function(){return this.data.length},n.prototype.setLength=function(t){this.data.length=t},n.prototype.getAt=function(t){return void 0!=this.data[t]?this.data[t]:0},n.prototype.setAt=function(t,e){this.data[t]=e},n.prototype.insertAt=function(t,e){this.data.splice(t,0,e)},n.prototype.removeAt=function(t){var e=this.data.splice(t,1);return void 0==e[0]?0:e[0]},n.prototype.indexOf=function(t,e){if(0!=t)return this.data.indexOf(t,e);for(var n=this.data.indexOf(t,e),i=-1,r=e;r<this.data.length;r++)if(void 0==this.data[r]){i=r;break}return n<i||-1==i?n:i},n.prototype.print=function(){},n}(t.RefObject);t.RefCollection=n;!function(e){function i(e,n){if(t.pxtrt.nullCheck(e),e.isValidIndex(n))return e.removeAt(n)}function r(e,n,i){return t.pxtrt.nullCheck(e),e.indexOf(n,i)}e.mk=function(){return new n},e.length=function(e){return t.pxtrt.nullCheck(e),e.getLength()},e.setLength=function(e,n){t.pxtrt.nullCheck(e),e.setLength(n)},e.push=function(e,n){t.pxtrt.nullCheck(e),t.incr(n),e.push(n)},e.pop=function(e,n){return t.pxtrt.nullCheck(e),e.pop()},e.getAt=function(e,n){t.pxtrt.nullCheck(e);var i=e.getAt(n);return t.incr(i),i},e.removeAt=i,e.insertAt=function(e,n,i){t.pxtrt.nullCheck(e),t.incr(i),e.insertAt(n,i)},e.setAt=function(e,n,i){t.pxtrt.nullCheck(e),e.isValidIndex(n)&&t.decr(e.getAt(n)),t.incr(i),e.setAt(n,i)},e.indexOf=r,e.removeElement=function(e,n){t.pxtrt.nullCheck(e);var o=r(e,n,0);return o>=0?(i(e,o),1):0}}(t.Array_||(t.Array_={}));!function(t){t.imul=function(t,n){return e(t,n)},t.idiv=function(t,e){return t/e>>0},t.round=function(t){return Math.round(t)},t.ceil=function(t){return Math.ceil(t)},t.floor=function(t){return Math.floor(t)},t.sqrt=function(t){return Math.sqrt(t)},t.pow=function(t,e){return Math.pow(t,e)},t.log=function(t){return Math.log(t)},t.exp=function(t){return Math.exp(t)},t.sin=function(t){return Math.sin(t)},t.cos=function(t){return Math.cos(t)},t.tan=function(t){return Math.tan(t)},t.asin=function(t){return Math.asin(t)},t.acos=function(t){return Math.acos(t)},t.atan=function(t){return Math.atan(t)},t.atan2=function(t,e){return Math.atan2(t,e)},t.trunc=function(t){return t>0?Math.floor(t):Math.ceil(t)},t.random=function(){return Math.random()},t.randomRange=function(t,e){if(t==e)return t;if(t>e){var n=t;t=e,e=n}return Math.floor(t)==t&&Math.floor(e)==e?t+Math.floor(Math.random()*(e-t+1)):t+Math.random()*(e-t)}}(t.Math_||(t.Math_={}));!function(e){function n(e,n){return t.pxtrt.nullFix(e)==t.pxtrt.nullFix(n)}e.lt=function(t,e){return t<e},e.le=function(t,e){return t<=e},e.neq=function(t,e){return!n(t,e)},e.eq=n,e.gt=function(t,e){return t>e},e.ge=function(t,e){return t>=e},e.div=function(t,e){return 0|Math.floor(t/e)},e.mod=function(t,e){return t%e},e.toString=function(e){return t.initString(e+"")}}(t.Number_||(t.Number_={}));!function(t){t.adds=function(t,e){return t+e|0},t.subs=function(t,e){return t-e|0},t.divs=function(t,e){return 0|Math.floor(t/e)},t.muls=function(t,n){return e(t,n)},t.ands=function(t,e){return t&e},t.orrs=function(t,e){return t|e},t.eors=function(t,e){return t^e},t.lsls=function(t,e){return t<<e},t.lsrs=function(t,e){return t>>>e},t.asrs=function(t,e){return t>>e},t.ignore=function(t){return t}}(t.thumb||(t.thumb={}));!function(t){function n(t){return t<<16>>16}t.adds=function(t,e){return n(t+e)},t.subs=function(t,e){return n(t-e)},t.divs=function(t,e){return n(Math.floor(t/e))},t.muls=function(t,i){return n(e(t,i))},t.ands=function(t,e){return n(t&e)},t.orrs=function(t,e){return n(t|e)},t.eors=function(t,e){return n(t^e)},t.lsls=function(t,e){return n(t<<e)},t.lsrs=function(t,e){return(65535&t)>>>e},t.asrs=function(t,e){return n(t>>e)},t.ignore=function(t){return t}}(t.avr||(t.avr={}));!function(e){function n(e,n){return t.pxtrt.nullCheck(e),0<=n&&n<e.length}e.mkEmpty=function(){return""},e.fromCharCode=function(e){return t.initString(String.fromCharCode(e))},e.toNumber=function(t){return parseInt(t)},e.concat=function(e,n){return t.initString(e+n)},e.substring=function(e,n,i){return t.pxtrt.nullCheck(e),t.initString(e.slice(n,n+i))},e.equals=function(t,e){return t==e},e.compare=function(t,e){return t==e?0:t<e?-1:1},e.length=function(t){return t.length},e.isEmpty=function(t){return null==t||0==t.length},e.substr=function(e,n,i){return t.initString(e.substr(n,i))},e.charAt=function(e,n){return t.initString(e.charAt(n))},e.charCodeAt=function(e,i){return t.pxtrt.nullCheck(e),n(e,i)?e.charCodeAt(i):0}}(t.String_||(t.String_={}));!function(t){t.toString=function(t){return t?"true":"false"},t.bang=function(t){return!t}}(t.Boolean_||(t.Boolean_={}));var i=function(t){function e(e){t.call(this),this.data=e}return __extends(e,t),e.prototype.print=function(){console.log("RefBuffer id:"+this.id+" refs:"+this.refcnt+" len:"+this.data.length+" d0:"+this.data[0])},e}(t.RefObject);t.RefBuffer=i;!function(e){function n(e){switch(e){case l.Int8LE:return-1;case l.UInt8LE:return 1;case l.Int16LE:return-2;case l.UInt16LE:return 2;case l.Int32LE:return-4;case l.UInt32LE:return 4;case l.Int8BE:return-10;case l.UInt8BE:return 10;case l.Int16BE:return-20;case l.UInt16BE:return 20;case l.Int32BE:return-40;case l.UInt32BE:return 40;case l.Float32LE:return 4;case l.Float32BE:return 40;case l.Float64LE:return 8;case l.Float64BE:return 80;default:throw t.U.userError("bad format")}}function r(t){var e=n(t),i=!1;e<0&&(i=!0,e=-e);var r=!1;return e>=10&&(r=!0,e/=10),{size:e,signed:i,swap:r,isFloat:t>=l.Float32LE}}function o(t){return new i(new Uint8Array(t))}function s(t,e){return 0<=e&&e<t.data.length}function a(t,e,n,i){void 0===n&&(n=0),void 0===i&&(i=-1),n<0||n>t.data.length||(i<0&&(i=t.data.length),i=Math.min(i,t.data.length-n),t.data.fill(e,n,n+i))}function u(t,e,n,i,r){if(n.buffer===t.buffer)u(t,e,n.slice(i,i+r),0,r);else for(var o=0;o<r;++o)t[e+o]=n[i+o]}!function(t){t[t.Int8LE=1]="Int8LE",t[t.UInt8LE=2]="UInt8LE",t[t.Int16LE=3]="Int16LE",t[t.UInt16LE=4]="UInt16LE",t[t.Int32LE=5]="Int32LE",t[t.Int8BE=6]="Int8BE",t[t.UInt8BE=7]="UInt8BE",t[t.Int16BE=8]="Int16BE",t[t.UInt16BE=9]="UInt16BE",t[t.Int32BE=10]="Int32BE",t[t.UInt32LE=11]="UInt32LE",t[t.UInt32BE=12]="UInt32BE",t[t.Float32LE=13]="Float32LE",t[t.Float64LE=14]="Float64LE",t[t.Float32BE=15]="Float32BE",t[t.Float64BE=16]="Float64BE"}(e.NumberFormat||(e.NumberFormat={}));var l=e.NumberFormat;e.getNumber=function(t,e,n){var i=r(e);if(i.isFloat){var o=t.data.buffer.slice(n,n+i.size);return i.swap&&new Uint8Array(o).reverse(),4==i.size?new Float32Array(o)[0]:new Float64Array(o)[0]}for(var s=0,a=0;a<i.size;++a){s<<=8;var u=i.swap?n+a:n+i.size-a-1;s|=t.data[u]}if(i.signed){var l=32-8*i.size;s=s<<l>>l}else s>>>=0;return s},e.setNumber=function(t,e,n,i){var o=r(e);if(o.isFloat){var s=new Uint8Array(o.size);for(4==o.size?new Float32Array(s.buffer)[0]=i:new Float64Array(s.buffer)[0]=i,o.swap&&s.reverse(),a=0;a<o.size;++a)t.data[n+a]=s[a]}else for(var a=0;a<o.size;++a){var u=o.swap?n+o.size-a-1:n+a;t.data[u]=255&i,i>>=8}},e.createBuffer=o,e.createBufferFromHex=function(t){for(var e=o(t.length>>1),n=0;n<t.length;n+=2)e.data[n>>1]=parseInt(t.slice(n,n+2),16);return e},e.getBytes=function(t){return t.data},e.getByte=function(t,e){return s(t,e)?t.data[e]:0},e.setByte=function(t,e,n){s(t,e)&&(t.data[e]=n)},e.length=function(t){return t.data.length},e.fill=a,e.slice=function(t,e,n){return e=Math.min(t.data.length,e),n<0&&(n=t.data.length),n=Math.min(n,t.data.length-e),new i(t.data.slice(e,e+n))},e.toHex=function(t){for(var e="0123456789abcdef",n=0;n<t.data.length;++n)(void 0)[n<<1]=e[t.data[n]>>4],(void 0)[1+(n<<1)]=e[15&t.data[n]]};var c=-2147483648;e.shift=function(t,e,n,i){i<0&&(i=t.data.length-n),n<0||n+i>t.data.length||n+i<n||0==i||0==e||e==c||0!=i&&0!=e&&e!=c&&(e<=-i||e>=i?a(t,0):e<0?(e=-e,u(t.data,n+e,t.data,n,i-e),t.data.fill(0,n,n+e)):(i-=e,u(t.data,n,t.data,n+e,i),t.data.fill(0,n+i,n+i+e)))},e.rotate=function(t,e,n,i){if(i<0&&(i=t.data.length-n),!(n<0||n+i>t.data.length||n+i<n||0==i||0==e||e==c)){e<0&&(e+=i<<8),(e%=i)<0&&(e+=i);for(var r=t.data,o=e,s=0,a=o,u=i;s!=a;){var l=r[s+n];r[s+++n]=r[a+n],r[a+++n]=l,a==u?a=o:s==o&&(o=a)}}},e.write=function(t,e,n,i,r){void 0===i&&(i=0),void 0===r&&(r=-1),r<0&&(r=n.data.length),i<0||e<0||e>t.data.length||(r=Math.min(n.data.length-i,t.data.length-e))<0||u(t.data,e,n.data,i,r)}}(t.BufferMethods||(t.BufferMethods={}))}(pxsim||(pxsim={}));var pxsim;!function(t){!function(t){var e={};t.setLocalizedStrings=function(t){e=t||{}},t.lf=function(t){return e[t]||t}}(t.localization||(t.localization={}))}(pxsim||(pxsim={}));var pxsim;!function(pxsim){function getResume(){return pxsim.runtime.getResume()}function initBareRuntime(){pxsim.runtime.board=new BareBoard;var t=pxsim;t.basic={pause:pxsim.thread.pause,showNumber:function(t){var e=getResume();console.log("SHOW NUMBER:",t),U.nextTick(e)}},t.serial={writeString:function(t){return pxsim.runtime.board.writeSerial(t)}},t.pins={createBuffer:pxsim.BufferMethods.createBuffer},t.control={inBackground:pxsim.thread.runInBackground}}var U;!function(t){t.addClass=function(t,e){t.classList?t.classList.add(e):t.className.indexOf(e)<0&&(t.className+=" "+e)},t.removeClass=function(t,e){t.classList?t.classList.remove(e):t.className=t.className.replace(e,"").replace(/\s{2,}/," ")},t.assert=function(t,e){if(void 0===e&&(e="Assertion failed"),!t)throw new Error(e)},t.repeatMap=function(t,e){t=t||0;for(var n=[],i=0;i<t;++i)n.push(e(i));return n},t.userError=function(t){var e=new Error(t);throw e.isUserError=!0,e},t.now=function(){return Date.now()},t.nextTick=function(t){Promise._async._schedule(t)}}(U=pxsim.U||(pxsim.U={})),pxsim.getResume=getResume;var SERIAL_BUFFER_LENGTH=16,BaseBoard=function(){function t(){this.serialOutBuffer=""}return t.prototype.updateView=function(){},t.prototype.receiveMessage=function(t){},t.prototype.initAsync=function(t){return this.runOptions=t,Promise.resolve()},t.prototype.kill=function(){},t.prototype.writeSerial=function(t){t&&(this.serialOutBuffer+=t,(/\n/.test(this.serialOutBuffer)||this.serialOutBuffer.length>SERIAL_BUFFER_LENGTH)&&(Runtime.postMessage({type:"serial",data:this.serialOutBuffer,id:pxsim.runtime.id,sim:!0}),this.serialOutBuffer=""))},t}();pxsim.BaseBoard=BaseBoard;var CoreBoard=function(t){function e(){var e=this;t.call(this),this.id="b"+Math.round(2147483647*Math.random()),this.bus=new pxsim.EventBus(pxsim.runtime),this.updateSubscribers=[],this.updateView=function(){e.updateSubscribers.forEach(function(t){return t()})},this.builtinParts={},this.builtinVisuals={},this.builtinPartVisuals={}}return __extends(e,t),e.prototype.kill=function(){t.prototype.kill.call(this),pxsim.AudioContextManager.stop()},e}(BaseBoard);pxsim.CoreBoard=CoreBoard;var BareBoard=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(BaseBoard);pxsim.initBareRuntime=initBareRuntime;var EventQueue=function(){function t(t){this.runtime=t,this.max=5,this.events=[],this.awaiters=[]}return t.prototype.push=function(t,e){if(this.awaiters.length>0)if(e){var n=this.awaiters.shift();n&&n()}else{var i=this.awaiters.slice();this.awaiters=[],i.forEach(function(t){return t()})}!this.handler||this.events.length>this.max||(this.events.push(t),1!=this.events.length||this.lock||this.poke())},t.prototype.poke=function(){var t=this;this.lock=!0;var e=this.events.shift();this.runtime.runFiberAsync(this.handler,e).done(function(){t.events.length>0?t.poke():t.lock=!1})},Object.defineProperty(t.prototype,"handler",{get:function(){return this.mHandler},set:function(t){this.mHandler&&pxsim.pxtcore.decr(this.mHandler),this.mHandler=t,this.mHandler&&pxsim.pxtcore.incr(this.mHandler)},enumerable:!0,configurable:!0}),t.prototype.addAwaiter=function(t){this.awaiters.push(t)},t}();pxsim.EventQueue=EventQueue,pxsim.initCurrentRuntime=void 0,pxsim.handleCustomMessage=void 0;var Runtime=function(){function Runtime(msg){function oops(t){throw new Error("sim error: "+t)}function doNothing(t){return t.pc=-1,leave(t,t.parent.retval)}function maybeYield(t,e,n){yieldSteps=yieldMaxSteps;var i=Date.now();if(i-lastYield>=20){lastYield=i,t.pc=e,t.r0=n;return setTimeout(function(){if(!__this.dead)return U.assert(t.pc==e),loop(t)},5),!0}return!1}function setupDebugger(t){breakpoints=new Uint8Array(t),breakAlways=!0}function isBreakFrame(t){if(!breakFrame)return!0;for(var e=breakFrame;e;e=e.parent)if(e==t)return!0;return!1}function breakpoint(t,e,n,i){return U.assert(!dbgResume),t.pc=e,t.r0=i,Runtime.postMessage(pxsim.getBreakpointMsg(t,n)),dbgResume=function(n){if(dbgResume=null,!__this.dead){switch(pxsim.runtime=__this,U.assert(t.pc==e),breakAlways=!1,breakFrame=null,n.subtype){case"resume":break;case"stepover":breakAlways=!0,breakFrame=t;break;case"stepinto":breakAlways=!0;break;case"stepout":breakAlways=!0,breakFrame=t.parent||t}return loop(t)}},null}function trace(t,e,n,i){setupResume(e,n),"<main>"===i.functionName||"main.ts"===i.fileName?(Runtime.postMessage({type:"debugger",subtype:"trace",breakpointId:t}),pxsim.thread.pause(tracePauseMs)):pxsim.thread.pause(0),checkResumeConsumed()}function handleDebuggerMsg(t){switch(t.subtype){case"config":var e=t;if(e.setBreakpoints){breakpoints.fill(0);for(var n=0,i=e.setBreakpoints;n<i.length;n++){var r=i[n];breakpoints[r]=1}}break;case"traceConfig":tracePauseMs=t.interval;break;case"pause":breakAlways=!0,breakFrame=null;break;case"resume":case"stepover":case"stepinto":case"stepout":dbgResume&&dbgResume(t)}}function loop(t){if(__this.dead)console.log("Runtime terminated");else try{for(pxsim.runtime=__this;t;)__this.currFrame=t,__this.currFrame.overwrittenPC=!1,t=t.fn(t),__this.maybeUpdateDisplay(),__this.currFrame.overwrittenPC&&(t=__this.currFrame)}catch(n){if(__this.errorHandler)__this.errorHandler(n);else{console.error("Simulator crashed, no error handler",n.stack);var e=pxsim.getBreakpointMsg(t,t.lastBrkId);e.exceptionMessage=n.message,e.exceptionStack=n.stack,Runtime.postMessage(e),__this.postError&&__this.postError(n)}}}function actionCall(t,e){return e&&(t.finalCallback=e),t.depth=t.parent.depth+1,t.depth>1e3&&U.userError("Stack overflow"),t.pc=0,t}function leave(t,e){return t.parent.retval=e,t.finalCallback&&t.finalCallback(e),t.parent}function setupTop(t){var e=setupTopCore(t);return setupResume(e,0),e}function setupTopCore(t){var e={parent:null,pc:0,depth:0,fn:function(){return t&&t(e.retval),null}};return e}function topCall(t,e){U.assert(!!__this.board),U.assert(!__this.running),__this.setRunning(!0),loop(actionCall({parent:setupTopCore(e),fn:t,depth:0,pc:0}))}function checkResumeConsumed(){currResume&&oops("getResume() not called")}function setupResume(t,e){currResume=buildResume(t,e)}function buildResume(t,e){return currResume&&oops("already has resume"),t.pc=e,function(n){if(!__this.dead){if(pxsim.runtime=__this,U.assert(t.pc==e),n instanceof pxsim.FnWrapper){var i=n;return loop(actionCall({parent:t,fn:i.func,lambdaArgs:[i.a0,i.a1,i.a2],pc:0,caps:i.caps,depth:t.depth+1,finalCallback:i.cb}))}return t.retval=n,loop(t)}}}var _this=this;this.numGlobals=1e3,this.dead=!1,this.running=!1,this.startTime=0,this.globals={},this.refCountingDebug=!1,this.refCounting=!0,this.refObjId=1,this.liveRefObjs={},this.stringRefCounts={},this.numDisplayUpdates=0,U.assert(!!pxsim.initCurrentRuntime),this.id=msg.id,this.refCountingDebug=!!msg.refCountingDebug;var yieldMaxSteps=100,entryPoint,pxtrt=pxsim.pxtrt,breakpoints=null,breakAlways=!1,globals=this.globals,yieldSteps=yieldMaxSteps,currResume,dbgResume,breakFrame=null,lastYield=Date.now(),__this=this,tracePauseMs=0;eval(msg.code),this.run=function(t){return topCall(entryPoint,t)},this.getResume=function(){currResume||oops("noresume");var t=currResume;return currResume=null,t},this.setupTop=setupTop,this.handleDebuggerMsg=handleDebuggerMsg,this.entry=entryPoint,this.overwriteResume=function(t){currResume=null,t>=0&&(_this.currFrame.pc=t),_this.currFrame.overwrittenPC=!0},pxsim.runtime=this,pxsim.initCurrentRuntime(msg)}return Runtime.prototype.registerLiveObject=function(t){var e=this.refObjId++;return this.refCounting&&(this.liveRefObjs[e+""]=t),e},Runtime.prototype.unregisterLiveObject=function(t){U.assert(0==t.refcnt,"ref count is not 0"),delete this.liveRefObjs[t.id+""]},Runtime.prototype.runningTime=function(){return U.now()-this.startTime},Runtime.prototype.runFiberAsync=function(t,e,n,i){var r=this;return pxsim.incr(t),new Promise(function(o,s){return U.nextTick(function(){pxsim.runtime=r,r.setupTop(o),pxsim.pxtcore.runAction3(t,e,n,i),pxsim.decr(t)})})},Runtime.postMessage=function(t){t&&("undefined"!=typeof window&&window.parent&&window.parent.postMessage&&window.parent.postMessage(t,"*"),Runtime.messagePosted&&Runtime.messagePosted(t))},Runtime.prototype.kill=function(){this.dead=!0,this.setRunning(!1)},Runtime.prototype.updateDisplay=function(){this.board.updateView()},Runtime.prototype.queueDisplayUpdate=function(){this.numDisplayUpdates++},Runtime.prototype.maybeUpdateDisplay=function(){this.numDisplayUpdates&&(this.numDisplayUpdates=0,this.updateDisplay())},Runtime.prototype.setRunning=function(t){this.running!=t&&(this.running=t,this.running?(this.startTime=U.now(),Runtime.postMessage({type:"status",runtimeid:this.id,state:"running"})):Runtime.postMessage({type:"status",runtimeid:this.id,state:"killed"}),this.stateChanged&&this.stateChanged())},Runtime.prototype.dumpLivePointers=function(){var t=this;if(this.refCounting&&this.refCountingDebug){var e=Object.keys(this.liveRefObjs),n=Object.keys(this.stringRefCounts);console.log("Live objects: "+e.length+" objects, "+n.length+" strings"),e.forEach(function(e){return t.liveRefObjs[e].print()}),n.forEach(function(e){var n=t.stringRefCounts[e];console.log("Live String:",JSON.stringify(e),"refcnt=",n)})}},Runtime}();pxsim.Runtime=Runtime}(pxsim||(pxsim={}));var pxsim;!function(t){!function(t){t[t.Unloaded=0]="Unloaded",t[t.Stopped=1]="Stopped",t[t.Running=2]="Running",t[t.Paused=3]="Paused"}(t.SimulatorState||(t.SimulatorState={}));var e=t.SimulatorState;!function(t){t[t.StepInto=0]="StepInto",t[t.StepOver=1]="StepOver",t[t.StepOut=2]="StepOut",t[t.Resume=3]="Resume",t[t.Pause=4]="Pause"}(t.SimulatorDebuggerCommand||(t.SimulatorDebuggerCommand={}));var n=t.SimulatorDebuggerCommand,i=function(){function i(t,n){void 0===n&&(n={}),this.container=t,this.options=n,this.themes=["blue","red","green","yellow"],this.runId="",this.nextFrameId=0,this.frameCounter=0,this.traceInterval=0,this.runOptions={},this.state=e.Unloaded,this.frameCleanupTimeout=0}return i.prototype.setHwDebugger=function(t){t?(this.hwdbg=t,this.setState(e.Running),this.container.style.opacity="0.3"):(delete this.container.style.opacity,this.hwdbg=null,this.setState(e.Running),this.stop())},i.prototype.handleHwDebuggerMsg=function(t){this.hwdbg&&this.handleMessage(t)},i.prototype.setThemes=function(e){t.U.assert(e&&e.length>0),this.themes=e},i.prototype.setState=function(t){this.state!=t&&(this.state=t,this.options.onStateChanged&&this.options.onStateChanged(this.state))},i.prototype.postMessage=function(t,e){if(this.hwdbg)this.hwdbg.postMessage(t);else{var n=this.container.getElementsByTagName("iframe");!e||"eventbus"!==t.type&&"radiopacket"!=t.type&&"irpacket"!=t.type||(n.length<2?(this.container.appendChild(this.createFrame()),n=this.container.getElementsByTagName("iframe")):n[1].dataset.runid!=this.runId&&this.startFrame(n[1]));for(var i=0;i<n.length;++i){var r=n[i];e&&r.contentWindow==e||r.contentWindow.postMessage(t,"*")}}},i.prototype.createFrame=function(){var t=document.createElement("div");t.className="simframe";var e=document.createElement("iframe");e.id="sim-frame-"+this.nextId(),e.allowFullscreen=!0,e.setAttribute("sandbox","allow-same-origin allow-scripts"),e.sandbox.value="allow-scripts allow-same-origin";var n=this.options.simUrl||(window.pxtConfig||{}).simUrl||"/sim/simulator.html";return this.runOptions.aspectRatio&&(t.style.paddingBottom=100/this.runOptions.aspectRatio+"%"),e.src=n+"#"+e.id,e.frameBorder="0",e.dataset.runid=this.runId,t.appendChild(e),t},i.prototype.stop=function(n){if(void 0===n&&(n=!1),this.postMessage({type:"stop"}),this.setState(e.Stopped),n)this.unload();else{for(var i=this.container.getElementsByTagName("iframe"),r=0;r<i.length;++r){var o=i[r];t.U.addClass(o,this.getStoppedClass())}this.scheduleFrameCleanup()}},i.prototype.unload=function(){this.cancelFrameCleanup(),this.container.innerHTML="",this.setState(e.Unloaded)},i.prototype.mute=function(t){this.postMessage({type:"mute",mute:t})},i.prototype.cancelFrameCleanup=function(){this.frameCleanupTimeout&&(clearTimeout(this.frameCleanupTimeout),this.frameCleanupTimeout=0)},i.prototype.scheduleFrameCleanup=function(){var t=this;this.cancelFrameCleanup(),this.frameCleanupTimeout=setTimeout(function(){t.frameCleanupTimeout=0,t.cleanupFrames()},5e3)},i.prototype.applyAspectRatio=function(){for(var t=this.container.getElementsByTagName("iframe"),e=0;e<t.length;++e)t[e].parentElement.style.paddingBottom=100/this.runOptions.aspectRatio+"%"},i.prototype.cleanupFrames=function(){for(var t=this.container.getElementsByTagName("iframe"),n=1;n<t.length;++n){var i=t[n];this.state!=e.Stopped&&i.dataset.runid==this.runId||(this.options.removeElement?this.options.removeElement(i.parentElement):i.parentElement.remove())}},i.prototype.hide=function(t){if(this.options.removeElement){for(var e=this.container.getElementsByTagName("iframe"),n=0;n<e.length;++n){var i=e[n];this.options.removeElement(i.parentElement,t)}0==e.length&&t&&t()}},i.prototype.unhide=function(){if(this.options.unhideElement)for(var t=this.container.getElementsByTagName("iframe"),e=0;e<t.length;++e){var n=t[e];this.options.unhideElement(n.parentElement)}},i.prototype.run=function(t,n){void 0===n&&(n={}),this.runOptions=n,this.runId=this.nextId(),this.addEventListeners(),this.currentRuntime={type:"run",boardDefinition:n.boardDefinition,parts:n.parts,fnArgs:n.fnArgs,code:t,partDefinitions:n.partDefinitions,mute:n.mute,highContrast:n.highContrast,cdnUrl:n.cdnUrl,localizedStrings:n.localizedStrings,refCountingDebug:n.refCountingDebug},this.applyAspectRatio(),this.scheduleFrameCleanup();var i=this.container.getElementsByTagName("iframe").item(0);if(i)this.startFrame(i);else{var r=this.createFrame();this.container.appendChild(r),i=r.firstElementChild}this.setState(e.Running),this.setTraceInterval(this.traceInterval)},i.prototype.startFrame=function(e){var n=JSON.parse(JSON.stringify(this.currentRuntime)),i="",r=/player=([A-Za-z0-9]+)/i.exec(window.location.href);r&&(i=r[1]),n.frameCounter=++this.frameCounter,n.options={theme:this.themes[this.nextFrameId++%this.themes.length],player:i},n.id=n.options.theme+"-"+this.nextId(),e.dataset.runid=this.runId,e.contentWindow.postMessage(n,"*"),t.U.removeClass(e,this.getStoppedClass())},i.prototype.removeEventListeners=function(){this.listener&&(window.removeEventListener("message",this.listener,!1),this.listener=void 0)},i.prototype.handleMessage=function(t,e){switch(t.type||""){case"ready":var n=t.frameid,i=document.getElementById(n);i&&(this.startFrame(i),this.options.revealElement&&this.options.revealElement(i));break;case"simulator":this.handleSimulatorCommand(t);break;case"serial":break;case"pxteditor":case"custom":break;case"debugger":this.handleDebuggerMessage(t);break;case"toplevelcodefinished":this.options.onTopLevelCodeEnd&&this.options.onTopLevelCodeEnd();break;default:"radiopacket"==t.type&&(t.rssi=10),this.postMessage(t,e)}},i.prototype.addEventListeners=function(){var t=this;this.listener||(this.listener=function(e){t.hwdbg||t.handleMessage(e.data,e.source)},window.addEventListener("message",this.listener,!1))},i.prototype.resume=function(t){var i;switch(t){case n.Resume:i="resume",this.setState(e.Running);break;case n.StepInto:i="stepinto",this.setState(e.Running);break;case n.StepOut:i="stepout",this.setState(e.Running);break;case n.StepOver:i="stepover",this.setState(e.Running);break;case n.Pause:i="pause";break;default:return void console.debug("unknown command")}this.postMessage({type:"debugger",subtype:i})},i.prototype.setBreakpoints=function(t){this.postDebuggerMessage("config",{setBreakpoints:t})},i.prototype.setTraceInterval=function(t){this.traceInterval=t,this.postDebuggerMessage("traceConfig",{interval:t})},i.prototype.handleSimulatorCommand=function(t){this.options.onSimulatorCommand&&this.options.onSimulatorCommand(t)},i.prototype.handleDebuggerMessage=function(t){switch("trace"!==t.subtype&&console.log("DBG-MSG",t.subtype,t),t.subtype){case"warning":this.options.onDebuggerWarning&&this.options.onDebuggerWarning(t);break;case"breakpoint":var n=t;this.state==e.Running?(n.exceptionMessage?this.stop():this.setState(e.Paused),this.options.onDebuggerBreakpoint&&this.options.onDebuggerBreakpoint(n)):console.error("debugger: trying to pause from "+this.state);break;case"trace":this.options.onTraceMessage&&this.options.onTraceMessage(t)}},i.prototype.postDebuggerMessage=function(t,e){void 0===e&&(e={});var n=JSON.parse(JSON.stringify(e));n.type="debugger",n.subtype=t,this.postMessage(n)},i.prototype.nextId=function(){return this.nextFrameId+++(Math.random()+""+Math.random()).replace(/[^\d]/,"")},i.prototype.getStoppedClass=function(){return this.options&&this.options.stoppedClass?this.options.stoppedClass:"grayscale"},i}();t.SimulatorDriver=i}(pxsim||(pxsim={}));var pxsim;!function(t){function e(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator&&navigator.maxTouchPoints>0)}function n(){return"undefined"!=typeof window&&!!window.PointerEvent}t.mkRange=function(t,e){for(var n=[];t<e;t++)n.push(t);return n},t.parseQueryString=function(){var t=window.location.search.substring(1);return function(e){return decodeURIComponent((t.split(e+"=")[1]||"").split("&")[0]||"")}};var i=function(){function e(t){this.runtime=t,this.queues={},this.nextNotifyEvent=1024}return e.prototype.setNotify=function(t,e){this.notifyID=t,this.notifyOneID=e},e.prototype.start=function(e,n,i){var r=e+":"+n,o=this.queues[r];return o||(o=this.queues[r]=new t.EventQueue(this.runtime)),o},e.prototype.listen=function(t,e,n){this.start(t,e,!0).handler=n},e.prototype.queue=function(t,e,n){void 0===n&&(n=0);var i=this.notifyID&&this.notifyOneID&&t==this.notifyOneID;i&&(t=this.notifyID);var r=this.start(t,e,!1);r&&r.push(n,i)},e.prototype.wait=function(t,e,n){this.start(t,e,!0).addAwaiter(n)},e}();t.EventBus=i;var r=function(){function e(t){var e=this;this.runtime=t,this.queue=[],this.process=function(){var n=e.queue[0];if(n&&!e.runtime.dead){t=e.runtime;var i=n.frame();t.queueDisplayUpdate(),t.maybeUpdateDisplay(),!1===i?(e.queue.shift(),e.queue[0]&&(e.queue[0].setTimeoutHandle=setTimeout(e.process,e.queue[0].interval)),n.whenDone(!1)):n.setTimeoutHandle=setTimeout(e.process,n.interval)}}}return e.prototype.cancelAll=function(){var t=this.queue;this.queue=[];for(var e=0,n=t;e<n.length;e++){var i=n[e];i.whenDone(!0),i.setTimeoutHandle&&clearTimeout(i.setTimeoutHandle)}},e.prototype.cancelCurrent=function(){var t=this.queue[0];t&&(this.queue.shift(),t.whenDone(!0),t.setTimeoutHandle&&clearTimeout(t.setTimeoutHandle))},e.prototype.enqueue=function(t){t.whenDone||(t.whenDone=function(){}),this.queue.push(t),1==this.queue.length&&this.process()},e.prototype.executeAsync=function(e){var n=this;return t.U.assert(!e.whenDone),new Promise(function(t,i){e.whenDone=t,n.enqueue(e)})},e}();t.AnimationQueue=r;!function(t){function e(){return r||(r=n()),r}function n(){if(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext)try{return new window.AudioContext}catch(t){}}function i(){s&&(s.gain.value=0),a=0}var r,o,s,a=0,u=!1;t.mute=function(t){u=t,i()},t.stop=i,t.frequency=function(){return a},t.tone=function(t,n){if(!(u||t<=0)){a=t;var i=e();if(i){o&&(o.stop(),o.disconnect(),o=void 0),n=Math.max(0,Math.min(1,n));try{o=i.createOscillator(),s=i.createGain(),o.type="triangle",o.connect(s),s.connect(i.destination),s.gain.value=n,o.start(0)}catch(t){return o=void 0,void(s=void 0)}o.frequency.value=t,s.gain.value=n}}}}(t.AudioContextManager||(t.AudioContextManager={})),t.isTouchEnabled=e,t.hasPointerEvents=n,t.pointerEvents=n()?{up:"pointerup",down:"pointerdown",move:"pointermove",leave:"pointerleave"}:e()?{up:"mouseup",down:"touchstart",move:"touchmove",leave:"touchend"}:{up:"mouseup",down:"mousedown",move:"mousemove",leave:"mouseleave"}}(pxsim||(pxsim={}));var pxsim;!function(t){!function(e){function n(t,e){return function(n){return n*(e/t)}}function i(t,e){var n=t[0]-e[0],i=t[1]-e[1];return n*n+i*i}e.translateEl=function(e,n){t.svg.hydrate(e,{transform:"translate("+n[0]+" "+n[1]+")"})},e.composeSVG=function(e){var n=[e.el1,e.el2],i=n[0],r=n[1];t.U.assert(0==i.x&&0==i.y&&0==r.x&&0==r.y,"el1 and el2 x,y offsets not supported");var o=function(e,n,i){return t.svg.hydrate(e,{x:n,y:i})},s=function(e,n,i){return t.svg.hydrate(e,{width:n+"px",height:i+"px"})},a=e.scaleUnit2,u=e.scaleUnit2/e.scaleUnit1,l=i.w*u,c=i.h*u;s(i.el,l,c);var p=1*r.w,d=1*r.h;s(r.el,p,d);var h=e.margin,f=h[0],m=h[1],v=h[2],g=h[3],b=e.middleMargin,y=Math.max(l,p),w=m+(y-l)/2,x=f;o(i.el,w,x);var C=m+(y-p)/2,R=x+c+b;o(r.el,C,R);var k=[x,x+c,R,R+d],I=m+y+g,E=f+c+b+d+v,B=t.svg.elt("svg",{version:"1.0",viewBox:"0 0 "+I+" "+E,class:"sim-bb"});!function(e,n,i){n&&t.svg.hydrate(e,{width:n}),i&&t.svg.hydrate(e,{height:i})}(B,e.maxWidth,e.maxHeight),o(B,0,0);var D=t.svg.child(B,"g");B.appendChild(i.el),B.appendChild(r.el);return{under:D,over:t.svg.child(B,"g"),host:B,edges:k,scaleUnit:a,toHostCoord1:function(t){var e=t[0],n=t[1];return[e*u+w,n*u+x]},toHostCoord2:function(t){var e=t[0],n=t[1];return[1*e+C,1*n+R]}}},e.mkScaleFn=n,e.mkImageSVG=function(e){var i=n(e.imageUnitDist,e.targetUnitDist),r=i(e.width),o=i(e.height),s=t.svg.elt("image",{width:r,height:o});s.setAttributeNS("http://www.w3.org/1999/xlink","href",""+e.image);return{el:s,w:r,h:o,x:0,y:0}},e.findDistSqrd=i,e.findClosestCoordIdx=function(t,e){return e.map(function(e){return i(t,e)}).reduce(function(t,e,n,i){return e<i[t]?n:t},0)},e.mkTxt=function(e,n,i,r,o,s,a){var u=t.svg.elt("text");s=s||-.33333,a=a||.3;var l=s*i*o.length,c=a*i;return t.svg.hydrate(u,{style:"font-size:"+i+"px;",transform:"translate("+e+" "+n+") rotate("+r+") translate("+l+" "+c+")"}),t.svg.addClass(u,"noselect"),u.textContent=o,u},e.GPIO_WIRE_COLORS=["pink","orange","yellow","green","purple"],e.WIRE_COLOR_MAP={black:"#514f4d",white:"#fcfdfc",gray:"#acabab",purple:"#a772a1",blue:"#01a6e8",green:"#3cce73",yellow:"#ece600",orange:"#fdb262",red:"#f44f43",brown:"#c89764",pink:"#ff80fa"},e.mapWireColor=function(t){return e.WIRE_COLOR_MAP[t]||t},e.PIN_DIST=15,e.rgbToHsl=function(t){var e,n,i,r=[t[0]/255,t[1]/255,t[2]/255],o=r[0],s=r[1],a=r[2],u=Math.min(o,s,a),l=Math.max(o,s,a),c=l-u,p=l+u;return i=p/2*100,0===c?n=e=0:(l===o?e=(s-a)/c%6*60:l===s?e=60*((a-o)/c+2):l===a&&(e=60*((o-s)/c+4)),n=i>50?c/(2-p)*100:c/p*100),[Math.floor(e),Math.floor(n),Math.floor(i)]}}(t.visuals||(t.visuals={}))}(pxsim||(pxsim={}));var pxsim;!function(t){var e;!function(t){function n(t,n,i){var r={class:t,d:n};i&&(r.title=i);var o=e.elt("path");return e.hydrate(o,r),o}function i(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator.maxTouchPoints>0)}function r(t,n){void 0===n&&(n=!1);var i=e.elt("linearGradient");e.hydrate(i,{id:t,x1:"0%",y1:"0%",x2:n?"100%":"0%",y2:n?"0%":"100%"});e.child(i,"stop",{offset:"0%"}),e.child(i,"stop",{offset:"100%"}),e.child(i,"stop",{offset:"100%"}),e.child(i,"stop",{offset:"100%"});return i}function o(t){var n=e.elt("title");return n.textContent=t,n}t.parseString=function(t){return(new DOMParser).parseFromString(t,"image/svg+xml").getElementsByTagName("svg").item(0)},t.toDataUri=function(t){return"data:image/svg+xml,"+encodeURI(t)};t.cursorPoint=function(t,e,n){return t.x=n.clientX,t.y=n.clientY,t.matrixTransform(e.getScreenCTM().inverse())},t.rotateElement=function(t,e,n,i){t.setAttribute("transform","translate("+e+","+n+") rotate("+(i+90)+") translate("+-e+","+-n+")")},t.hasClass=function(t,e){return t.classList?t.classList.contains(e):t.className.baseVal.indexOf(e)>-1},t.addClass=function(t,e){t.classList?t.classList.add(e):t.className.baseVal.indexOf(e)<0&&(t.className.baseVal+=" "+e)},t.removeClass=function(t,e){t.classList?t.classList.remove(e):t.className.baseVal=t.className.baseVal.replace(e,"").replace(/\s{2,}/," ")},t.hydrate=function(t,n){for(var i in n)"title"==i?e.title(t,n[i]):t.setAttributeNS(null,i,n[i])},t.elt=function(t,n){var i=document.createElementNS("http://www.w3.org/2000/svg",t);return n&&e.hydrate(i,n),i},t.child=function(t,n,i){var r=e.elt(n,i);return t.appendChild(r),r},t.mkPath=n,t.path=function(t,e,i,r){var o=n(e,i,r);return t.appendChild(o),o},t.fill=function(t,e){t.style.fill=e},t.filter=function(t,e){t.style.filter=e},t.fills=function(t,e){t.forEach(function(t){return t.style.fill=e})},t.isTouchEnabled=i,t.touchEvents=i()?{mousedown:["mousedown","touchstart"],mouseup:["mouseup","touchend"],mousemove:["mousemove","touchmove"],mouseleave:["mouseleave","touchcancel"]}:{mousedown:["mousedown"],mouseup:["mouseup"],mousemove:["mousemove"],mouseleave:["mouseleave"]},t.onClick=function(e,n){var i=!1;t.touchEvents.mousedown.forEach(function(t){return e.addEventListener(t,function(t){return i=!0,!0},!1)}),t.touchEvents.mouseup.forEach(function(t){return e.addEventListener(t,function(t){return!i||(i=!1,n(t),t.preventDefault(),!1)},!1)})},t.buttonEvents=function(e,n,i,r,o){var s=!1;t.touchEvents.mousedown.forEach(function(t){return e.addEventListener(t,function(t){return s=!0,i&&i(t),!0},!1)}),t.touchEvents.mousemove.forEach(function(t){return e.addEventListener(t,function(t){return!s||(n&&n(t),t.preventDefault(),!1)},!1)}),t.touchEvents.mouseup.forEach(function(t){return e.addEventListener(t,function(t){s=!1,r&&r(t)},!1)}),t.touchEvents.mouseleave.forEach(function(t){return e.addEventListener(t,function(t){s=!1,r&&r(t)},!1)}),e.addEventListener("keydown",function(t){s=!1,o&&o(t)})},t.mkLinearGradient=r,t.linearGradient=function(t,e,n){void 0===n&&(n=!1);var i=r(e,n);return t.appendChild(i),i},t.setGradientColors=function(t,e,n){t&&(t.childNodes[0].style.stopColor=e,t.childNodes[1].style.stopColor=e,t.childNodes[2].style.stopColor=n,t.childNodes[3].style.stopColor=n)},t.setGradientValue=function(t,e){t.childNodes[1].getAttribute("offset")!=e&&(t.childNodes[1].setAttribute("offset",e),t.childNodes[2].setAttribute("offset",e))},t.animate=function(t,n){e.addClass(t,n);var i=t.parentElement;i&&(i.removeChild(t),i.appendChild(t))},t.mkTitle=o,t.title=function(t,e){var n=o(e);return t.appendChild(n),n},t.toHtmlColor=function(t){return"rgba("+(t>>16&255)+", "+(t>>8&255)+", "+(255&t)+", "+(t>>24&1)+")"}}(e=t.svg||(t.svg={}))}(pxsim||(pxsim={}));var pxsim;!function(t){var e=function(){return function(t){this.id=t}}();t.Button=e;var n=function(){return function(t){this.props=t,this.usesButtonAB=!1,this.aBtn=new e(this.props.ID_BUTTON_A),this.bBtn=new e(this.props.ID_BUTTON_B),this.abBtn=new e(this.props.ID_BUTTON_AB),this.abBtn.virtual=!0}}();t.ButtonPairState=n}(pxsim||(pxsim={}));var pxsim;!function(t){var e=function(){return function(){this.usesHeading=!1,this.heading=90}}();t.CompassState=e}(pxsim||(pxsim={}));var pxsim;!function(t){!function(t){t[t.Unused=0]="Unused",t[t.Digital=1]="Digital",t[t.Analog=2]="Analog",t[t.Input=4]="Input",t[t.Output=8]="Output",t[t.Touch=16]="Touch"}(t.PinFlags||(t.PinFlags={}));var e=t.PinFlags,n=function(){function n(t){this.id=t,this.touched=!1,this.value=0,this.period=0,this.servoAngle=0,this.mode=e.Unused,this.pitch=!1,this.pull=0}return n.prototype.digitalReadPin=function(){return this.mode=e.Digital|e.Input,this.value>100?1:0},n.prototype.digitalWritePin=function(n){this.mode=e.Digital|e.Output,this.value=n>0?200:0,t.runtime.queueDisplayUpdate()},n.prototype.setPull=function(t){this.pull=t},n.prototype.analogReadPin=function(){return this.mode=e.Analog|e.Input,this.value||0},n.prototype.analogWritePin=function(n){this.mode=e.Analog|e.Output,this.value=Math.max(0,Math.min(1023,n)),t.runtime.queueDisplayUpdate()},n.prototype.analogSetPeriod=function(n){this.mode=e.Analog|e.Output,this.period=n,t.runtime.queueDisplayUpdate()},n.prototype.servoWritePin=function(e){this.analogSetPeriod(2e4),this.servoAngle=Math.max(0,Math.min(180,e)),t.runtime.queueDisplayUpdate()},n.prototype.servoSetPulse=function(t,e){},n.prototype.isTouched=function(){return this.mode=e.Touch|e.Analog|e.Input,this.touched},n}();t.Pin=n;var i=function(){function t(t){this.props=t,this.pins=t.pins.map(function(t){return void 0!=t?new n(t):null})}return t.prototype.getPin=function(t){return this.pins.filter(function(e){return e&&e.id==t})[0]||null},t}();t.EdgeConnectorState=i}(pxsim||(pxsim={}));var pxsim;!function(t){var e=function(){function t(){this.files={}}return t.prototype.append=function(t,e){this.files[t]=(this.files[t]||"")+e},t.prototype.remove=function(t){delete this.files[t]},t}();t.FileSystemState=e}(pxsim||(pxsim={}));var pxsim;!function(t){var e=function(){return function(){this.usesLightLevel=!1,this.lightLevel=128}}();t.LightSensorState=e}(pxsim||(pxsim={}));var pxsim;!function(t){!function(t){t[t.RGB=0]="RGB",t[t.RGBW=1]="RGBW"}(t.NeoPixelMode||(t.NeoPixelMode={}));var e=t.NeoPixelMode,n=function(){function t(){this.buffers={},this.colors={},this.dirty={}}return t.prototype.updateBuffer=function(t,e){this.buffers[e]=t,this.dirty[e]=!0},t.prototype.getColors=function(t,e){var n=this.colors[t]||(this.colors[t]=[]);if(this.dirty[t]){var i=this.buffers[t]||(this.buffers[t]=new Uint8Array([]));this.readNeoPixelBuffer(i,n,e),this.dirty[t]=!1}return n},t.prototype.readNeoPixelBuffer=function(t,n,i){for(var r=t,o=i===e.RGBW?4:3,s=Math.floor(r.length/o),a=0;a<s;a++){var u=r[a*o+1],l=r[a*o+0],c=r[a*o+2],p=0;4===o&&(p=r[a*o+3]),n[a]=[u,l,c,p]}},t}();t.NeoPixelState=n}(pxsim||(pxsim={}));var pxsim;!function(t){var e=function(){function t(t){this.pin=t,this.on=!1}return t.prototype.toggle=function(){this.on=!this.on,this.on?this.pin.value=200:this.pin.value=0},t}();t.ToggleState=e}(pxsim||(pxsim={}));var pxsim;!function(t){!function(e){e.mkBoardView=function(t){var n=t.visual;return new e.GenericBoardSvg({visualDef:n,wireframe:t.wireframe})};var n=function(){function n(n,i){var r=this;this.parts=[],this.boardView=n,this.state=i.state;var o=i.partsList;if(this.useCrocClips=i.boardDef.useCrocClips,0<o.length||i.forceBreadboardLayout){this.breadboard=new e.Breadboard({wireframe:i.wireframe});var s=i.boardDef.marginWhenBreadboarding||[0,0,40,0],a=e.composeSVG({el1:this.boardView.getView(),scaleUnit1:this.boardView.getPinDist(),el2:this.breadboard.getSVGAndSize(),scaleUnit2:this.breadboard.getPinDist(),margin:[s[0],s[1],20,s[3]],middleMargin:s[2],maxWidth:i.maxWidth,maxHeight:i.maxHeight}),u=a.under,l=a.over;this.view=a.host;var c=a.edges;this.fromMBCoord=a.toHostCoord1,this.fromBBCoord=a.toHostCoord2;a.scaleUnit;this.partGroup=l,this.partOverGroup=t.svg.child(this.view,"g"),this.style=t.svg.child(this.view,"style",{}),this.defs=t.svg.child(this.view,"defs",{}),this.wireFactory=new e.WireFactory(u,l,c,this.style,this.getLocCoord.bind(this));var p=t.allocateDefinitions({boardDef:i.boardDef,partDefs:i.partDefs,fnArgs:i.fnArgs,getBBCoord:this.breadboard.getCoord.bind(this.breadboard),partsList:o});this.addAll(p),p.requiresBreadboard||i.forceBreadboardRender||this.breadboard.hide()}else{var d=this.boardView.getView().el;this.view=d,this.partGroup=t.svg.child(this.view,"g"),this.partOverGroup=t.svg.child(this.view,"g"),i.maxWidth&&t.svg.hydrate(this.view,{width:i.maxWidth}),i.maxHeight&&t.svg.hydrate(this.view,{height:i.maxHeight})}this.state.updateSubscribers.push(function(){return r.updateState()})}return n.prototype.highlightBoardPin=function(t){this.boardView.highlightPin(t)},n.prototype.highlightBreadboardPin=function(t){this.breadboard.highlightLoc(t)},n.prototype.highlightWire=function(e){e.wires.forEach(function(e){t.svg.addClass(e,"highlight"),e.style.visibility="visible"}),t.svg.addClass(e.endG,"highlight")},n.prototype.getView=function(){return this.view},n.prototype.updateState=function(){this.parts.forEach(function(t){return t.updateState()})},n.prototype.getBBCoord=function(t){var e=this.breadboard.getCoord(t);return this.fromBBCoord(e)},n.prototype.getPinCoord=function(e){var n=this.boardView.getCoord(e);return t.U.assert(!!n,"Unable to find coord for pin: "+e),this.fromMBCoord(n)},n.prototype.getLocCoord=function(t){var e;if("breadboard"===t.type){var n=t;e=this.getBBCoord(n)}else{var i=t.pin;e=this.getPinCoord(i)}return e||(console.error("Unknown location: "+name),[0,0])},n.prototype.addPart=function(n){var i=this,r=null;if(n.simulationBehavior){var o=n.simulationBehavior,s=this.state.builtinVisuals[o],a=this.state.builtinParts[o];(r=s()).init(this.state.bus,a,this.view,n.params)}else{var u=n.visual;r=new e.GenericPart(u)}this.parts.push(r),this.partGroup.appendChild(r.element),r.overElement&&this.partOverGroup.appendChild(r.overElement),r.defs&&r.defs.forEach(function(t){return i.defs.appendChild(t)}),this.style.textContent+=r.style||"";var l=n.startColumnIdx,c=n.startRowIdx,p={type:"breadboard",row:e.getRowName(c),col:e.getColumnName(l),xOffset:n.bbFit.xOffset/n.visual.pinDistance,yOffset:n.bbFit.yOffset/n.visual.pinDistance},d=this.getBBCoord(p);r.moveToCoord(d);var h=function(t){return"sim-"+t+"-cmp"}(n.name);return t.svg.addClass(r.element,h),t.svg.addClass(r.element,"sim-cmp"),r.updateTheme(),r.updateState(),r},n.prototype.addWire=function(t){return this.wireFactory.addWire(t.start,t.end,t.color,this.useCrocClips)},n.prototype.addAll=function(t){var e=this;t.partsAndWires.forEach(function(t){var n=t.part;n&&e.addPart(n);var i=t.wires;i&&i.forEach(function(t){return e.addWire(t)})})},n}();e.BoardHost=n}(t.visuals||(t.visuals={}))}(pxsim||(pxsim={}));var pxsim;!function(t){!function(e){function n(t){return""+(t+1)}function i(t){return D[t]}function r(e){for(var n=e.xOffset||0,i=e.yOffset||0,r=[],o=t.svg.elt("g"),s=e.colStartIdx||0,a=e.rowStartIdx||0,u=function(t){return t?t.slice(0,t.length):[]},l=function(t,e){for(var n,i=0;0<=(n=t.indexOf(e));)t.splice(n,1),i+=1;return i},c=0,p=u(e.rowIdxsWithGap),d=0;d<e.rowCount;d++)!function(d){for(var h=0,f=u(e.colIdxsWithGap),m=i+d*e.pinDist+c*e.pinDist,v=d+a,g=0;g<e.colCount;g++)!function(i){var a=n+i*e.pinDist+h*e.pinDist,u=i+s,c=function(e){var n=a-.5*e.w,i=m-.5*e.h;return t.svg.hydrate(e.el,{x:n,y:i}),o.appendChild(e.el),e.el},p=c(e.mkPin()),d=c(e.mkHoverPin()),g=e.getRowName(v),b=e.getColName(u),y=e.getGroupName?e.getGroupName(v,u):null,w={el:p,hoverEl:d,cx:a,cy:m,row:g,col:b,group:y};r.push(w),h+=l(f,u)}(g);c+=l(p,v)}(d);return{g:o,allPins:r}}function o(){var e=t.svg.elt("rect"),n=I;return t.svg.hydrate(e,{class:"sim-bb-pin",rx:E,ry:E,width:n,height:n}),{el:e,w:n,h:n,x:0,y:0}}function s(){var e=t.svg.elt("rect"),n=I*k;return t.svg.hydrate(e,{class:"sim-bb-pin-hover",rx:E,ry:E,width:n,height:n}),{el:e,w:n,h:n,x:0,y:0}}function a(n,i,r,o,s,a,u){var l=e.mkTxt(n,i,r,o,s);t.svg.addClass(l,"sim-bb-label"),u&&u.forEach(function(e){return t.svg.addClass(l,e)});var c=e.mkTxt(n,i,r*B,o,s);return t.svg.addClass(c,"sim-bb-label-hover"),u&&u.forEach(function(e){return t.svg.addClass(c,e)}),{el:l,hoverEl:c,txt:s,group:a}}e.BREADBOARD_MID_ROWS=10,e.BREADBOARD_MID_COLS=30;var u=[4,4],l=e.BREADBOARD_MID_ROWS+u.length,c=[4,9,14,19],p=25+c.length,d=15*(e.BREADBOARD_MID_COLS+3),h=15*(l+4+5.5),f=h*(2/3),m=h*(.5*(1-2/3)),v=15*(e.BREADBOARD_MID_COLS-1),g=(d-v)/2,b=m+(f-15*(l-1))/2,y=15*(p-1),w=(d-y)/2,x=(m-15)/2,C=w,R=x+m+f,k=1.3,I=6,E=2,B=1.3,D="abcdefghij".split("").reverse();e.getColumnName=n,e.getRowName=i,e.mkGrid=r;var S=function(){function l(e){this.allPins=[],this.allLabels=[],this.allPowerBars=[],this.rowColToPin={},this.rowColToLbls={},this.buildDom(),e.wireframe&&t.svg.addClass(this.bb,"sim-bb-outline")}return l.prototype.hide=function(){this.bb.style.display="none"},l.prototype.updateLocation=function(e,n){t.svg.hydrate(this.bb,{x:e+"px",y:n+"px"})},l.prototype.getPin=function(t,e){var n=this.rowColToPin[t];if(!n)return null;var i=n[e];return i||null},l.prototype.getCoord=function(t){var e=t.row,n=t.col,i=t.xOffset,r=t.yOffset,o=this.getPin(e,n);if(!o)return null;var s=15*(i||0),a=15*(r||0);return[o.cx+s,o.cy+a]},l.prototype.getPinDist=function(){return 15},l.prototype.buildDom=function(){var l=this;this.bb=t.svg.elt("svg",{version:"1.0",viewBox:"0 0 "+d+" "+h,class:"sim-bb",width:d+"px",height:h+"px"}),this.styleEl=t.svg.child(this.bb,"style",{}),this.styleEl.textContent+='\n        /* bread board */\n        .sim-bb-background {\n            fill:#E0E0E0;\n        }\n        .sim-bb-pin {\n            fill:#999;\n        }\n        .sim-bb-pin-hover {\n            visibility: hidden;\n            pointer-events: all;\n            stroke-width: 7.5px;\n            stroke: transparent;\n            fill: #777;\n        }\n        .sim-bb-pin-hover:hover {\n            visibility: visible;\n            fill:#444;\n        }\n        .sim-bb-group-wire {\n            stroke: #999;\n            stroke-width: 3.75px;\n            visibility: hidden;\n        }\n        .sim-bb-pin-group {\n            pointer-events: all;\n        }\n        .sim-bb-label,\n        .sim-bb-label-hover {\n            font-family:"Lucida Console", Monaco, monospace;\n            fill:#555;\n            pointer-events: all;\n            stroke-width: 0;\n            cursor: default;\n        }\n        .sim-bb-label-hover {\n            visibility: hidden;\n            fill:#000;\n            font-weight: bold;\n        }\n        .sim-bb-bar {\n            stroke-width: 0;\n        }\n        .sim-bb-blue {\n            fill:#1AA5D7;\n            stroke:#1AA5D7\n        }\n        .sim-bb-red {\n            fill:#DD4BA0;\n            stroke:#DD4BA0;\n        }\n        .sim-bb-pin-group:hover .sim-bb-pin-hover,\n        .sim-bb-pin-group:hover .sim-bb-group-wire,\n        .sim-bb-pin-group:hover .sim-bb-label-hover {\n            visibility: visible;\n        }\n        .sim-bb-pin-group:hover .sim-bb-label {\n            visibility: hidden;\n        }\n        /* outline mode */\n        .sim-bb-outline .sim-bb-background {\n            stroke-width: 2.142857142857143px;\n            fill: #FFF;\n            stroke: #000;\n        }\n        .sim-bb-outline .sim-bb-mid-channel {\n            fill: #FFF;\n            stroke: #888;\n            stroke-width: 2px;\n        }\n        /* grayed out */\n        .grayed .sim-bb-background {\n            stroke-width: 3px;\n        }\n        .grayed .sim-bb-red,\n        .grayed .sim-bb-blue {\n            fill: #BBB;\n        }\n        .grayed .sim-bb-bar {\n            fill: #FFF;\n        }\n        .grayed .sim-bb-pin {\n            fill: #000;\n            stroke: #FFF;\n            stroke-width: 3px;\n        }\n        .grayed .sim-bb-label {\n            fill: none;\n        }\n        .grayed .sim-bb-background {\n            stroke-width: 7.5px;\n            stroke: #555;\n        }\n        .grayed .sim-bb-group-wire {\n            stroke: #DDD;\n        }\n        .grayed .sim-bb-channel {\n            visibility: hidden;\n        }\n        /* highlighted */\n        .sim-bb-label.highlight {\n            visibility: hidden;\n        }\n        .sim-bb-label-hover.highlight {\n            visibility: visible;\n        }\n        .sim-bb-blue.highlight {\n            fill:#1AA5D7;\n        }\n        .sim-bb-red.highlight {\n            fill:#DD4BA0;\n        }\n        .sim-bb-bar.highlight {\n            stroke-width: 0px;\n        }\n        ',this.defs=t.svg.child(this.bb,"defs",{}),t.svg.child(this.bb,"rect",{class:"sim-bb-background",width:d,height:h,rx:4.5,ry:4.5});var p=t.svg.elt("linearGradient");t.svg.hydrate(p,{id:"sim-bb-channel-grad",x1:"0%",y1:"0%",x2:"0%",y2:"100%"}),this.defs.appendChild(p);t.svg.child(p,"stop",{offset:"0%",style:"stop-color: #AAA;"}),t.svg.child(p,"stop",{offset:"20%",style:"stop-color: #CCC;"}),t.svg.child(p,"stop",{offset:"80%",style:"stop-color: #CCC;"}),t.svg.child(p,"stop",{offset:"100%",style:"stop-color: #AAA;"});var v=function(e,n,i){var r=t.svg.child(l.bb,"rect",{class:"sim-bb-channel "+(i||""),y:e-n/2,width:d,height:n});return r.setAttribute("fill","url(#sim-bb-channel-grad)"),r};v(m+f/2,15,"sim-bb-mid-channel"),v(m,.75,"sim-bb-sml-channel"),v(m+f,.75);var k=function(t){return t<e.BREADBOARD_MID_ROWS/2?"b":"t"},I=function(t){return t<25?"b":"t"},E=function(t,e){return""+k(t)+n(e)},B=function(t){return 0===t?"-":"+"},D=function(t,e){var n=I(e);return""+B(t)+n},S=r({xOffset:g,yOffset:b,rowCount:e.BREADBOARD_MID_ROWS,colCount:e.BREADBOARD_MID_COLS,pinDist:15,mkPin:o,mkHoverPin:s,getRowName:i,getColName:n,getGroupName:E,rowIdxsWithGap:u});S.g;this.allPins=this.allPins.concat(S.allPins);var P=r({xOffset:C,yOffset:R,rowCount:2,colCount:25,pinDist:15,mkPin:o,mkHoverPin:s,getRowName:B,getColName:n,getGroupName:D,colIdxsWithGap:c});P.g;this.allPins=this.allPins.concat(P.allPins);var _=r({xOffset:w,yOffset:x,rowCount:2,colCount:25,colStartIdx:25,pinDist:15,mkPin:o,mkHoverPin:s,getRowName:B,getColName:n,getGroupName:D,colIdxsWithGap:c.map(function(t){return t+25})});_.g;this.allPins=this.allPins.concat(_.allPins),this.allPins.forEach(function(e){var n=e.el,i=e.row,r=e.col,o=e.hoverEl,s="("+i+","+r+")";t.svg.hydrate(n,{title:s}),t.svg.hydrate(o,{title:s})}),this.allPins.forEach(function(t){var e=l.rowColToPin[t.row];e||(e=l.rowColToPin[t.row]={}),e[t.col]=t});for(var T=function(t,e,n,i,r,o){var s=l.getCoord({type:"breadboard",row:t,col:e});return a(s[0]+n,s[1]+i,10.5,-90,r,o)},A=0;A<e.BREADBOARD_MID_COLS;A++){var M=n(A),L=T(i(0),M,0,-15,M,E(0,A));this.allLabels.push(L);var O=e.BREADBOARD_MID_ROWS-1,N=T(i(O),M,0,15,M,E(O,A));this.allLabels.push(N)}for(var q=0;q<e.BREADBOARD_MID_ROWS;q++){var F=i(q),L=T(F,n(0),-15,0,F);this.allLabels.push(L);N=T(F,n(e.BREADBOARD_MID_COLS-1),15,0,F);this.allLabels.push(N)}var U=[a(13.05,m+f+12,30,-90,"-",D(0,0),["sim-bb-blue"]),a(12,m+f+m-12,25.5,-90,"+",D(1,0),["sim-bb-red"]),a(d-12+1.05,m+f+12,30,-90,"-",D(0,24),["sim-bb-blue"]),a(d-12,m+f+m-12,25.5,-90,"+",D(1,24),["sim-bb-red"])];this.allLabels=this.allLabels.concat(U);var V=[a(13.05,12,30,-90,"-",D(0,25),["sim-bb-blue"]),a(12,m-12,25.5,-90,"+",D(1,25),["sim-bb-red"]),a(d-12+1.05,12,30,-90,"-",D(0,49),["sim-bb-blue"]),a(d-12,m-12,25.5,-90,"+",D(1,49),["sim-bb-red"])];this.allLabels=this.allLabels.concat(V);var W={};this.allLabels.forEach(function(t){t.el;var e=t.txt;(W[e]=W[e]||[]).push(t)});var G=function(t){return"-"===t.row||"+"===t.row};this.allPins.forEach(function(t){var e=t.row,n=t.col,i=(t.group,l.rowColToLbls[e]||(l.rowColToLbls[e]={})),r=i[n]||(i[n]=[]);G(t)?Number(n)<=25?U.filter(function(e){return e.group==t.group}).forEach(function(t){return r.push(t)}):V.filter(function(e){return e.group==t.group}).forEach(function(t){return r.push(t)}):(W[e].forEach(function(t){return r.push(t)}),W[n].forEach(function(t){return r.push(t)}))});var H=y+22.5,z=(H-y)/2,j=function(e,n,i,r){var o=t.svg.elt("rect");return t.svg.hydrate(o,{class:"sim-bb-bar "+r,x:e,y:n-1.5,width:H,height:3}),{el:o,group:i}},J=[j(C-z,R-9,D(0,49),"sim-bb-blue"),j(C-z,R+15+9,D(1,49),"sim-bb-red"),j(w-z,x-9,D(0,0),"sim-bb-blue"),j(w-z,x+15+9,D(1,0),"sim-bb-red")];this.allPowerBars=this.allPowerBars.concat(J),this.allPowerBars.forEach(function(t){return l.bb.appendChild(t.el)});var Y=this.allPins.map(function(t){return t.group}).filter(function(t,e,n){return n.indexOf(t)==e}),K=Y.map(function(e){return t.svg.elt("g")});K.forEach(function(e){return t.svg.addClass(e,"sim-bb-pin-group")}),K.forEach(function(e,n){return t.svg.addClass(e,"group-"+Y[n])});var Q={};Y.forEach(function(t,e){return Q[t]=K[e]});var Z={};this.allPins.forEach(function(t,e){var n=t.group;(Z[n]||(Z[n]=[])).push(t)}),Y.forEach(function(e){var n=Z[e],i=[n.map(function(t){return t.cx}),n.map(function(t){return t.cy})],r=i[0],o=i[1],s=function(t){return t.reduce(function(t,e){return t<e?t:e})},a=function(t){return t.reduce(function(t,e){return t>e?t:e})},u=[s(r),a(r),s(o),a(o)],l=u[0],c=u[1],p=u[2],d=u[3],h=t.svg.elt("rect"),f=Math.max(c-l,1e-4),m=Math.max(d-p,1e-4);t.svg.hydrate(h,{x:l,y:p,width:f,height:m}),t.svg.addClass(h,"sim-bb-group-wire"),Q[e].appendChild(h)}),this.allPins.forEach(function(t){var e=Q[t.group];e.appendChild(t.el),e.appendChild(t.hoverEl)});var $=t.svg.elt("g");t.svg.hydrate($,{class:"sim-bb-group-misc"}),K.push($),this.allLabels.forEach(function(t){if(t.group){var e=Q[t.group];e.appendChild(t.el),e.appendChild(t.hoverEl)}else $.appendChild(t.el),$.appendChild(t.hoverEl)}),K.forEach(function(t){return l.bb.appendChild(t)})},l.prototype.getSVGAndSize=function(){return{el:this.bb,y:0,x:0,w:d,h:h}},l.prototype.highlightLoc=function(e){var n=e.row,i=e.col,r=this.rowColToPin[n][i];r.cx,r.cy;this.rowColToLbls[n][i].forEach(function(e){t.svg.addClass(e.el,"highlight"),t.svg.addClass(e.hoverEl,"highlight")})},l}();e.Breadboard=S}(t.visuals||(t.visuals={}))}(pxsim||(pxsim={}));var pxsim;!function(t){!function(e){function n(n){var i=["sim-button","sim-button-outer"],r=i[0],o=i[1],s=e.PIN_DIST/2.5,a=e.PIN_DIST/5,u=.8*e.PIN_DIST,l=e.PIN_DIST/8,c=e.PIN_DIST/12,p=l+a,d=n[0],h=n[1],f=d-s/2,m=h-s/2,v=3*e.PIN_DIST-s,g=2*e.PIN_DIST+s,b=f,y=m+s,w=b+g/2,x=y+v/2,C=t.svg.elt("g"),R=function(e,n){t.svg.child(C,"rect",{class:"sim-button-tab",x:e,y:n,width:s,height:s})};R(f,m),R(f+2*e.PIN_DIST,m),R(f,m+3*e.PIN_DIST),R(f+2*e.PIN_DIST,m+3*e.PIN_DIST),t.svg.child(C,"rect",{class:o,x:b,y:y,rx:c,ry:c,width:g,height:v});var k=function(e,n){t.svg.child(C,"circle",{class:"sim-button-nut",cx:e,cy:n,r:a})};k(b+p,y+p),k(b+g-p,y+p),k(b+p,y+v-p),k(b+g-p,y+v-p);t.svg.child(C,"circle",{class:r,cx:w,cy:x,r:u});return{el:C,y:m,x:f,w:g,h:v+2*s}}e.mkBtnSvg=n,e.BUTTON_PAIR_STYLE="\n            .sim-button {\n                pointer-events: none;\n                fill: #000;\n            }\n            .sim-button-outer:active ~ .sim-button,\n            .sim-button-virtual:active {\n                fill: #FFA500;\n            }\n            .sim-button-outer {\n                cursor: pointer;\n                fill: #979797;\n            }\n            .sim-button-outer:hover {\n                stroke:gray;\n                stroke-width: "+e.PIN_DIST/5+"px;\n            }\n            .sim-button-nut {\n                fill:#000;\n                pointer-events:none;\n            }\n            .sim-button-nut:hover {\n                stroke:"+e.PIN_DIST/15+"px solid #704A4A;\n            }\n            .sim-button-tab {\n                fill:#FFF;\n                pointer-events:none;\n            }\n            .sim-button-virtual {\n                cursor: pointer;\n                fill: rgba(255, 255, 255, 0.6);\n                stroke: rgba(255, 255, 255, 1);\n                stroke-width: "+e.PIN_DIST/5+"px;\n            }\n            .sim-button-virtual:hover {\n                stroke: rgba(128, 128, 128, 1);\n            }\n            .sim-text-virtual {\n                fill: #000;\n                pointer-events:none;\n            }\n            ";var i=function(){function i(){this.style=e.BUTTON_PAIR_STYLE}return i.prototype.init=function(t,e){this.state=e,this.bus=t,this.defs=[],this.element=this.mkBtns(),this.updateState(),this.attachEvents()},i.prototype.moveToCoord=function(t){var n=3*e.PIN_DIST,i=t[0],r=t[1];e.translateEl(this.aBtn,[i,r]),e.translateEl(this.bBtn,[i+n,r]),e.translateEl(this.abBtn,[i+1.5*e.PIN_DIST,r+4*e.PIN_DIST])},i.prototype.updateState=function(){this.state.aBtn,this.state.bBtn,this.state.abBtn,this.aBtn,this.bBtn,this.abBtn;this.state.usesButtonAB&&"visible"!=this.abBtn.style.visibility&&(this.abBtn.style.visibility="visible")},i.prototype.updateTheme=function(){},i.prototype.mkBtns=function(){this.aBtn=n([0,0]).el,this.bBtn=n([0,0]).el;this.abBtn=function(){var n=2.8*e.PIN_DIST,i=(n-2*e.PIN_DIST)/2,r=e.PIN_DIST/2,o=0-i+n/2,s=o,a=1.3*e.PIN_DIST,u=-i,l=-i,c=e.PIN_DIST/7,p=e.PIN_DIST/10,d=t.svg.elt("g"),h=(t.svg.child(d,"rect",{class:"sim-button-virtual",x:u,y:l,rx:r,ry:r,width:n,height:n}),e.mkTxt(o+c,s+p,a,0,"A+B"));return t.svg.addClass(h,"sim-text"),t.svg.addClass(h,"sim-text-virtual"),d.appendChild(h),d}(),this.abBtn.style.visibility="hidden";var i=t.svg.elt("g");return t.svg.addClass(i,"sim-buttonpair"),i.appendChild(this.aBtn),i.appendChild(this.bBtn),i.appendChild(this.abBtn),i},i.prototype.attachEvents=function(){var e=this,n=[this.state.aBtn,this.state.bBtn];[this.aBtn,this.bBtn].forEach(function(i,r){i.addEventListener(t.pointerEvents.down,function(t){n[r].pressed=!0}),i.addEventListener(t.pointerEvents.leave,function(t){n[r].pressed=!1}),i.addEventListener(t.pointerEvents.up,function(t){n[r].pressed=!1,e.bus.queue(n[r].id,e.state.props.BUTTON_EVT_UP),e.bus.queue(n[r].id,e.state.props.BUTTON_EVT_CLICK)})});var i=function(t){n.forEach(function(e){return e.pressed=t})};this.abBtn.addEventListener(t.pointerEvents.down,function(t){i(!0)}),this.abBtn.addEventListener(t.pointerEvents.leave,function(t){i(!1)}),this.abBtn.addEventListener(t.pointerEvents.up,function(t){i(!1),e.bus.queue(e.state.abBtn.id,e.state.props.BUTTON_EVT_UP),e.bus.queue(e.state.abBtn.id,e.state.props.BUTTON_EVT_CLICK)})},i}();e.ButtonPairView=i}(t.visuals||(t.visuals={}))}(pxsim||(pxsim={}));var pxsim;!function(t){!function(e){e.BOARD_SYTLE="\n        .noselect {\n            -webkit-touch-callout: none; /* iOS Safari */\n            -webkit-user-select: none;   /* Chrome/Safari/Opera */\n            -khtml-user-select: none;    /* Konqueror */\n            -moz-user-select: none;      /* Firefox */\n            -ms-user-select: none;       /* Internet Explorer/Edge */\n            user-select: none;           /* Non-prefixed version, currently\n                                            not supported by any browser */\n        }\n\n        .sim-board-pin {\n            fill:#999;\n            stroke:#000;\n            stroke-width:"+e.PIN_DIST/3+"px;\n        }\n        .sim-board-pin-lbl {\n            fill: #333;\n        }\n        .gray-cover {\n            fill:#FFF;\n            opacity: 0.3;\n            stroke-width:0;\n            visibility: hidden;\n        }\n        .sim-board-pin-hover {\n            visibility: hidden;\n            pointer-events: all;\n            stroke-width:"+e.PIN_DIST/6+'px;\n        }\n        .sim-board-pin-hover:hover {\n            visibility: visible;\n        }\n        .sim-board-pin-lbl {\n            visibility: hidden;\n        }\n        .sim-board-outline .sim-board-pin-lbl {\n            visibility: visible;\n        }\n        .sim-board-pin-lbl {\n            fill: #555;\n        }\n        .sim-board-pin-lbl-hover {\n            fill: red;\n        }\n        .sim-board-outline .sim-board-pin-lbl-hover {\n            fill: black;\n        }\n        .sim-board-pin-lbl,\n        .sim-board-pin-lbl-hover {\n            font-family:"Lucida Console", Monaco, monospace;\n            pointer-events: all;\n            stroke-width: 0;\n        }\n        .sim-board-pin-lbl-hover {\n            visibility: hidden;\n        }\n        .sim-board-outline .sim-board-pin-hover:hover + .sim-board-pin-lbl,\n        .sim-board-pin-lbl.highlight {\n            visibility: hidden;\n        }\n        .sim-board-outline .sim-board-pin-hover:hover + * + .sim-board-pin-lbl-hover,\n        .sim-board-pin-lbl-hover.highlight {\n            visibility: visible;\n        }\n        /* Graying out */\n        .grayed .sim-board-pin-lbl:not(.highlight) {\n            fill: #AAA;\n        }\n        .grayed .sim-board-pin:not(.highlight) {\n            fill:#BBB;\n            stroke:#777;\n        }\n        .grayed .gray-cover {\n            visibility: inherit;\n        }\n        .grayed .sim-cmp:not(.notgrayed) {\n            opacity: 0.3;\n        }\n        /* Highlighting */\n        .sim-board-pin-lbl.highlight {\n            fill: #000;\n            font-weight: bold;\n        }\n        .sim-board-pin.highlight {\n            fill:#999;\n            stroke:#000;\n        }\n        ';var n=.7*e.PIN_DIST,i=1.5*n,r=.66666*e.PIN_DIST,o=.66666*e.PIN_DIST+e.PIN_DIST/3,s=0,a=function(){function a(a){var u=this;this.props=a,this.allPins=[],this.allLabels=[],this.pinNmToLbl={},this.pinNmToPin={},this.id=s++;var l=a.visualDef,c=a.wireframe&&l.outlineImage?l.outlineImage:l.image,p=e.mkImageSVG({image:c,width:l.width,height:l.height,imageUnitDist:l.pinDist,targetUnitDist:e.PIN_DIST}),d=e.mkScaleFn(l.pinDist,e.PIN_DIST);this.width=p.w,this.height=p.h;var h=p.el;this.element=t.svg.elt("svg"),t.svg.hydrate(this.element,{version:"1.0",viewBox:"0 0 "+this.width+" "+this.height,class:"sim sim-board-id-"+this.id,x:"0px",y:"0px"}),a.wireframe&&t.svg.addClass(this.element,"sim-board-outline"),this.style=t.svg.child(this.element,"style",{}),this.style.textContent+=e.BOARD_SYTLE,this.defs=t.svg.child(this.element,"defs",{}),this.g=t.svg.elt("g"),this.element.appendChild(this.g),this.g.appendChild(h),this.background=h,t.svg.hydrate(h,{class:"sim-board"});var f=this.mkGrayCover(0,0,this.width,this.height);this.g.appendChild(f);var m=function(){var e=t.svg.elt("rect"),n=r;return t.svg.hydrate(e,{class:"sim-board-pin",width:n,height:n}),{el:e,w:n,h:n,x:0,y:0}},v=function(){var e=t.svg.elt("rect"),n=o;return t.svg.hydrate(e,{class:"sim-board-pin-hover",width:n,height:n}),{el:e,w:n,h:n,x:0,y:0}},g=[];l.pinBlocks.map(function(n,i){var r=d(n.x)+e.PIN_DIST/2,o=d(n.y)+e.PIN_DIST/2,s=n.labels.length,a=e.mkGrid({xOffset:r,yOffset:o,rowCount:1,colCount:s,pinDist:e.PIN_DIST,mkPin:m,mkHoverPin:v,getRowName:function(){return""+(i+1)},getColName:function(t){return n.labels[t]},getGroupName:function(){return n.labels.join(" ")}});a.allPins,a.g;return t.svg.addClass(a.g,"sim-board-pin-group"),a}).forEach(function(t,e){return t.allPins.forEach(function(t,n){u.allPins.push(t),g.push(l.pinBlocks[e])})}),this.allPins.forEach(function(e){var n=e.col;t.svg.hydrate(e.el,{title:n}),t.svg.hydrate(e.hoverEl,{title:n})}),this.allPins.forEach(function(t){u.pinNmToPin[t.col]=t});var b=function(t,n,i,r,o){var s,a;if("below"===o)a=t,s=n+12+(u=.25*i*r.length);else{var u=.32*i*r.length;a=t,s=n-11-u}return e.mkTxt(a,s,i,-90,r)},y=function(e,r,o,s){var a=b(e,r,n,o,s);t.svg.addClass(a,"sim-board-pin-lbl");var u=b(e,r,i,o,s);return t.svg.addClass(u,"sim-board-pin-lbl-hover"),{el:a,hoverEl:u,txt:o}};this.allLabels=this.allPins.map(function(t,e){var n=g[e];return y(t.cx,t.cy,t.col,n.labelPosition)}),this.allPins.forEach(function(t,e){var n=u.allLabels[e];u.pinNmToLbl[t.col]=n}),this.allPins.forEach(function(t,e){var n=u.allLabels[e];u.g.appendChild(t.el),u.g.appendChild(t.hoverEl),u.g.appendChild(n.el),u.g.appendChild(n.hoverEl)})}return a.prototype.getCoord=function(t){var e=this.pinNmToPin[t];return e?[e.cx,e.cy]:null},a.prototype.mkGrayCover=function(e,n,i,r){var o=t.svg.elt("rect");return t.svg.hydrate(o,{x:e,y:n,width:i,height:r,class:"gray-cover"}),o},a.prototype.getView=function(){return{el:this.element,w:this.width,h:this.height,x:0,y:0}},a.prototype.getPinDist=function(){return e.PIN_DIST},a.prototype.highlightPin=function(e){var n=this.pinNmToLbl[e],i=this.pinNmToPin[e];n&&i&&(t.svg.addClass(n.el,"highlight"),t.svg.addClass(n.hoverEl,"highlight"),t.svg.addClass(i.el,"highlight"),t.svg.addClass(i.hoverEl,"highlight"))},a}();e.GenericBoardSvg=a}(t.visuals||(t.visuals={}))}(pxsim||(pxsim={}));var pxsim;!function(t){!function(e){function n(t){return e.mkImageSVG({image:t.image,width:t.width,height:t.height,imageUnitDist:t.pinDistance,targetUnitDist:e.PIN_DIST})}e.mkGenericPartSVG=n;var i=function(){function i(e){this.style="",this.defs=[];var i=n(e).el;this.element=t.svg.elt("g"),this.element.appendChild(i)}return i.prototype.moveToCoord=function(t){e.translateEl(this.element,t)},i.prototype.init=function(t,e,n){},i.prototype.updateState=function(){},i.prototype.updateTheme=function(){},i}();e.GenericPart=i}(t.visuals||(t.visuals={}))}(pxsim||(pxsim={}));var pxsim;!function(t){!function(e){e.mkMicroServoPart=function(t){return void 0===t&&(t=[0,0]),{el:null,y:0,x:0,w:0,h:0}};var n=function(){function n(){this.style="",this.overElement=void 0,this.defs=[],this.currentAngle=0,this.targetAngle=0,this.lastAngleTime=0}return n.prototype.init=function(e,n,i,r){this.state=n,this.pin=this.state.props.servos[t.readPin(r.name||r.pin)],this.bus=e,this.defs=[],this.initDom(),this.updateState()},n.prototype.initDom=function(){this.element=t.svg.parseString('\n<svg xmlns="http://www.w3.org/2000/svg" id="svg2" width="112.188" height="299.674">\n  <g id="layer1" stroke-linecap="round" stroke-linejoin="round" transform="scale(0.8)">\n    <path id="path8212" fill="#0061ff" stroke-width="6.6" d="M.378 44.61v255.064h112.188V44.61H.378z"/>\n    <path id="crankbase" fill="#00f" stroke-width="6.6" d="M56.57 88.047C25.328 88.047 0 113.373 0 144.615c.02 22.352 11.807 42.596 32.238 51.66.03 3.318.095 5.24.088 7.938 0 13.947 11.307 25.254 25.254 25.254 13.947 0 25.254-11.307 25.254-25.254-.006-2.986-.415-5.442-.32-8.746 19.487-9.45 30.606-29.195 30.625-50.852 0-31.24-25.33-56.568-56.57-56.568z"/>\n    <path id="lowertip" fill="#00a2ff" stroke-width="2" d="M.476 260.78v38.894h53.82v-10.486a6.82 6.566 0 0 1-4.545-6.182 6.82 6.566 0 0 1 6.82-6.566 6.82 6.566 0 0 1 6.82 6.566 6.82 6.566 0 0 1-4.545 6.182v10.486h53.82V260.78H.475z"/>\n    <path id="uppertip" fill="#00a2ff" stroke-width="2" d="M112.566 83.503V44.61h-53.82v10.487a6.82 6.566 0 0 1 4.544 6.18 6.82 6.566 0 0 1-6.818 6.568 6.82 6.566 0 0 1-6.82-6.567 6.82 6.566 0 0 1 4.546-6.18V44.61H.378v38.893h112.188z"/>\n    <path id="VCC" fill="red" stroke-width="2" d="M53.72 21.93h5.504v22.627H53.72z"/>\n    <path id="LOGIC" fill="#fc0" stroke-width="2" d="M47.3 21.93h5.503v22.627H47.3z"/>\n    <path id="GND" fill="#a02c2c" stroke-width="2" d="M60.14 21.93h5.505v22.627H60.14z"/>\n    <path id="connector" stroke-width="2" d="M45.064 0a1.488 1.488 0 0 0-1.488 1.488v24.5a1.488 1.488 0 0 0 1.488 1.487h22.71a1.488 1.488 0 0 0 1.49-1.488v-24.5A1.488 1.488 0 0 0 67.774 0h-22.71z"/>\n    <g id="crank" transform="translate(0 -752.688)">\n      <path id="arm" fill="#ececec" stroke="#000" stroke-width="1.372" d="M47.767 880.88c-4.447 1.162-8.412 8.278-8.412 18.492s3.77 18.312 8.412 18.494c8.024.314 78.496 5.06 78.51-16.952.012-22.013-74.377-21.117-78.51-20.035z"/>\n      <circle id="path8216" cx="56.661" cy="899.475" r="8.972" fill="gray" stroke-width="2"/>\n    </g>\n  </g>\n</svg>\n            ').firstElementChild,this.crankEl=this.element.querySelector("#crank"),this.crankTransform=this.crankEl.getAttribute("transform")},n.prototype.moveToCoord=function(t){var n=t[0],i=t[1];e.translateEl(this.element,[n,i])},n.prototype.updateState=function(){if(this.targetAngle=this.state.getPin(this.pin).servoAngle,this.targetAngle!=this.currentAngle){var e=t.U.now(),n=Math.min(e-this.lastAngleTime,50)/1e3,i=this.targetAngle-this.currentAngle;this.currentAngle+=Math.min(Math.abs(i),300*n)*(i>0?1:-1),this.crankEl.setAttribute("transform",this.crankTransform+" rotate("+this.currentAngle+", 56.661, 899.475)"),this.lastAngleTime=e,setTimeout(function(){return t.runtime.updateDisplay()},20)}},n.prototype.updateTheme=function(){},n}();e.MicroServoView=n}(t.visuals||(t.visuals={}))}(pxsim||(pxsim={}));var pxsim;!function(t){!function(e){function n(t){return t.replace(/\#/g,"-").replace(/\(/g,"-").replace(/\)/g,"-").replace(/\,/g,"-").replace(/\./g,"-").replace(/\s/g,"")}function i(e,n,i,r){var o=function(t){return t[0]+", "+t[1]},s=e[0],a=e[1],u=n[0],l=n[1],c=l-a,p=[s,a+c*i],d=[u,l-c*i],h=t.svg.mkPath("sim-bb-wire","M"+o(e)+" C"+o(p)+" "+o(d)+" "+o(n));return t.svg.addClass(h,"wire-stroke-"+r),h}function r(e,n,i){var r=function(t){return t[0]+", "+t[1]},o=e[0],s=e[1],a=n[0],u=n[1],l=u-s,c=[o,s+.8*l],p=[a,u-.8*l],d=t.svg.mkPath("sim-bb-wire","M"+r(e)+" C"+r(c)+" "+r(p)+" "+r(n));return d.style.stroke=i,{el:d,x:Math.min(o,a),y:Math.min(s,u),w:Math.abs(o-a),h:Math.abs(s-u)}}function o(e,n,i){var r=function(t){return t[0]+", "+t[1]},o=t.svg.mkPath("sim-bb-wire","M"+r(e)+" L"+r(n));return t.svg.addClass(o,"wire-stroke-"+i),o}function s(n,i){var r=e.PIN_DIST/4,o=t.svg.elt("circle"),s=n[0],a=n[1],u=c/2+r/2;return t.svg.hydrate(o,{cx:s,cy:a,r:u,class:"sim-bb-wire-end"}),t.svg.addClass(o,"wire-fill-"+i),o.style["stroke-width"]=r+"px",o}function a(n,i,r){var o=.24*e.PIN_DIST,s=10*o,a=2*o,u=6*o,l=o,c=e.PIN_DIST/4,p=n[0],d=n[1],h=i?-1:1,f=t.svg.elt("g"),m=t.svg.elt("rect"),v=s,g=a,b=p-g/2,y=d-v/2;t.svg.hydrate(m,{x:b,y:y,width:g,height:v,rx:.5,ry:.5,class:"sim-bb-wire-end"}),m.style["stroke-width"]=c+"px";var w=t.svg.elt("rect"),x=u,C=l,R=p-C/2,k=d+h*(v/2+x/2)-x/2;return t.svg.hydrate(w,{x:R,y:k,width:C,height:x,class:"sim-bb-wire-bare-end"}),w.style.fill="#bbb",f.appendChild(w),f.appendChild(m),{el:f,x:b-c,y:Math.min(y,k),w:g+2*c,h:v+x}}function u(n,i,r){var o=.24*e.PIN_DIST,s=4*o,a=1.2*o,u=10*o,l=o,c=e.PIN_DIST/4,p=n[0],d=n[1],h=i?-1:1,f=t.svg.elt("g"),m=t.svg.elt("rect"),v=s,g=a,b=p-g/2,y=d+10-v/2;t.svg.hydrate(m,{x:b,y:y,width:g,height:v,rx:.5,ry:.5,class:"sim-bb-wire-end"}),m.style["stroke-width"]=c+"px";var w=t.svg.elt("rect"),x=u,C=l,R=p-C/2,k=d+10+h*(v/2+x/2)-x/2;return t.svg.hydrate(w,{x:R,y:k,width:C,height:x,class:"sim-bb-wire-bare-end"}),w.style.fill="#bbb",f.appendChild(w),f.appendChild(m),{el:f,x:b-c,y:Math.min(y,k),w:g+2*c,h:v+x}}function l(n,i,r){var o=.24*e.PIN_DIST,s=4*o,a=10*o,u=3.5*o,l=3.5*o,c=e.PIN_DIST/4,p=n[0],d=n[1],h=i?-1:1,f=t.svg.elt("g"),m=t.svg.elt("polygon"),v=a,g=s,b=p-g/2,y=d-v/2,w=function(t){return t[0]+","+t[1]},x=i?.15:.3,C=i?.7:1-.7,R=i?.3:.15;t.svg.hydrate(m,{points:function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return t.map(function(t){return w(t)}).join(" ")}([b+g*x,y],[b+g*(1-x),y],[b+g,y+v*C],[b+g*(1-R),y+v],[b+g*R,y+v],[b,y+v*C])}),t.svg.hydrate(m,{rx:.5,ry:.5,class:"sim-bb-wire-end"}),m.style["stroke-width"]=c+"px";var k=t.svg.elt("rect"),I=u,E=l,B=p-E/2,D=d+h*(v/2+I/2)-I/2;return t.svg.hydrate(k,{x:B,y:D,width:E,height:I,class:"sim-bb-wire-bare-end"}),f.appendChild(k),f.appendChild(m),{el:f,x:b-c,y:Math.min(y,D),w:g+2*c,h:v+I}}var c=e.PIN_DIST/2.5,p=15,d=100;e.WIRES_CSS="\n        .sim-bb-wire {\n            fill:none;\n            stroke-linecap: round;\n            stroke-width:"+c+"px;\n            pointer-events: none;\n        }\n        .sim-bb-wire-end {\n            stroke:#333;\n            fill:#333;\n        }\n        .sim-bb-wire-bare-end {\n            fill: #ccc;\n        }\n        .sim-bb-wire-hover {\n            stroke-width: "+c+"px;\n            visibility: hidden;\n            stroke-dasharray: "+e.PIN_DIST/10+","+e.PIN_DIST/1.5+";\n            /*stroke-opacity: 0.4;*/\n        }\n        .grayed .sim-bb-wire-ends-g:not(.highlight) .sim-bb-wire-end {\n            stroke: #777;\n            fill: #777;\n        }\n        .grayed .sim-bb-wire:not(.highlight) {\n            stroke: #CCC;\n        }\n        .sim-bb-wire-ends-g:hover .sim-bb-wire-end {\n            stroke: red;\n            fill: red;\n        }\n        .sim-bb-wire-ends-g:hover .sim-bb-wire-bare-end {\n            stroke: #FFF;\n            fill: #FFF;\n        }\n        ",function(t){t[t.BBJumper=0]="BBJumper",t[t.OpenJumper=1]="OpenJumper",t[t.Croc=2]="Croc"}(e.WireEndStyle||(e.WireEndStyle={}));e.WireEndStyle;e.mkWirePart=function(n,i,o){void 0===o&&(o=!1);var s=t.svg.elt("g"),u=n[0],c=n[1],h=p,f=[u-h,c-d/2],m=[u+h,c+d/2];i=e.mapWireColor(i);var v;v=o?l(f,!0):a(f,!0);var g=r(f,m,i),b=a(m,!1);s.appendChild(g.el),s.appendChild(v.el),s.appendChild(b.el);var y=Math.min(v.x,b.x),w=Math.max(v.x+v.w,b.x+b.w),x=Math.min(v.y,b.y);return{el:s,x:y,y:x,w:w-y,h:Math.max(v.y+v.h,b.y+b.h)-x}};var h=function(){function r(t,n,i,r,o){this.nextWireId=0,this.styleEl=r,this.styleEl.textContent+=e.WIRES_CSS,this.underboard=t,this.overboard=n,this.boardEdges=i,this.getLocCoord=o}return r.prototype.indexOfMin=function(t){for(var e=0,n=t[0],i=1;i<t.length;i++)t[i]<n&&(n=t[i],e=i);return e},r.prototype.closestEdgeIdx=function(t){var e=this.boardEdges.map(function(e){return Math.abs(t[1]-e)});return this.indexOfMin(e)},r.prototype.closestEdge=function(t){return this.boardEdges[this.closestEdgeIdx(t)]},r.prototype.drawWire=function(r,a,u){var l=this,c=[],p=t.svg.child(this.overboard,"g",{class:"sim-bb-wire-group"}),d=function(t){var n,i=e.PIN_DIST/2,r=l.closestEdge(t);return n=r-t[1]<0?r-i:r+i,[t[0],n]},h=this.nextWireId++,f=n(u),m=s(r,f),v=s(a,f),g=t.svg.child(p,"g",{class:"sim-bb-wire-ends-g"});g.appendChild(m),g.appendChild(v);var b=this.closestEdgeIdx(r),y=this.closestEdgeIdx(a);if(b==y){var w=o(r,a,f);p.appendChild(w),c.push(w)}else{var x=d(r),C=d(a),R=o(r,x,f),k=o(a,C,f),I=void 0,E=void 0;!(1!=b&&2!=b||1!=y&&2!=y)?(I=i(x,C,.7,f),E=i(x,C,.7,f)):(I=o(x,C,f),E=o(x,C,f)),t.svg.addClass(E,"sim-bb-wire-hover"),p.appendChild(R),c.push(R),p.appendChild(k),c.push(k),this.underboard.appendChild(I),c.push(I),p.appendChild(E),c.push(E);var B="sim-bb-wire-id-"+h,D=function(e){return t.svg.addClass(e,B)};D(g),D(E),this.styleEl.textContent+="\n                    ."+B+":hover ~ ."+B+".sim-bb-wire-hover {\n                        visibility: visible;\n                    }"}var S="\n                .wire-stroke-"+f+" {\n                    stroke: "+e.mapWireColor(u)+";\n                }\n                .wire-fill-"+f+" {\n                    fill: "+e.mapWireColor(u)+";\n                }\n                ";return this.styleEl.textContent+=S,{endG:g,end1:m,end2:v,wires:c}},r.prototype.drawWireWithCrocs=function(r,a,c,p){var d=this;void 0===p&&(p=!1);var h,f=[],m=t.svg.child(this.overboard,"g",{class:"sim-bb-wire-group"}),v=this.nextWireId++,g=n(c),b=s(r,g),y=a,w=a[0],x=a[1],C=[w=(a=[w,x+40])[0],(x=a[1])+-17],R=(h=p?u(C,!0):l(C,!0)).el,k=t.svg.child(m,"g",{class:"sim-bb-wire-ends-g"});k.appendChild(b);var I=this.closestEdgeIdx(r),E=this.closestEdgeIdx(y);if(I==E){var B=o(r,a,g);m.appendChild(B),f.push(B)}else{var D=function(t){var n,i=e.PIN_DIST/2,r=d.closestEdge(t);return n=r-t[1]<0?r-i:r+i,[t[0],n]}(r),S=o(r,D,g),P=void 0,_=void 0;!(1!=I&&2!=I||1!=E&&2!=E)?(P=i(D,a,.7,g),_=i(D,a,.7,g)):(P=o(D,a,g),_=o(D,a,g)),t.svg.addClass(_,"sim-bb-wire-hover"),m.appendChild(S),f.push(S),this.underboard.appendChild(P),f.push(P);var T="sim-bb-wire-id-"+v,A=function(e){return t.svg.addClass(e,T)};A(k),A(_),this.styleEl.textContent+="\n                    ."+T+":hover ~ ."+T+".sim-bb-wire-hover {\n                        visibility: visible;\n                    }"}k.appendChild(R);var M="\n                .wire-stroke-"+g+" {\n                    stroke: "+e.mapWireColor(c)+";\n                }\n                .wire-fill-"+g+" {\n                    fill: "+e.mapWireColor(c)+";\n                }\n                ";return this.styleEl.textContent+=M,{endG:k,end1:b,end2:R,wires:f}},r.prototype.addWire=function(t,e,n,i){void 0===i&&(i=!1);var r,o=this.getLocCoord(t),s=this.getLocCoord(e);if(i&&"dalboard"==e.type){var a=e.pin;r="P0"==a||"P1"==a||"P2"==a||"GND"==a||"+3v3"==a?this.drawWireWithCrocs(o,s,n):this.drawWireWithCrocs(o,s,n,!0)}else r=this.drawWire(o,s,n);return r},r}();e.WireFactory=h}(t.visuals||(t.visuals={}))}(pxsim||(pxsim={}));