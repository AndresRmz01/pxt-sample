var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},pxt;!function(e){!function(t){t.enable=function(){var t=window.appInsights;if(t){e.debug("enabling app insights");var n=e.tickEvent;e.tickEvent=function(e,r){if(n&&n(e,r),r){var i={},o={};for(var a in r)"string"==typeof r[a]?i[a]=r[a]:o[a]=r[a];t.trackEvent(e,i,o)}else t.trackEvent(e)};var r=e.reportException;e.reportException=function(n,i){r&&r(n,i);var o={target:e.appTarget.id,version:e.appTarget.versions.target};i&&e.Util.jsonMergeFrom(o,i),t.trackException(n,"exception",o)};var i=e.reportError;e.reportError=function(n,r,o){i&&i(n,r,o);try{throw r}catch(i){var a={target:e.appTarget.id,version:e.appTarget.versions.target,category:n,message:r};o&&e.Util.jsonMergeFrom(a,o),t.trackException(i,"error",a)}}}}}(e.analytics||(e.analytics={}))}(pxt||(pxt={}));var ts;!function(e){!function(e){e.__dummy=42}(e.pxtc||(e.pxtc={}))}(ts||(ts={}));var pxtc=ts.pxtc,ts;!function(e){!function(e){!function(e){function t(e,t){if(void 0===t&&(t="Assertion failed"),!e)throw new Error(t)}function n(e){return null==e?null:JSON.parse(JSON.stringify(e))}function r(e,t){for(var n=0;n<t.length;++n)e.push(t[n])}function i(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}function o(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=n.length-r);for(var o=0;o<i;++o)e[t+o]=n[r+o]}function a(e,t){t&&Object.keys(t).forEach(function(r){i(e[r])&&i(t[r])?a(e[r],t[r]):e[r]=n(t[r])})}function s(e,t){return e==t?0:e<t?-1:1}function c(e,t){var n={};return function(r){var i=e(r);return n.hasOwnProperty(i)?n[i]:n[i]=t(r)}}function l(e){return e&&(e=e.replace(/\\/g,"/")),e}function u(t){return e.httpRequestCoreAsync(t).then(function(n){if(200!=n.statusCode&&304!=n.statusCode&&!t.allowHttpErrors){var r=e.lf("Bad HTTP status code: {0} at {1}; message: {2}",n.statusCode,t.url,(n.text||"").slice(0,500)),i=new Error(r);return i.statusCode=n.statusCode,Promise.reject(i)}return n.text&&/application\/json/.test(n.headers["content-type"])&&(n.json=JSON.parse(n.text)),n})}function f(e){var t="";if(!e)return t;for(var n=0;n<e.length;++n){var r=e.charCodeAt(n);if(r<=127)t+=e.charAt(n);else if(r<=2047)t+=String.fromCharCode(192|r>>6,128|63&r);else{if(55296<=r&&r<=56319){var i=e.charCodeAt(++n);isNaN(i)||(r=65536+(r-55296<<10)+(i-56320))}t+=r<=65535?String.fromCharCode(224|r>>12,128|r>>6&63,128|63&r):String.fromCharCode(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)}}return t}function p(){return Date.now()}function h(){var t=new Uint8Array(4);return e.getRandomBuf(t),new Uint32Array(t.buffer)[0]}function d(){return k}function g(t,n,r,i){function o(){var o="https://makecode.com/api/translations?lang="+encodeURIComponent(t)+"&filename="+encodeURIComponent(n)+"&approved=true";r&&(o+="&branch="+encodeURIComponent(r));var a={};return i&&(a["If-None-Match"]=i),u({url:o,headers:a}).then(function(o){if(304!=o.statusCode)return 200==o.statusCode?(i=o.headers.ETag||"",e.translationDb.setAsync(t,n,r,i,o.json).then(function(){return o.json})):o.json},function(e){console.log("failed to load translations from "+o)})}return e.translationDb.getAsync(t,n,r).then(function(e){return e?(i=e.etag,e.cached||o().done(),e.strings):o()})}function m(e){return/^(es|pt|si|sv|zh)/i.test(e)||(e=e.split("-")[0]),e}function v(t,n,r,i,o,a,s){function c(e){e&&(u||(u={}),Object.keys(e).filter(function(t){return!!e[t]}).forEach(function(t){return u[t]=e[t]}))}var l=(i=m(i))+"/"+s+"/"+n;if(_[l])return Promise.resolve(_[l]);var u,f=n?[{branch:a,path:t+"/sim-strings.json"}]:[{branch:o,path:"strings.json"},{branch:a,path:t+"/target-strings.json"}];if(s){var p=!1;return Promise.mapSeries(f,function(e){return g(i,e.path,e.branch).then(c,function(e){console.log(e.message),p=!0})}).then(function(){return p||(_[l]=u),Promise.resolve(u)})}return e.httpGetJsonAsync(r+"locales/"+i+"/strings.json").then(function(e){e&&(u=e,_[l]=u)},function(e){console.error("failed to load localizations")}).then(function(){return u})}function y(e){return e.replace(/[^\w .!?\-$]/g,function(e){var t=e.charCodeAt(0).toString(16);return"\\u"+"0000".substr(0,4-t.length)+t})}function b(t,n){return 0==n.length?t:t.replace(/\{([0-9]+)(\:[^\}]+)?\}/g,function(t,r,i){var o=n[parseInt(r)],a="",s=/^:f(\d*)\.(\d+)/.exec(i);if(s){var c=parseInt(s[2]),l=parseInt(s[1])||0,u=/^0/.test(s[1])?"0":" ",f=o.toFixed(c);if(l>0&&c>0&&(l+=c+1),l>0)for(;f.length<l;)f=u+f;a=f}else a=":x"==i?"0x"+o.toString(16):void 0===o?"(undef)":null===o?"(null)":o.toString?o.toString():o+"";return":a"==i?/^\s*[euioah]/.test(a.toLowerCase())?a="an "+a:/^\s*[bcdfgjklmnpqrstvwxz]/.test(a.toLowerCase())&&(a="a "+a):":s"==i?a=1==o?"":"s":":q"==i?a=e.htmlEscape(a):":jq"==i?a=e.jsStringQuote(a):":uri"==i?a=encodeURIComponent(a).replace(/'/g,"%27").replace(/"/g,"%22"):":url"==i?a=encodeURI(a).replace(/'/g,"%27").replace(/"/g,"%22"):":%"==i&&(a=(100*o).toFixed(1).toString()+"%"),a})}function x(t,n){U[t]=(U[t]||0)+1;var r=e._localize(t);return!O&&r!=t&&/\d:s\}/.test(r)&&(r=r.replace(/\{\d+:s\}/g,"")),r=r.replace(/\{(id|loc):[^\}]+\}/g,""),b(r,n)}function A(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return x(e,t)}e.bufferSerial=function(e,t,n,r){void 0===t&&(t=""),void 0===n&&(n="?"),void 0===r&&(r=255);for(var i=0;i<t.length;++i){var o=t[i];if(e[n]=e[n]?e[n]+o:o,"\n"===o||e[n].length>r){var a=e[n];e[n]="",window.postMessage({type:"serial",id:n,data:a},"*")}}},e.assert=t,e.fileReadAsBufferAsync=function(e){return e?new Promise(function(t,n){var r=new FileReader;r.onerror=function(e){return t(null)},r.onload=function(e){return t(new Uint8Array(r.result))},r.readAsArrayBuffer(e)}):Promise.resolve(null)},e.fileReadAsTextAsync=function(e){return e?new Promise(function(t,n){var r=new FileReader;r.onerror=function(e){return t(null)},r.onload=function(e){return t(r.result)},r.readAsText(e)}):Promise.resolve(null)},e.repeatMap=function(e,t){e=e||0;for(var n=[],r=0;r<e;++r)n.push(t(r));return n},e.listsEqual=function(e,t){if(!e||!t||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0},e.oops=function(e){throw void 0===e&&(e="OOPS"),new Error(e)},e.reversed=function(e){return(e=e.slice(0)).reverse(),e},e.flatClone=function(e){if(null==e)return null;var t={};return Object.keys(e).forEach(function(n){t[n]=e[n]}),t},e.clone=n,e.iterMap=function(e,t){Object.keys(e).forEach(function(n){return t(n,e[n])})},e.mapMap=function(e,t){var n={};return Object.keys(e).forEach(function(r){return n[r]=t(r,e[r])}),n},e.mapStringMapAsync=function(e,t){var n={};return Promise.all(Object.keys(e).map(function(r){return t(r,e[r]).then(function(e){return n[r]=e})})).then(function(){return n})},e.values=function(e){return Object.keys(e||{}).map(function(t){return e[t]})},e.lookup=function(e,t){return e.hasOwnProperty(t)?e[t]:null},e.pushRange=r,e.concat=function(e){for(var t=[],n=0;n<e.length;++n)r(t,e[n]);return t},e.memcpy=o,e.uint8ArrayConcat=function(e){for(var t=0,n=0,r=e;n<r.length;n++)t+=(l=r[n]).length;for(var i=new Uint8Array(t),a=0,s=0,c=e;s<c.length;s++){var l=c[s];o(i,a,l),a+=l.length}return i},e.jsonMergeFrom=a,e.jsonCopyFrom=function(e,t){for(var r=n(t),i=0,o=Object.keys(t);i<o.length;i++){var a=o[i];e[a]=r[a]}},e.jsonFlatten=function(e){var n={},r=function(e,i){if(null!==i&&"object"==typeof i){t(!Array.isArray(i)),e&&(e+=".");for(var o=0,a=Object.keys(i);o<a.length;o++){var s=a[o];r(e+s,i[s])}}else n[e]=i};return r("",e),n},e.jsonUnFlatten=function(e){for(var t={},n=0,r=Object.keys(e);n<r.length;n++)for(var i=r[n],o=t,a=i.split("."),s=0;s<a.length;++s){var c=a[s];s==a.length-1?o[c]=e[i]:("object"!=typeof o[c]&&(o[c]={}),o=o[c])}return t},e.strcmp=s,e.stringMapEq=function(e,t){var n=Object.keys(e),r=Object.keys(t);if(n.length!=r.length)return!1;for(var i=0,o=n;i<o.length;i++){var a=o[i];if(!t.hasOwnProperty(a))return!1;if(e[a]!==t[a])return!1}return!0},e.endsWith=function(e,t){return!(e.length<t.length||0!=t.length&&e.slice(-t.length)!=t)},e.startsWith=function(e,t){return!(e.length<t.length||0!=t.length&&e.slice(0,t.length)!=t)},e.contains=function(e,t){return!(e.length<t.length)&&(0==t.length||e.indexOf(t)>-1)},e.replaceAll=function(e,t,n){return t?e.split(t).join(n):e},e.sortObjectFields=function(e){var t=Object.keys(e);t.sort(s);var n={};return t.forEach(function(t){return n[t]=e[t]}),n},e.chopArray=function(e,t){for(var n=[],r=0;r<e.length;r+=t)n.push(e.slice(r,r+t));return n},e.unique=function(e,t){var n=[],r={};return e.forEach(function(e){var i=t(e);r.hasOwnProperty(i)||(r[i]=null,n.push(e))}),n},e.groupBy=function(e,t){var n={};return e.forEach(function(e){var r=t(e);n.hasOwnProperty(r)||(n[r]=[]),n[r].push(e)}),n},e.toDictionary=function(e,t){var n={};return e.forEach(function(e){n[t(e)]=e}),n},e.toArray=function(e){for(var t=[],n=0;n<e.length;++n)t.push(e[n]);return t},e.indexOfMatching=function(e,t){for(var n=0;n<e.length;++n)if(t(e[n]))return n;return-1},e.nextTick=function(e){Promise._async._schedule(e)},e.memoizeString=function(e){return c(function(e){return e},e)},e.memoize=c,e.debounce=function(e,t,n){var r;return function(){var i=this,o=arguments,a=n&&!r;clearTimeout(r),r=setTimeout(function(){r=null,n||e.apply(i,o)},t),a&&e.apply(i,o)}},e.throttle=function(e,t,n){var r;return function(){var i=this,o=arguments,a=n&&!r;r||(r=setTimeout(function(){r=null,n||e.apply(i,o)},t)),a&&e.apply(i,o)}},e.randomPermute=function(e){for(var t=0;t<e.length;++t){var n=h()%e.length,r=e[t];e[t]=e[n],e[n]=r}},e.randomPick=function(e){return 0==e.length?null:e[h()%e.length]},e.isoTime=function(t){var n=new Date(1e3*t);return e.fmt("{0}-{1:f02.0}-{2:f02.0} {3:f02.0}:{4:f02.0}:{5:f02.0}",n.getFullYear(),n.getMonth()+1,n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds())},e.timeSince=function(e){var t=(Date.now()-(e*=1e3))/1e3;return isNaN(t)?"":t<-30?(t=-t)<60?A("in a few seconds"):t<120?A("in a minute"):t<3600?A("in {0} minute{0:s}",Math.floor(t/60)):t<7200?A("in an hour"):t<86400?A("in {0} hour{0:s}",Math.floor(t/60/60)):t<2592e3?A("in {0} day{0:s}",Math.floor(t/60/60/24)):t<31536e3?A("in {0} month{0:s}",Math.floor(t/60/60/24/30)):A("in {0} year{0:s}",Math.floor(t/60/60/24/365)):t<0?A("now"):t<10?A("a few seconds ago"):t<60?A("{0} second{0:s} ago",Math.floor(t)):t<120?A("a minute ago"):t<3600?A("{0} minute{0:s} ago",Math.floor(t/60)):t<7200?A("an hour ago"):t<86400?A("{0} hour{0:s} ago",Math.floor(t/60/60)):t<2592e3?A("{0} day{0:s} ago",Math.floor(t/60/60/24)):t<31536e3?A("{0} month{0:s} ago",Math.floor(t/60/60/24/30)):A("{0} year{0:s} ago",Math.floor(t/60/60/24/365))},e.unicodeToChar=function(e){var t=/\\u([\d\w]{4})/gi;return e.replace(t,function(e,t){return String.fromCharCode(parseInt(t,16))})},e.escapeForRegex=function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},e.stripUrlProtocol=function(e){return e.replace(/.*?:\/\//g,"")},e.normalizePath=l,e.pathJoin=function(e,t){if(l(e),l(t),e||t)return e?t?("/"!==e.charAt(e.length-1)&&(e+="/"),"/"==t.charAt(0)&&(t=t.substring(1)),e+t):e:t},e.isNodeJS=!1,e.requestAsync=u,e.httpGetTextAsync=function(e){return u({url:e}).then(function(e){return e.text})},e.httpGetJsonAsync=function(e){return u({url:e}).then(function(e){return e.json})},e.httpPostJsonAsync=function(e,t){return u({url:e,data:t||{}}).then(function(e){return e.json})},e.userError=function(e){var t=new Error(e);throw t.isUserError=!0,t},e.stringToUint8Array=function(e){for(var t=e.length,n=new Uint8Array(t),r=0;r<t;++r)n[r]=255&e.charCodeAt(r);return n},e.uint8ArrayToString=function(e){for(var t=e.length,n="",r=0;r<t;++r)n+=String.fromCharCode(e[r]);return n},e.fromUTF8=function(e){if(!e)return"";for(var t="",n=0;n<e.length;++n){var r=255&e.charCodeAt(n);t+=37==r||r>127?"%"+r.toString(16):e.charAt(n)}return decodeURIComponent(t)},e.toUTF8=f,e.toHex=function(e){for(var t="",n=0;n<e.length;++n)t+=("0"+e[n].toString(16)).slice(-2);return t},e.fromHex=function(e){for(var t=new Uint8Array(e.length>>1),n=0;n<e.length;n+=2)t[n>>1]=parseInt(e.slice(n,n+2),16);return t};var w=function(){function e(){this.promises={}}return e.prototype.enqueue=function(e,t){var n=this;return new Promise(function(r,i){var o=n.promises[e];o||(o=n.promises[e]=[]),o.push(function(){return t().finally(function(){o.shift(),0==o.length?delete n.promises[e]:o[0]()}).then(r,i)}),1==o.length&&o[0]()})},e}();e.PromiseQueue=w;var E=function(){function e(){this.waiting=[],this.available=[]}return e.prototype.drain=function(){for(var e=0,t=this.waiting;e<t.length;e++)(0,t[e])(new Error("Promise Buffer Reset"));this.waiting=[],this.available=[]},e.prototype.pushError=function(e){this.push(e)},e.prototype.push=function(e){var t=this.waiting.shift();t?t(e):this.available.push(e)},e.prototype.shiftAsync=function(e){var t=this;if(void 0===e&&(e=0),this.available.length>0){var n=this.available.shift();return n instanceof Error?Promise.reject(n):Promise.resolve(n)}return new Promise(function(n,r){var i=function(e){e instanceof Error?r(e):n(e)};t.waiting.push(i),e>0&&Promise.delay(e).then(function(){var e=t.waiting.indexOf(i);e>=0&&(t.waiting.splice(e,1),r(new Error("Timeout")))})})},e}();e.PromiseBuffer=E,e.now=p,e.nowSeconds=function(){return Math.round(p()/1e3)},e.getMime=function(e){var t=/\.([a-zA-Z0-9]+)$/.exec(e);if(!t)return"application/octet-stream";switch(t[1].toLowerCase()){case"txt":return"text/plain";case"html":case"htm":return"text/html";case"css":return"text/css";case"js":return"application/javascript";case"jpg":case"jpeg":return"image/jpeg";case"png":return"image/png";case"ico":return"image/x-icon";case"manifest":return"text/cache-manifest";case"webmanifest":return"application/manifest+json";case"json":return"application/json";case"svg":return"image/svg+xml";case"eot":return"application/vnd.ms-fontobject";case"ttf":return"font/ttf";case"woff":return"application/font-woff";case"woff2":return"application/font-woff2";case"md":return"text/markdown";case"xml":return"application/xml";case"m4a":return"audio/m4a";case"mp3":return"audio/mp3";default:return"application/octet-stream"}},e.randomUint32=h,e.guidGen=function(){function e(){return(65536|h()).toString(16).slice(-4)}return e()+e()+"-"+e()+"-4"+e().slice(-3)+"-"+e()+"-"+e()+e()+e()};var k="en",T={},_={};e.localizeLive=!1;var S=function(){function e(){this.translations={}}return e.prototype.key=function(e,t,n){return e+"|"+t+"|"+(n||"")},e.prototype.getAsync=function(e,t,n){return Promise.resolve(this.translations[this.key(e,t,n)])},e.prototype.setAsync=function(e,t,n,r,i){return this.translations[this.key(e,t,n)]={etag:r,strings:i,cached:!0},Promise.resolve()},e}();e.translationDb=new S,e.localeInfo=function(){return(e.localizeLive?"live-":"")+d()},e.userLanguage=d,e.isUserLanguageRtl=function(){return/^ar|dv|fa|ha|he|ks|ku|ps|ur|yi/i.test(k)},e._localize=function(e){return T[e]||e},e.downloadLiveTranslationsAsync=g,e.getLocalizedStrings=function(){return T},e.setLocalizedStrings=function(e){T=e},e.updateLocalizationAsync=function(t,n,r,i,o,a,s){return(i=m(i))===k?Promise.resolve():v(t,n,r,i,o,a,s).then(function(t){return t&&(k=i,T=t,s&&(e.localizeLive=!0)),Promise.resolve()})},e.downloadSimulatorLocalizationAsync=function(e,t,n,r,i,o){return(n=m(n))===k?Promise.resolve(void 0):v(e,!0,t,n,r,i,o)},e.downloadTranslationsAsync=v,e.htmlEscape=function(e){return e?e.replace(/([^\w .!?\-$])/g,function(e){return"&#"+e.charCodeAt(0)+";"}):e},e.jsStringQuote=y,e.jsStringLiteral=function(e){return'"'+y(e)+'"'},e.fmt_va=b,e.fmt=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return b(e,t)};var U={};e.dumpLocStats=function(){var e={};Object.keys(U).sort(function(e,t){return U[t]-U[e]}).forEach(function(t){return e[t]=t}),console.log("prioritized list of strings:"),console.log(JSON.stringify(e,null,2))};var O=!0;e.lf_va=x,e.lf=A,e.rlf=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return x(e,t)},e.capitalize=function(e){return e?e[0].toLocaleUpperCase()+e.slice(1):e},e.uncapitalize=function(e){return(e||"").split(/(?=[A-Z])/g).join(" ").toLowerCase()},e.range=function(e){for(var t=[],n=0;n<e;++n)t.push(n);return t},e.multipartPostAsync=function(t,n,r,i){function o(e,t){s+=a+"\r\n",s+='Content-Disposition: form-data; name="'+e+'"\r\n\r\n',s+=t+"\r\n"}void 0===n&&(n={}),void 0===r&&(r=null),void 0===i&&(i=null);var a="--------------------------0461489f461126c5",s="";Object.keys(n).forEach(function(e){return o(e,n[e])}),r&&function(e,t){var n=e.split("/").reverse()[0];s+=a+"\r\n",s+='Content-Disposition: form-data; name="files['+e+']"; filename="'+n+'"\r\n',s+="\r\n",s+=t+"\r\n"}(r,i),s+=a+"--\r\n";var c={url:t,method:"POST",headers:{"Content-Type":"multipart/form-data; boundary="+a.slice(2)},data:s};return e.httpRequestCoreAsync(c)},e.toDataUri=function(e,t){return/^https?:/i.test(e)?e:/^data:/i.test(e)?e:(t||/^<svg/i.test(e)&&(t="image/svg+xml"),/xml|svg/.test(t)?"data:"+t+","+encodeURIComponent(e):"data:"+(t||"image/png")+";base64,"+btoa(f(e)))}}(e.Util||(e.Util={}))}(e.pxtc||(e.pxtc={}))}(ts||(ts={}));var ts;!function(e){!function(e){!function(t){function n(e,t){return e>>>t|e<<32-t}function r(t,r){e.Util.assert(8==t.length),e.Util.assert(64==r.length);for(g=16;g<64;++g){var i=n(r[g-15],7)^n(r[g-15],18)^r[g-15]>>>3,o=n(r[g-2],17)^n(r[g-2],19)^r[g-2]>>>10;r[g]=r[g-16]+i+r[g-7]+o|0}for(var s=t[0],c=t[1],l=t[2],u=t[3],f=t[4],p=t[5],h=t[6],d=t[7],g=0;g<64;++g){var m=d+(o=n(f,6)^n(f,11)^n(f,25))+(f&p^~f&h)+a[g]+r[g]|0,v=s&c^s&l^c&l;d=h,h=p,p=f,f=u+m|0,u=l,l=c,c=s,s=m+((i=n(s,2)^n(s,13)^n(s,22))+v|0)|0}t[0]+=s,t[1]+=c,t[2]+=l,t[3]+=u,t[4]+=f,t[5]+=p,t[6]+=h,t[7]+=d}function i(e){function t(e){for(var t=e.length-(o-1),a=0;a<t;a+=o){for(var s=0;s<16;s++){var c=(s<<2)+a;i[s]=e[c]<<24|e[c+1]<<16|e[c+2]<<8|e[c+3]}r(n,i)}}var n=new Uint32Array(8);n[0]=1779033703,n[1]=3144134277,n[2]=1013904242,n[3]=2773480762,n[4]=1359893119,n[5]=2600822924,n[6]=528734635,n[7]=1541459225;var i=new Uint32Array(64),o=64;t(e);var a=64-(e.length+9)%64;64==a&&(a=0);for(var s=e.length-e.length%o,c=new Uint8Array(e.length-s+1+a+8),l=0;s<e.length;)c[l++]=e[s++];for(c[l++]=128;a-- >0;)c[l++]=0;var u=8*e.length;for(l=c.length;u>0;)c[--l]=255&u,u>>=8;t(c);for(var f="",p=0;p<n.length;++p)f+=("000000000"+n[p].toString(16)).slice(-8);return f.toLowerCase()}function o(t){return i(e.Util.stringToUint8Array(e.Util.toUTF8(t)))}e.Util.httpRequestCoreAsync=function(t){return new Promise(function(n,r){var i,o=!1,a=e.Util.clone(t.headers)||{};i=new XMLHttpRequest,t.responseArrayBuffer&&(i.responseType="arraybuffer"),i.onreadystatechange=function(){if(!o&&4==i.readyState){o=!0;var e={statusCode:i.status,headers:{},buffer:i.responseBody||i.response,text:t.responseArrayBuffer?void 0:i.responseText};i.getAllResponseHeaders().split(/\r?\n/).forEach(function(t){var n=/^\s*([^:]+): (.*)/.exec(t);n&&(e.headers[n[1].toLowerCase()]=n[2])}),n(e)}};var s,c=t.data,l=t.method||(null==c?"GET":"POST");null==c?s=null:c instanceof Uint8Array?s=c:"object"==typeof c?(s=JSON.stringify(c),a["content-type"]="application/json; charset=utf8"):"string"==typeof c?s=c:e.Util.oops("bad data"),i.open(l,t.url),Object.keys(a).forEach(function(e){i.setRequestHeader(e,a[e])}),null==s?i.send():i.send(s)})},e.Util.sha256=o,e.Util.getRandomBuf=function(e){if(window.crypto)window.crypto.getRandomValues(e);else for(var t=0;t<e.length;++t)e[t]=Math.floor(255*Math.random())};var a=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);t.sha256buffer=i,t.sha256string=o}(e.BrowserImpl||(e.BrowserImpl={}))}(e.pxtc||(e.pxtc={}))}(ts||(ts={}));var pxt;!function(e){function t(){return{relprefix:"/--",workerjs:"/worker.js",tdworkerjs:"/tdworker.js",monacoworkerjs:"/monacoworker.js",pxtVersion:"local",pxtRelId:"",pxtCdnUrl:"/cdn/",commitCdnUrl:"/cdn/",blobCdnUrl:"/blb/",cdnUrl:"/cdn/",targetUrl:"",targetVersion:"local",targetRelId:"",targetId:e.appTarget?e.appTarget.id:"",simUrl:"/sim/simulator.html",partsUrl:"/sim/siminstructions.html"}}function n(){return a?Promise.resolve(a):e.Cloud.downloadTargetConfigAsync().then(function(e){return a=e},function(e){a=void 0})}function r(t){return void 0===t&&(t=null),t||(t=e.appTarget.compile),t.nativeType==ts.pxtc.NATIVE_TYPE_CS?ts.pxtc.BINARY_CS:t.useUF2?ts.pxtc.BINARY_UF2:t.useELF?ts.pxtc.BINARY_ELF:ts.pxtc.BINARY_HEX}e.U=pxtc.Util,e.Util=pxtc.Util;e.U.lf;e.setAppTarget=function(t){e.appTarget=t||{};var n=e.appTarget.compile;n||(n=e.appTarget.compile={isNative:!1,hasHex:!1}),n.hasHex&&void 0===n.jsRefCounting&&(n.jsRefCounting=!0),n.hasHex||void 0!==n.floatingPoint||(n.floatingPoint=!0),n.hasHex&&!n.nativeType&&(n.nativeType=pxtc.NATIVE_TYPE_THUMB),n.nativeType!=pxtc.NATIVE_TYPE_AVR&&n.nativeType!=pxtc.NATIVE_TYPE_AVRVM||(n.shortPointers=!0,n.flashCodeAlign=16),n.nativeType==pxtc.NATIVE_TYPE_CS&&(n.floatingPoint=!0,n.needsUnboxing=!0,n.jsRefCounting=!1),n.taggedInts&&(n.floatingPoint=!0,n.needsUnboxing=!0),e.appTarget.appTheme||(e.appTarget.appTheme={}),e.appTarget.appTheme.embedUrl||(e.appTarget.appTheme.embedUrl=e.appTarget.appTheme.homeUrl);var r=e.appTarget.compileService;r&&r.yottaTarget&&!r.yottaBinary&&(r.yottaBinary="pxt-microbit-app-combined.hex")},e.options={},e.debug="undefined"!=typeof console&&console.debug?function(t){e.options.debug&&console.debug(t)}:function(){},e.log="undefined"!=typeof console&&console.log?function(e){console.log(e)}:function(){},e.reportException=function(e,t){if(console&&(console.error(e),t))try{console.log(t)}catch(e){}},e.reportError=function(t,n,r){if(console&&(console.error(t+": "+n),r))try{e.log(JSON.stringify(r,null,2))}catch(e){}},e.tickEvent=function(e){};var i={},o=e.Util.debounce(function(){e.tickEvent("activity",i),i={}},1e4,!1);e.tickActivity=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];e.filter(function(e){return!!e}).map(function(e){return e.slice(0,64)}).forEach(function(e){return i[e]=(i[e]||0)+1}),o()},e.localWebConfig=t,e.getOnlineCdnUrl=function(){if(!e.webConfig)return null;var t=/^(https:\/\/[^\/]+)/.exec(e.webConfig.commitCdnUrl);return t?t[1]:null},e.setupWebConfig=function(n){n?e.webConfig=n:e.webConfig||(e.webConfig=t())},e.getEmbeddedScript=function(t){return e.U.lookup(e.appTarget.bundledpkgs||{},t)};var a=void 0;e.targetConfigAsync=n,e.packagesConfigAsync=function(){return n().then(function(e){return e?e.packages:void 0})},e.CONFIG_NAME="pxt.json",e.SERIAL_EDITOR_FILE="serial.txt",e.CLOUD_ID="pxt/",e.BLOCKS_PROJECT_NAME="blocksprj",e.JAVASCRIPT_PROJECT_NAME="tsprj",e.outputName=r,e.isOutputText=function(e){return void 0===e&&(e=null),r(e)==ts.pxtc.BINARY_HEX}}(pxt||(pxt={}));var pxt;!function(e){!function(t){function n(){(r={device_while:{name:e.Util.lf("a loop that repeats while the condition is true"),tooltip:e.Util.lf("Run the same sequence of actions while the condition is met."),url:"/blocks/loops/while",category:"loops",block:{message0:e.Util.lf("while %1"),appendField:e.Util.lf("{id:while}do")}},controls_simple_for:{name:e.Util.lf("a loop that repeats the number of times you say"),tooltip:e.Util.lf("Have the variable '{0}' take on the values from 0 to the end number, counting by 1, and do the specified blocks."),url:"blocks/loops/for",category:"loops",block:{message0:e.Util.lf("for %1 from 0 to %2"),variable:e.Util.lf("{id:var}index"),appendField:e.Util.lf("{id:for}do")}},controls_for_of:{name:e.Util.lf("a loop that repeats for each value in an array"),tooltip:e.Util.lf("Have the variable '{0}' take the value of each item in the array one by one, and do the specified blocks."),url:"blocks/loops/for-of",category:"loops",block:{message0:e.Util.lf("for element %1 of %2"),variable:e.Util.lf("{id:var}value"),appendField:e.Util.lf("{id:for_of}do")}},math_op2:{name:e.Util.lf("minimum or maximum of 2 numbers"),tooltip:{min:e.Util.lf("smaller value of 2 numbers"),max:e.Util.lf("larger value of 2 numbers")},url:"/blocks/math",operators:{op:["min","max"]},category:"math"},math_op3:{name:e.Util.lf("absolute number"),tooltip:e.Util.lf("absolute value of a number"),url:"/reference/math",category:"math",block:{message0:e.Util.lf("absolute of %1")}},math_number:{name:e.Util.lf("{id:block}number"),url:"/blocks/math/random",category:"math"},math_number_minmax:{name:e.Util.lf("{id:block}number"),url:"/blocks/math/random",category:"math"},math_arithmetic:{name:e.Util.lf("arithmetic operation"),url:"/blocks/math",tooltip:{ADD:e.Util.lf("Return the sum of the two numbers."),MINUS:e.Util.lf("Return the difference of the two numbers."),MULTIPLY:e.Util.lf("Return the product of the two numbers."),DIVIDE:e.Util.lf("Return the quotient of the two numbers."),POWER:e.Util.lf("Return the first number raised to the power of the second number.")},operators:{OP:["ADD","MINUS","MULTIPLY","DIVIDE","POWER"]},category:"math",block:{MATH_ADDITION_SYMBOL:e.Util.lf("{id:op}+"),MATH_SUBTRACTION_SYMBOL:e.Util.lf("{id:op}-"),MATH_MULTIPLICATION_SYMBOL:e.Util.lf("{id:op}×"),MATH_DIVISION_SYMBOL:e.Util.lf("{id:op}÷"),MATH_POWER_SYMBOL:e.Util.lf("{id:op}^")}},math_modulo:{name:e.Util.lf("division remainder"),tooltip:e.Util.lf("Return the remainder from dividing the two numbers."),url:"/blocks/math",category:"math",block:{MATH_MODULO_TITLE:e.Util.lf("remainder of %1 ÷ %2")}},variables_change:{name:e.Util.lf("update the value of a number variable"),tooltip:e.Util.lf("Changes the value of the variable by this amount"),url:"/blocks/variables/change",category:"variables",block:{message0:e.Util.lf("change %1 by %2")}},controls_repeat_ext:{name:e.Util.lf("a loop that repeats and increments an index"),tooltip:e.Util.lf("Do some statements several times."),url:"/blocks/loops/repeat",category:"loops",block:{CONTROLS_REPEAT_TITLE:e.Util.lf("repeat %1 times"),CONTROLS_REPEAT_INPUT_DO:e.Util.lf("{id:repeat}do")}},variables_get:{name:e.Util.lf("get the value of a variable"),tooltip:e.Util.lf("Returns the value of this variable."),url:"/blocks/variables",category:"variables",block:{VARIABLES_GET_CREATE_SET:e.Util.lf("Create 'set %1'")}},variables_set:{name:e.Util.lf("assign the value of a variable"),tooltip:e.Util.lf("Sets this variable to be equal to the input."),url:"/blocks/variables/assign",category:"variables",block:{VARIABLES_SET:e.Util.lf("set %1 to %2")}},controls_if:{name:e.Util.lf("a conditional statement"),tooltip:{CONTROLS_IF_TOOLTIP_1:e.Util.lf("If a value is true, then do some statements."),CONTROLS_IF_TOOLTIP_2:e.Util.lf("If a value is true, then do the first block of statements. Otherwise, do the second block of statements."),CONTROLS_IF_TOOLTIP_3:e.Util.lf("If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements."),CONTROLS_IF_TOOLTIP_4:e.Util.lf("If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements. If none of the values are true, do the last block of statements.")},tooltipSearch:"CONTROLS_IF_TOOLTIP_2",url:"/blocks/logic/if",category:"logic",block:{CONTROLS_IF_MSG_IF:e.Util.lf("{id:logic}if"),CONTROLS_IF_MSG_THEN:e.Util.lf("{id:logic}then"),CONTROLS_IF_MSG_ELSE:e.Util.lf("{id:logic}else"),CONTROLS_IF_MSG_ELSEIF:e.Util.lf("{id:logic}else if")}},lists_create_with:{name:e.Util.lf("create an array"),tooltip:e.Util.lf("Creates a new array."),url:"/reference/arrays/create",category:"arrays",blockTextSearch:"LISTS_CREATE_WITH_INPUT_WITH",block:{LISTS_CREATE_EMPTY_TITLE:e.Util.lf("create empty array"),LISTS_CREATE_WITH_INPUT_WITH:e.Util.lf("create array with"),LISTS_CREATE_WITH_CONTAINER_TITLE_ADD:e.Util.lf("array"),LISTS_CREATE_WITH_ITEM_TITLE:e.Util.lf("value")}},lists_length:{name:e.Util.lf("array length"),tooltip:e.Util.lf("Returns the number of items in an array."),url:"/reference/arrays/length",category:"arrays",block:{LISTS_LENGTH_TITLE:e.Util.lf("length of array %1")}},lists_index_get:{name:e.Util.lf("get a value in an array"),tooltip:e.Util.lf("Returns the value at the given index in an array."),url:"/reference/arrays/get",category:"arrays",block:{message0:e.Util.lf("%1 get value at %2")}},lists_index_set:{name:e.Util.lf("set a value in an array"),tooltip:e.Util.lf("Sets the value at the given index in an array"),url:"/reference/arrays/set",category:"arrays",block:{message0:e.Util.lf("%1 set value at %2 to %3")}},logic_compare:{name:e.Util.lf("comparing two numbers"),tooltip:{LOGIC_COMPARE_TOOLTIP_EQ:e.Util.lf("Return true if both inputs equal each other."),LOGIC_COMPARE_TOOLTIP_NEQ:e.Util.lf("Return true if both inputs are not equal to each other."),LOGIC_COMPARE_TOOLTIP_LT:e.Util.lf("Return true if the first input is smaller than the second input."),LOGIC_COMPARE_TOOLTIP_LTE:e.Util.lf("Return true if the first input is smaller than or equal to the second input."),LOGIC_COMPARE_TOOLTIP_GT:e.Util.lf("Return true if the first input is greater than the second input."),LOGIC_COMPARE_TOOLTIP_GTE:e.Util.lf("Return true if the first input is greater than or equal to the second input.")},url:"/blocks/logic/boolean",category:"logic",block:{search:"= ≠ < ≤ > ≥"}},logic_operation:{name:e.Util.lf("boolean operation"),tooltip:{LOGIC_OPERATION_TOOLTIP_AND:e.Util.lf("Return true if both inputs are true."),LOGIC_OPERATION_TOOLTIP_OR:e.Util.lf("Return true if at least one of the inputs is true.")},url:"/blocks/logic/boolean",category:"logic",block:{LOGIC_OPERATION_AND:e.Util.lf("{id:op}and"),LOGIC_OPERATION_OR:e.Util.lf("{id:op}or")}},logic_negate:{name:e.Util.lf("logical negation"),tooltip:e.Util.lf("Returns true if the input is false. Returns false if the input is true."),url:"/blocks/logic/boolean",category:"logic",block:{LOGIC_NEGATE_TITLE:e.Util.lf("not %1")}},logic_boolean:{name:e.Util.lf("a `true` or `false` value"),tooltip:e.Util.lf("Returns either true or false."),url:"/blocks/logic/boolean",category:"logic",block:{LOGIC_BOOLEAN_TRUE:e.Util.lf("{id:boolean}true"),LOGIC_BOOLEAN_FALSE:e.Util.lf("{id:boolean}false")}},text:{name:e.Util.lf("a piece of text"),tooltip:e.Util.lf("A letter, word, or line of text."),url:"types/string",category:"text",block:{search:e.Util.lf("a piece of text")}},text_length:{name:e.Util.lf("number of characters in the string"),tooltip:e.Util.lf("Returns the number of letters (including spaces) in the provided text."),url:"reference/text/length",category:"text",block:{TEXT_LENGTH_TITLE:e.Util.lf("length of %1")}},text_join:{name:e.Util.lf("join items to create text"),tooltip:e.Util.lf("Create a piece of text by joining together any number of items."),url:"reference/text/join",category:"text",block:{TEXT_JOIN_TITLE_CREATEWITH:e.Util.lf("join")}},procedures_defnoreturn:{name:e.Util.lf("define the function"),tooltip:e.Util.lf("Create a function."),url:"types/function/define",category:"functions",block:{PROCEDURES_DEFNORETURN_TITLE:e.Util.lf("function"),PROCEDURE_ALREADY_EXISTS:e.Util.lf("A function named '%1' already exists.")}},procedures_callnoreturn:{name:e.Util.lf("call the function"),tooltip:e.Util.lf("Call the user-defined function."),url:"types/function/call",category:"functions",block:{PROCEDURES_CALLNORETURN_TITLE:e.Util.lf("call function")}}})[pxtc.ON_START_TYPE]={name:e.Util.lf("on start event"),tooltip:e.Util.lf("Run code when the program starts"),url:"/blocks/on-start",category:"loops",block:{message0:e.Util.lf("on start %1 %2")}}}t.normalizeBlock=function(t){if(!t)return t;var n=t.replace(/%\s+/g,"%");return n!=t?(e.log("block has extra spaces: "+t),t):n=n.replace(/\s*\|\s*/g,"|")},t.parameterNames=function(e){var t=(e.kind==ts.pxtc.SymbolKind.Method||e.kind==ts.pxtc.SymbolKind.Property)&&!e.attributes.defaultInstance,n={},r=[];if(t&&(n.this={name:"this",type:e.namespace}),e.parameters&&e.parameters.forEach(function(e){n[e.name]={name:e.name,type:e.type,shadowValue:e.default||void 0},e.handlerParameters&&e.handlerParameters.forEach(function(e){return r.push(e)})}),e.attributes.block){Object.keys(n).forEach(function(e){return n[e].name=""});for(var i=/%([a-zA-Z0-9_]+)(=([a-zA-Z0-9_]+))?/g,o=void 0,a=0;(o=i.exec(e.attributes.block))&&(0!=a||!t||(n.this.name=o[1],o[3]&&(n.this.shadowType=o[3]),o=i.exec(e.attributes.block)));){var s=n[e.parameters[a++].name];s.name=o[1],o[3]&&(s.shadowType=o[3])}}return{attrNames:n,handlerArgs:r}},t.parseFields=function(e){return e.split("|").map(function(e,t){var n=/([^%]*)\s*%([a-zA-Z0-9_]+)/.exec(e);if(!n)return{n:e,ni:t};var r=n[1];return r&&(r=r.trim()),{n:e,ni:t,pre:r,p:n[2]}})};var r;t.blockDefinitions=function(){return r||n(),r},t.getBlockDefinition=function(e){return r||n(),r[e]}}(e.blocks||(e.blocks={}))}(pxt||(pxt={}));var pxt;!function(e){!function(t){function n(){return"undefined"!=typeof navigator}function r(){return n()&&/(Win32|Win64|WOW64)/i.test(navigator.platform)}function i(){return n()&&/mobi/i.test(navigator.userAgent)}function o(){return n()&&/Mac/i.test(navigator.platform)}function a(){return!!navigator&&/Linux/i.test(navigator.platform)}function s(){return n()&&/arm/i.test(navigator.platform)}function c(){return n()&&/Edge/i.test(navigator.userAgent)}function l(){return n()&&/Trident/i.test(navigator.userAgent)}function u(){return!c()&&!l()&&!!navigator&&(/Chrome/i.test(navigator.userAgent)||/Chromium/i.test(navigator.userAgent))}function f(){return!u()&&!c()&&!!navigator&&/(Safari|iPod|iPhone|iPad)/i.test(navigator.userAgent)}function p(){return!f()&&!!navigator&&(/Firefox/i.test(navigator.userAgent)||/Seamonkey/i.test(navigator.userAgent))}function h(){return n()&&/Opera|OPR/i.test(navigator.userAgent)}function d(){return n()&&/Midori/i.test(navigator.userAgent)}function g(){return n()&&/Epiphany/i.test(navigator.userAgent)}function m(){return r()?"windows":o()?"mac":a()&&s()?"rpi":a()?"linux":"unknown"}function v(){return c()?"edge":g()?"epiphany":d()?"midori":h()?"opera":l()?"ie":u()?"chrome":f()?"safari":p()?"firefox":"unknown"}function y(){if(!n())return null;var e=[];return h()&&(e=/(Opera|OPR)\/([0-9\.]+)/i.exec(navigator.userAgent)),g()?e=/Epiphany\/([0-9\.]+)/i.exec(navigator.userAgent):d()?e=/Midori\/([0-9\.]+)/i.exec(navigator.userAgent):f()?(e=/Version\/([0-9\.]+)/i.exec(navigator.userAgent))||(e=/(iPod|iPhone|iPad); CPU .*?OS (\d+)/i.exec(navigator.userAgent)):e=u()?/(Chrome|Chromium)\/([0-9\.]+)/i.exec(navigator.userAgent):c()?/Edge\/([0-9\.]+)/i.exec(navigator.userAgent):l()?/(MSIE |rv:)([0-9\.]+)/i.exec(navigator.userAgent):/(Firefox|Seamonkey)\/([0-9\.]+)/i.exec(navigator.userAgent),e&&0!=e.length?e[e.length-1]:null}function b(){return i()&&f()&&!/downloadWindowOpen=0/i.test(window.location.href)}function x(t,n,r){var o=b(),a=y(),s=parseInt(a||"0");if(o)r?r.location.href=t:window.open(t,"_self");else if(e.BrowserUtils.isSafari()&&(s<10||0==a.indexOf("10.0")||i())){var c=document.getElementById("downloader");c||(e.debug("injecting downloader iframe"),(c=document.createElement("iframe")).id="downloader",c.style.position="absolute",c.style.right="0",c.style.bottom="0",c.style.zIndex="-1",c.style.width="1px",c.style.height="1px",document.body.appendChild(c)),c.src=t}else if(e.BrowserUtils.isEdge()||e.BrowserUtils.isIE()){var l=atob(t.split(",")[1]),u=e.Util.stringToUint8Array(l),f=new Blob([u],{type:"img/png"});window.navigator.msSaveOrOpenBlob(f,n)}else{var p=window.document.createElement("a");"string"==typeof p.download?(p.href=t,p.download=n,document.body.appendChild(p),p.click(),document.body.removeChild(p)):document.location.href=t}}function A(t,n,r,o,a){void 0===r&&(r="application/octet-stream"),e.debug("trigger download");var s=e.BrowserUtils.isMobile(),c=window.navigator.msSaveOrOpenBlob&&!s,l="data";i()&&f()&&e.appTarget.appTheme.mobileSafariDownloadProtocol&&(l=e.appTarget.appTheme.mobileSafariDownloadProtocol);var u=/downloadProtocol=([a-z0-9:/?]+)/i.exec(window.location.href);u&&(l=u[1]);var p=l+":"+r+";base64,"+t;try{if(c){var h=new Blob([e.Util.stringToUint8Array(atob(t))],{type:r});window.navigator.msSaveOrOpenBlob(h,n)}else x(p,n,o)}catch(t){a&&a(t),e.debug("saving failed")}return p}t.isIFrame=function(){try{return window&&window.self!==window.top}catch(e){return!0}},t.hasNavigator=n,t.isWindows=r,t.isWindows10=function(){return n()&&/(Win32|Win64|WOW64)/i.test(navigator.platform)&&/Windows NT 10/i.test(navigator.userAgent)},t.isMobile=i,t.isMac=o,t.isLinux=a,t.isARM=s,t.isUwpEdge=function(){return"undefined"!=typeof window&&!!window.Windows},t.isEdge=c,t.isIE=l,t.isChrome=u,t.isSafari=f,t.isFirefox=p,t.isOpera=h,t.isMidori=d,t.isEpiphany=g,t.isTouchEnabled=function(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator.maxTouchPoints>0)},t.hasPointerEvents=function(){return"undefined"!=typeof window&&!!window.PointerEvent},t.hasSaveAs=function(){return c()||l()||p()},t.os=m,t.browser=v,t.browserVersion=y;var w=!1;t.isBrowserSupported=function(){if(!navigator)return!0;if(/bot|crawler|spider|crawling/i.test(navigator.userAgent))return!0;var t=y(),n=parseInt(t||"0"),r=u()&&n>=38,i=p()&&n>=31,o=c(),b=f()&&n>=9,x=h()&&u()&&n>=21,A=l()&&n>=11,E=r||i||o||b||x||A,k=d()||a()&&s()&&g();return E=E&&!k,E=E||/anybrowser=(true|1)/.test(window.location.href),w||(e.log("Browser: "+v()+" "+t+" on "+m()),E||e.tickEvent("browser.unsupported."+navigator.userAgent),w=!0),E},t.devicePixelRatio=function(){return"undefined"!=typeof window&&window.screen?void 0!==window.screen.systemXDPI&&void 0!==window.screen.logicalXDPI&&window.screen.systemXDPI>window.screen.logicalXDPI?window.screen.systemXDPI/window.screen.logicalXDPI:window&&void 0!==window.devicePixelRatio?window.devicePixelRatio:1:1},t.browserDownloadBinText=function(e,t,n,r,i){return void 0===n&&(n="application/octet-stream"),A(btoa(e),t,n,r,i)},t.browserDownloadText=function(t,n,r,i,o){return void 0===r&&(r="application/octet-stream"),A(btoa(e.Util.toUTF8(t)),n,r,i,o)},t.isBrowserDownloadInSameWindow=b,t.browserDownloadDataUri=x,t.browserDownloadUInt8Array=function(t,n,r,i,o){return void 0===r&&(r="application/octet-stream"),A(btoa(e.Util.uint8ArrayToString(t)),n,r,i,o)},t.browserDownloadBase64=A,t.loadImageAsync=function(e){var t=document.createElement("img");return new Promise(function(n,r){t.onload=function(){return n(t)},t.onerror=function(){return n(void 0)},t.crossOrigin="anonymous",t.src=e})},t.loadScriptAsync=function(e){return new Promise(function(t,n){var r=document.createElement("script");r.type="text/javascript",r.src=e,r.addEventListener("load",function(){return t()}),r.addEventListener("error",function(e){return n(e)}),document.body.appendChild(r)})},t.loadAjaxAsync=function(e){return new Promise(function(t,n){var r=new XMLHttpRequest;r.onreadystatechange=function(){r.readyState==XMLHttpRequest.DONE&&(200==r.status?t(r.responseText):n(r.status))},r.open("GET",e,!0),r.send()})},t.initTheme=function(){function t(t){return t?t.replace("@cdnUrl@",e.getOnlineCdnUrl()):t}var n=e.appTarget.appTheme;if(n){if(n.accentColor){var r=document.createElement("style");r.type="text/css",r.innerHTML=".ui.accent { color: "+n.accentColor+"; }\n                .ui.inverted.menu .accent.active.item, .ui.inverted.accent.menu  { background-color: "+n.accentColor+"; }",document.getElementsByTagName("head")[0].appendChild(r)}n.appLogo=t(n.appLogo),n.cardLogo=t(n.cardLogo),n.homeScreenHero=t(n.homeScreenHero)}if(e.Util.isUserLanguageRtl()){e.debug("rtl layout"),document.body.classList.add("rtl"),document.body.style.direction="rtl";var i=e.Util.toArray(document.head.getElementsByTagName("link")),o=i.filter(function(t){return e.Util.endsWith(t.getAttribute("href"),"semantic.css")})[0];if(o){var a=o.getAttribute("data-rtl");a&&(e.debug("swapping to "+a),o.setAttribute("href",a))}var s=i.filter(function(t){return e.Util.endsWith(t.getAttribute("href"),"blockly.css")})[0];if(s){var c=s.getAttribute("data-rtl");c&&(e.debug("swapping to "+c),s.setAttribute("href",c))}}var l=e.appTarget.simulator;if(l&&l.boardDefinition&&l.boardDefinition.visual){var u=l.boardDefinition.visual;u.image&&(u.image=t(u.image),u.outlineImage&&(u.outlineImage=t(u.outlineImage)))}},t.changeHash=function(e,t){"#"!=e.charAt(0)&&(e="#"+e),t?window.location.hash=e:window.history.replaceState("","",e)}}(e.BrowserUtils||(e.BrowserUtils={}))}(pxt||(pxt={}));var pxt;!function(e){!function(e){e.deployCoreAsync=void 0,e.browserDownloadAsync=void 0,e.saveOnlyAsync=void 0,e.showUploadInstructionsAsync=void 0}(e.commands||(e.commands={}))}(pxt||(pxt={}));var pxt;!function(e){function t(){if(e.U.isNodeJS)return Promise.resolve(require("lzma"));var t=window.LZMA;if(t)return Promise.resolve(t);var n=window.MonacoPaths;return e.BrowserUtils.loadScriptAsync(n["lzma/lzma_worker-min.js"]).then(function(){return window.LZMA})}e.lzmaDecompressAsync=function(e){return t().then(function(t){return new Promise(function(n,r){try{t.decompress(e,function(e,t){n(t?void 0:e)})}catch(e){n(void 0)}})})},e.lzmaCompressAsync=function(e){return t().then(function(t){return new Promise(function(n,r){try{t.compress(e,7,function(e,t){n(t?void 0:new Uint8Array(e))})}catch(e){n(void 0)}})})}}(pxt||(pxt={}));var pxt;!function(e){!function(t){function n(e){void 0===e&&(e="namespace");var t="",n="",r=function(r,i){void 0===i&&(i=""),n!=r&&(n&&(t+="}\n"),r&&(t+=i||e+" "+r+" {\n"),n=r)},i="    ";return{setNs:r,clear:function(){t="",n=""},write:function(e){e.trim()?(e=e.trim().replace(/^\s*/gm,i).replace(/^(\s*)\*/gm,function(e,t){return t+" *"}),t+=e+"\n"):t+="\n"},incrIndent:function(){i+="    "},decrIndent:function(){i=i.slice(4)},finish:function(){return r(""),t}}}function r(e){if(!e)return null;e=e.trim();var t=/^\((.*)\)/.exec(e);return t&&(e=t[1]),/^-?(\d+|0[xX][0-9a-fA-F]+)$/.test(e)?parseInt(e):null}function i(e){return e?new Promise(function(t,n){var r=new FileReader;r.onerror=function(e){return t(null)},r.onload=function(e){return t(r.result)},r.readAsArrayBuffer(e)}):Promise.resolve(null)}function o(e){if(!e)return"";for(var t="",n=0;n<e.length;++n){var r=255&e[n];t+=37==r||r>127?"%"+r.toString(16):String.fromCharCode(r)}return decodeURIComponent(t)}function a(t){for(var n="",r=0;r<t.length;r+=2)n=t[r]+t[r+1]+n;return e.Util.assert(r==t.length),n}function s(e){var t=[65,20,14,47,184,47,162,187];e:for(var n=0;n<e.length;n+=16)if(e[n]==t[0]){for(var r=0;r<t.length;++r)if(e[n+r]!=t[r])continue e;var i=e[n+8]|e[n+9]<<8,a=e[n+10]|e[n+11]<<8|e[n+12]<<16|e[n+13]<<24,s=(n+=16)+i+a;if(!(s>e.length)){var c=e.slice(n,n+i),l=e.slice(n+i,s);return{meta:o(c),text:l}}}return null}function c(e){if(e){var t,n=0,r=0,i=0,s=0;if(e.split(/\r?\n/).forEach(function(e){var o=/^:10....0041140E2FB82FA2BB(....)(....)(....)(....)(..)/.exec(e);if(o)n=parseInt(a(o[1]),16),r=parseInt(a(o[2]),16),i=n+r,t=new Uint8Array(i);else if(i>0){if(!(o=/^:10....00(.*)(..)$/.exec(e)))return;for(var c=o[1];i>0&&c.length>0;)t[s++]=parseInt(c[0]+c[1],16),c=c.slice(2),i--}}),t&&0==i&&s==t.length){for(var c=new Uint8Array(n),l=new Uint8Array(r),u=0;u<n;++u)c[u]=t[u];for(u=0;u<r;++u)l[u]=t[n+u];return{meta:o(c),text:l}}}}function l(t){function n(t){return e.debug(t),Promise.reject(new Error(t))}var r;if(e.HF2.read32(t,0)==ts.pxtc.UF2.UF2_MAGIC_START0){var i=ts.pxtc.UF2.toBin(t);i&&(r=s(i.buf))}if(1179403647==e.HF2.read32(t,0)&&(r=s(t)),58==t[0]&&(r=c(o(t)||"")),!r||!r.meta||!r.text)return n("This .hex file doesn't contain source.");var a=JSON.parse(r.meta);return a?"LZMA"==a.compression?e.lzmaDecompressAsync(r.text).then(function(t){if(!t)return null;var n=t.slice(0,a.headerSize||a.metaSize||0),r=t.slice(n.length);return n&&e.Util.jsonCopyFrom(a,JSON.parse(n)),{meta:a,source:r}}):a.compression?n("Compression type "+a.compression+" not supported."):Promise.resolve({source:o(r.text)}):n("This .hex file is not valid.")}var u=pxtc.Util,f=u.lf;t.nsWriter=n,t.parseCppInt=r;var p,h,d=function(e){function t(t){e.call(this,t),this.isUserError=!0,this.message=t}return __extends(t,e),t}(Error);t.PkgConflictError=d,t.getExtensionInfo=function(t){function i(e){return e.trim().replace(/[\_\*]$/,"")}function o(e){return e.replace(/\/\/.*/,"").replace(/\/\*/,"")}function a(e){return W?(K+=e+"\n",!0):/^\s*\/\*\*/.test(e)?(X=!0,q=e+"\n",/\*\//.test(e)&&(X=!1),K+="//\n",!0):X?(q+=e+"\n",/\*\//.test(e)&&(X=!1),K+="//\n",!0):/^\s*\/\/%/.test(e)?(Y+=e+"\n",K+="//\n",!0):(K+=e+"\n",!1)}function s(e,t){W=!0,$=-1,D.write(""),D.write(""),(Y||q)&&(D.write(q),D.write(Y),Y="",q=""),D.write("declare const enum "+i(e)+" "+t),B[e]=!0}function c(e){var t=o(e);if(W&&t.indexOf("}")>=0&&(W=!1,D.write("}")),W){var n=/^\s*(\w+)\s*(=\s*(.*?))?,?\s*$/.exec(t);if(n){var a=n[1],s=n[3],c="";if(s){s=s.trim();var l=u.lookup(H,s);null!=l&&(c="  // "+s,s=l),null==($=r(s))&&N("cannot determine value of "+t)}else s=++$+"";D.write("    "+i(a)+" = "+s+","+c)}else D.write(e)}}function l(){R.setNs(""),R.write(""),R.write(""),(Y||q)&&(R.write(q),R.write(Y),Y="",q="")}function g(e,t){t=t.trim();var n=/(.*)=\s*(-?\w+)$/.exec(t),i="",o="";if(n&&(i=n[2],o="?",t=n[1].trim()),!(n=/^(.*?)(\w+)$/.exec(t)))return N("invalid argument: "+t),{name:"???",type:"int"};var a=n[2];e.paramDefl[a]&&(i=e.paramDefl[a],o="?");var s=i?u.lookup(H,i):null;return null!=s&&(i=s),i&&(null==r(i)&&N("Invalid default value (non-integer): "+i),Y+=" "+a+".defl="+i),{name:a+o,type:n[1]}}for(var m={},v="/source/",y=0,b=t.sortedDeps();y<b.length;y++)(oe=b[y]).addSnapshot(m,["dal.d.ts",".h",".cpp"]);if(h&&u.stringMapEq(m,h))return e.debug("Using cached extinfo"),p;e.debug("Generating new extinfo");var x=pxtc.emptyExtInfo(),A=e.appTarget.compileService;A||(A={gittag:"none",serviceId:"nocompile"});var w=e.appTarget.compile;w||(w={isNative:!1,hasHex:!1});var E=w.nativeType==pxtc.NATIVE_TYPE_CS,k=!!A.platformioIni,T="codal"==A.buildEngine,_="dockermake"==A.buildEngine,S=!(E||k||T||_);k?v="/src/":(T||_)&&(v="/pxtapp/");for(var U="// Configuration defines\n",O="\nPXT_SHIMS_BEGIN\n",C='#include "pxt.h"\n',P="",I="",N=function(e){return I+="   "+L+"("+F+"): "+e+"\n"},F=0,L="",M=n("namespace"),R=n("declare namespace"),D=n("declare namespace"),j="",B={},H={true:"1",false:"0",null:"0",NULL:"0"},G="",z=0,J=t.sortedDeps();z<J.length;z++)(oe=J[z]).getFiles().indexOf("dal.d.ts")>=0&&(pe=oe.host().readFile(oe,"dal.d.ts"),e.Util.assert(!!pe,"dal.d.ts not found in "+oe.id),pe.split(/\r?\n/).forEach(function(e){var t=/^\s*(\w+) = (.*),/.exec(e);t&&(H[t[1]]=t[2])})),!G&&oe.getFiles().indexOf("Makefile")>=0&&(G=oe.host().readFile(oe,"Makefile"));var $=0,W=!1,V="",q="",Y="",X=!1,K="",Z=u.clone(A.yottaConfig||{}),Q={},ee={};if(S&&w.hasHex){ge=A,u.assert(!!ge.yottaCorePackage),u.assert(!!ge.githubCorePackage),u.assert(!!ge.gittag);var te=ge.githubCorePackage+"#"+A.gittag;x.yotta.dependencies[ge.yottaCorePackage]=te}if(t)for(var ne=!1,re=0,ie=t.sortedDeps();re<ie.length;re++){var oe=ie[re];I="",function(e){var t=e.config.platformio;t&&t.dependencies&&u.jsonCopyFrom(x.platformio.dependencies,t.dependencies),x.npmDependencies&&e.config.npmDependencies&&u.jsonCopyFrom(x.npmDependencies,e.config.npmDependencies);var n=e.config.yotta;if(n){if(n.dependencies&&u.jsonCopyFrom(x.yotta.dependencies,n.dependencies),n.config)for(var r=u.jsonFlatten(n.config),i=0,o=Object.keys(r);i<o.length;i++){var a=o[i],s=u.lookup(ee,a),c=r[a];if(!s||s.config.yotta.configIsJustDefaults)ee[a]=e,Z[a]=c;else if(Z[a]===c);else if(!e.parent.config.yotta||!e.parent.config.yotta.ignoreConflicts){var l=new d(f("conflict on yotta setting {0} between packages {1} and {2}",a,e.id,s.id));throw l.pkg0=s,l.pkg1=e,l.settingName=a,l}}if(n.optionalConfig)for(var r=u.jsonFlatten(n.optionalConfig),p=0,h=Object.keys(r);p<h.length;p++)c=r[a=h[p]],Q[a]=c}}(oe),oe==t?(ne=!0,R.clear(),D.clear()):u.assert(!ne);for(var ae=E?".cs":".cpp",se=0,ce=oe.getFiles();se<ce.length;se++){var le=ce[se],ue=!E&&u.endsWith(le,".h");if(ue||u.endsWith(le,ae)){var fe=oe.config.name+"/"+le;"base"!=oe.config.name&&"core"!=oe.config.name||!ue||(fe=le),ue&&(C+='#include "'+(S?v.slice(1):"")+fe+'"\n'),null==(pe=oe.readFile(le))&&u.userError(f("C++ file {0} is missing in package {1}.",le,oe.config.name)),L=fe,E?(e.debug("Parse C#: "+fe),function(e){function t(e){switch(e.replace(/\s+/g,"")){case"void":return"void";case"int":return"int32";case"uint":return"uint32";case"float":case"double":return"number";case"ushort":return"uint16";case"short":return"int16";case"byte":return"uint8";case"sbyte":return"int8";case"bool":return"boolean";case"string":case"String":return"string";case"Function":return"() => void";case"object":return"any";default:return i(e)}}function n(e){if(e=e.replace(/\s+/g,""),u.lookup(B,e))return!0;var n=t(e);return!("number"!=n&&!/^u?int\d+$/.test(n))}function r(e){return e=e.replace(/\s+/g,""),n(e)&&(e="#"+e),e+";"}V="",q="",Y="",X=!1,e=e.replace(/^\s*#\s*if\s+false\s*$[^]*?^\s*#\s*endif\s*$/gm,function(e){return e.replace(/[^\n]/g,"")}),F=0,K="",W=!1,$=0,D.setNs(""),R.setNs(""),e.split(/\r?\n/).forEach(function(e){++F;var n=o(e);c(e);var u=/^\s*(public) enum\s+(\w+)\s*({|$)/.exec(n);if(u&&s(u[2],u[3]),!a(e)){var f=/^\s*public (static\s+|partial\s+)*class\s+(\w+)/.exec(e);if(f)return V=f[2],void((Y||q)&&(l(),R.setNs(i(V)),D.setNs(i(V))));if(f=/^\s*public static (async\s+)*([\w\[\]<>]+)\s+(\w+)\(([^\(\)]*)\)\s*(;\s*$|\{|$)/.exec(e),Y&&f){var p=pxtc.parseCommentString(Y);V||N("missing namespace declaration");var h=f[2],d=f[3],m=f[4],v=!1;if(Y=Y.trim().replace(/ \w+\.defl=\w+/g,""),"Task"==h)h="void",v=!0;else{var y=/^Task<(.*)>$/.exec(h);y&&(v=!0,h=y[1])}var b=r(h);v&&(b="async;"+b,Y+=" async");for(var A=[],w=0,E=m.split(/,/);w<E.length;w++){var k=E[w];if(k){var T=g(p,k),_=r(T.type);b+=_,"CTX;"!=_&&A.push(T.name+": "+t(T.type))}}var S={name:V+"::"+d,argsFmt:b,value:null};return q&&(R.setNs(i(V)),R.write(""),R.write(q),Y+=" shim="+S.name,R.write(Y),d=i(d),R.write("function "+d+"("+A.join(", ")+"): "+t(h)+";")),q="",Y="",void x.functions.push(S)}return Y&&e.trim()?(N("declaration not understood: "+e),Y="",void(q="")):void 0}})}(pe),P+='\n\n\n#line 1 "'+fe+'"\n'+pe):(e.debug("Parse C++: "+fe),pe=function(e,t){function n(){var e=V.replace(/Methods$/,"");return e==V?null:e}function r(e){switch(e.replace(/\s+/g,"")){case"void":return"void";case"int32_t":case"int":return"int32";case"uint32_t":case"unsigned":return"uint32";case"TNumber":case"float":case"double":return"number";case"uint16_t":return"uint16";case"int16_t":case"short":return"int16";case"uint8_t":case"byte":return"uint8";case"int8_t":case"sbyte":return"int8";case"bool":return w.shortPointers&&N("use 'boolean' not 'bool' on 8 bit targets"),"boolean";case"StringData*":case"String":case"ImageLiteral":return"string";case"Action":return"() => void";case"TValue":return"any";default:return i(e)}}function p(e){switch(e=e.replace(/\s+/g,"")){case"int32_t":case"uint32_t":case"unsigned":case"uint16_t":case"int16_t":case"short":case"uint8_t":case"byte":case"int8_t":case"sbyte":case"int":return"I";case"void":return"V";case"float":return"F";case"TNumber":return"N";case"TValue":return"T";case"bool":return"B";case"double":return"D";default:return u.lookup(B,e)?"I":"_"}}V="",q="",Y="",X=!1;var h,d=-1;return e=e.replace(/^\s*#\s*if\s+0\s*$[^]*?^\s*#\s*endif\s*$/gm,function(e){return e.replace(/[^\n]/g,"")}),F=0,K="",W=!1,$=0,D.setNs(""),R.setNs(""),e.split(/\r?\n/).forEach(function(e){++F;var u=o(e);c(e);var m=/^\s*enum\s+(|class\s+|struct\s+)(\w+)\s*({|$)/.exec(u);if(m&&(s(m[2],m[3]),t||(M.setNs(V),M.write("enum "+m[2]+" : int;"))),!a(e)){/^typedef.*;\s*$/.test(e)&&(M.setNs(V),M.write(e));var v=/^\s*namespace\s+(\w+)/.exec(e);if(!v){if(v=/^\s*(\w+)([\*\&]*\s+[\*\&]*)(\w+)\s*\(([^\(\)]*)\)\s*(;\s*$|\{|$)/.exec(e),Y&&v){h=null;var y=pxtc.parseCommentString(Y);V||N("missing namespace declaration");var b=(v[1]+v[2]).replace(/\s+/g,""),A=v[3],w=v[4];Y=Y.trim().replace(/ \w+\.defl=\w+/g,"");var E=p(b),k=w.split(/,/).filter(function(e){return!!e}).map(function(e){var t=g(y,e);return E+=p(t.type),t.name+": "+r(t.type)}),T=(k.length,{name:V+"::"+A,argsFmt:E,value:null});if(q)if(R.setNs(i(V)),R.write(""),R.write(q),/ImageLiteral/.test(v[4])&&!/imageLiteral=/.test(Y)&&(Y+=" imageLiteral=1"),Y+=" shim="+T.name,R.write(Y),A=i(A),n()){var _=(k[0]||"").replace(/^.*:\s*/,"").trim();_.toLowerCase()!=n().toLowerCase()&&N(f("Invalid first argument; should be of type '{0}', but is '{1}'",n(),_)),k.shift(),0==k.length&&/\bproperty\b/.test(Y)?R.write(A+": "+r(b)+";"):R.write(A+"("+k.join(", ")+"): "+r(b)+";")}else R.write("function "+A+"("+k.join(", ")+"): "+r(b)+";");return q="",Y="",t||(M.setNs(V),M.write(b+" "+A+"("+w+");")),x.functions.push(T),void(O+=S?"(uint32_t)(void*)::"+T.name+",\n":"PXT_FNPTR(::"+T.name+"),\n")}if(v=/^\s*(\w+)\s+(\w+)\s*;/.exec(e),Y&&v){var U=pxtc.parseCommentString(Y);U.indexedInstanceNS&&(h=U,R.setNs(U.indexedInstanceNS),d=0);var C=v[1],P=v[2];if(h)return Y=Y.trim(),Y+=" fixedInstance shim="+h.indexedInstanceShim+"("+d+++")",R.write(""),R.write(q),R.write(Y),R.write("const "+P+": "+r(C)+";"),q="",void(Y="")}return Y&&e.trim()?(N("declaration not understood: "+e),Y="",void(q="")):void 0}if(V=v[1],n()){l();var I=n();R.setNs(V,"declare interface "+I+" {")}else(Y||q)&&(l(),R.setNs(i(V)),D.setNs(i(V)))}}),K}(pe,ue),x.extensionFiles[v+fe]=pe),0==oe.level&&(x.onlyPublic=!1),oe.verProtocol()&&"pub"!=oe.verProtocol()&&"embed"!=oe.verProtocol()&&(x.onlyPublic=!1)}if(!E&&(u.endsWith(le,".c")||u.endsWith(le,".S")||u.endsWith(le,".s"))){var pe=oe.readFile(le);x.extensionFiles[v+oe.config.name+"/"+le.replace(/\.S$/,".s")]=pe}}I&&(j+=f("Package {0}:\n",oe.id)+I)}j&&u.userError(j),P+="\n#line default\n",u.jsonCopyFrom(Q,Z);var he=u.jsonUnFlatten(Q);if(E)x.extensionFiles["/lib.cs"]=P,x.generatedFiles["/module.json"]="{}";else if(_){var de={name:"pxt-app",private:!0,dependencies:x.npmDependencies};x.generatedFiles["/package.json"]=JSON.stringify(de,null,4)+"\n"}else if(T){var ge=A,me=u.clone(ge.codalDefinitions)||{},ve=ge.codalTarget;"string"==typeof ve&&(ve+=".json");var ye={target:ve,definitions:me,config:me,application:"pxtapp",output_folder:"build",pxt_gitrepo:ge.githubCorePackage,pxt_gittag:ge.gittag};u.iterMap(u.jsonFlatten(he),function(e,t){e=e.replace(/^codal\./,"device.").toUpperCase().replace(/\./g,"_"),me[e]=t}),x.generatedFiles["/codal.json"]=JSON.stringify(ye,null,4)+"\n"}else if(k){var be=A.platformioIni.slice();be.push("lib_deps ="),u.iterMap(x.platformio.dependencies,function(e,t){var n=/[@#\/]/.test(t)?t:e+"@"+t;be.push("  "+n)}),x.generatedFiles["/platformio.ini"]=be.join("\n")+"\n"}else{x.yotta.config=he;var xe="pxt-app";A.yottaBinary&&(xe=A.yottaBinary.replace(/-combined/,"").replace(/\.hex$/,""));var Ae={name:xe,version:"0.0.0",description:"Auto-generated. Do not edit.",license:"n/a",dependencies:x.yotta.dependencies,targetDependencies:{},bin:"./source"};x.generatedFiles["/module.json"]=JSON.stringify(Ae,null,4)+"\n"}if(w.boxDebug&&(U+="#define PXT_BOX_DEBUG 1\n",U+="#define PXT_MEMLEAK_DEBUG 1\n"),w.nativeType==pxtc.NATIVE_TYPE_AVRVM?U+="#define PXT_VM 1\n":U+="#define PXT_VM 0\n",E||(x.generatedFiles[v+"pointers.cpp"]=C+M.finish()+O+"\nPXT_SHIMS_END\n",x.generatedFiles[v+"pxtconfig.h"]=U,S&&(x.generatedFiles["/config.json"]=JSON.stringify(he,null,4)+"\n"),x.generatedFiles[v+"main.cpp"]='\n#include "pxt.h"\n#ifdef PXT_MAIN\nPXT_MAIN\n#else\nint main() {\n    uBit.init();\n    pxt::start();\n    while (1) uBit.sleep(10000);\n    return 0;\n}\n#endif\n'),G){var we=Object.keys(x.extensionFiles).concat(Object.keys(x.generatedFiles)),Ee="",ke=function(e,t){var n=we.filter(function(e){return u.endsWith(e,t)}).map(function(e){return e.slice(1)});Ee+=e+" = "+n.join(" ")+"\n"};ke("PXT_C",".c"),ke("PXT_CPP",".cpp"),ke("PXT_S",".s"),ke("PXT_HEADERS",".h"),Ee+="PXT_SOURCES = $(PXT_C) $(PXT_S) $(PXT_CPP)\n",Ee+="PXT_OBJS = $(addprefix bld/, $(PXT_C:.c=.o) $(PXT_S:.s=.o) $(PXT_CPP:.cpp=.o))\n",x.generatedFiles["/Makefile"]=G,x.generatedFiles["/Makefile.inc"]=Ee}var Te=x.extensionFiles;u.jsonCopyFrom(Te,x.generatedFiles);var _e={config:A.serviceId,tag:A.gittag,replaceFiles:Te,dependencies:S?x.yotta.dependencies:null},Se=JSON.stringify(_e);return x.sha=u.sha256(Se),x.compileData=btoa(u.toUTF8(Se)),x.shimsDTS=R.finish(),x.enumsDTS=D.finish(),h=m,p=x,x},t.unpackSourceFromHexFileAsync=function(e){if(e)return i(e).then(function(e){return l(new Uint8Array(e))})},t.unpackSourceFromHexAsync=l}(e.cpp||(e.cpp={}))}(pxt||(pxt={}));var pxt;!function(e){!function(t){function n(e){var t=Promise.resolve();return p.hasOwnProperty(e.sha)||(t=i(e).then(function(t){p[e.sha]=t})),t.then(function(){return p[e.sha]})}function r(){if(f)return f;var t=e.getOnlineCdnUrl();return f=t?Promise.resolve(t):e.Cloud.privateGetAsync("clientconfig").then(function(e){return e.primaryCdnUrl})}function i(t){var n="";return o(t).then(function(i){return i||r().then(function(r){return n=r+"/compile/"+t.sha,e.U.httpGetTextAsync(n+".hex")}).then(function(e){return e},function(r){return e.Cloud.privatePostAsync("compile/extension",{data:t.compileData}).then(function(t){return new Promise(function(r,i){var o=function(){var i=t.hex.replace(/\.hex/,".json");return e.log("polling at "+i),e.Util.httpGetJsonAsync(i).then(function(t){t.success?(e.log("fetching "+n+".hex"),r(e.U.httpGetTextAsync(n+".hex"))):e.U.userError(JSON.stringify(t,null,1))},function(e){return setTimeout(o,1e3),null})};o()})})}).then(function(e){return{enums:[],functions:[],hex:e.split(/\r?\n/)}})})}function o(t){return e.Cloud.localToken&&window&&e.Cloud.isLocalHost()?a("compile/"+t.sha).then(function(e){return e&&!e.notInOfflineCache&&e.hex?(e.hex=e.hex.split(/\r?\n/),e):Promise.resolve()}).catch(function(e){return Promise.resolve()}):Promise.resolve()}function a(t,n){return e.U.requestAsync({url:"/api/"+t,headers:{Authorization:e.Cloud.localToken},method:n?"POST":"GET",data:n||void 0,allowHttpErrors:!0}).then(function(e){return e.json})}function s(e,t,n,r,i){return void 0===i&&(i=10),e.cacheStoreAsync(n,r).then(function(){return e.cacheGetAsync(t)}).then(function(r){var o;try{o=JSON.parse(r||"[]")}catch(e){console.error("invalid cache entry, clearing entry"),o=[]}(o=o.filter(function(e){return e!=n})).unshift(n);var a=o.slice(i);return o=o.slice(0,i),Promise.map(a,function(t){return e.cacheStoreAsync(t,null)}).then(function(){return e.cacheStoreAsync(t,JSON.stringify(o))})})}function c(e,t,n){return e.cacheGetAsync(t).then(function(r){var i;try{i=JSON.parse(r||"[]")}catch(n){return console.error("invalid cache entry, clearing entry"),e.cacheStoreAsync(t,"[]")}return i[0]!=n?((i=i.filter(function(e){return e!=n})).unshift(n),e.cacheStoreAsync(t,JSON.stringify(i))):null})}function l(t){for(var n=[],r=0;r<t.length;r++){var i=/^([@!])(....)$/.exec(t[r]);if(i){var o=parseInt(i[2],16),a=t[++r],s="";if("@"==i[1]){s="";for(var c=parseInt(a,16);c-- >0;)s+="\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"}else s=pxtc.decodeBase64(a);e.Util.assert(s.length>0),e.Util.assert(s.length%16==0);for(var l=0;l<s.length;){var u=[16,o>>8&255,255&o,0];o+=16;for(p=0;p<16;++p)u.push(s.charCodeAt(l++));for(var f=0,p=0;p<u.length;++p)f+=u[p];u.push(255&-f);for(var h=":",p=0;p<u.length;++p){var d=255&u[p];d<=15&&(h+="0"),h+=d.toString(16)}n.push(h.toUpperCase())}}else n.push(t[r])}return n}function u(e){for(var t=[],n=0,r=0;r<e.length;r+=n){var i=-1,o="";n=0;for(var a=!1;n<500;){var s=/^:10(....)00(.{32})(..)$/.exec(e[r+n]);if(!s)break;var c=s[2],l=/^0+$/.test(c),u=parseInt(s[1],16);if(-1==i)a=l,t.push((a?"@":"!")+s[1]),i=u-16;else{if(l!=a)break;if(i+16!=u)break}a||(o+=c),i=u,n++}if(0==n)t.push(e[r]),n=1;else if(a)t.push(n.toString(16));else{for(var f="",p=0;p<o.length;p+=2)f+=String.fromCharCode(parseInt(o.slice(p,p+2),16));t.push(btoa(f))}}return t}var f,p={};t.storeWithLimitAsync=s,t.recordGetAsync=c,t.getHexInfoAsync=function(t,r,i){if(!r.sha)return Promise.resolve(null);if(pxtc.hex.isSetupFor(r))return Promise.resolve(pxtc.hex.currentHexInfo);e.debug("get hex info: "+r.sha);var o="hex-"+r.sha;return t.cacheGetAsync(o).then(function(i){var a;try{a=i?JSON.parse(i):null}catch(e){console.log("invalid cache entry, clearing entry"),a=null}return a&&a.hex?(e.debug("cache hit, size="+i.length),a.hex=l(a.hex),c(t,"hex-keys",o).then(function(){return a})):n(r).then(function(e){var n=e.hex;e.hex=u(e.hex);var r=JSON.stringify(e);return e.hex=n,s(t,"hex-keys",o,r).then(function(){return e})}).catch(function(t){return e.reportException(t,{sha:r.sha}),Promise.resolve(null)})})}}(e.hex||(e.hex={}))}(pxt||(pxt={}));var pxt;!function(e){!function(t){function n(t,n,r,i,o){e.Util.assert(!!n&&!!r&&!!i);var a="https://api.crowdin.com/api/project/"+n+"/",s="?key="+r;return t&&(o||(o={}),o.branch=t),o&&(s+="&"+Object.keys(o).map(function(e){return e+"="+encodeURIComponent(o[e])}).join("&")),a+i+s}function r(e){var t=0;return function(){if(t++>10)throw new Error("Too many API calls for "+e)}}function i(t,a,s,c,l){return c=o(c),e.debug("create directory "+(t||"")+"/"+c),l||(l=r(c)),e.Util.multipartPostAsync(n(t,a,s,"add-directory"),{json:"true",name:c}).then(function(n){if(e.debug("crowdin resp: "+n.statusCode),200==n.statusCode||400==n.statusCode)return Promise.resolve();if(500==n.statusCode&&n.text&&50===JSON.parse(n.text).error.code)return e.log("directory already exists"),Promise.resolve();var r=n.json||JSON.parse(n.text)||{error:{}};if(404==n.statusCode&&17==r.error.code){e.log("parent directory missing for "+c);var o=c.replace(/\/[^\/]+$/,"");if(o!=c)return i(t,a,s,o,l).then(function(){return i(t,a,s,c,l)})}throw new Error("cannot create directory "+(t||"")+"/"+c+": "+n.statusCode+" "+JSON.stringify(r))})}function o(e){return e.replace(/\\/g,"/")}function a(e,t,n){var r=t.name,i=n?n+"/"+r:r;switch(t.fullName=i,t.node_type){case"file":e.push(t);break;case"directory":(t.files||[]).forEach(function(t){return a(e,t,i)});break;case"branch":(t.files||[]).forEach(function(t){return a(e,t,n)})}}function s(t,n,r){var i=[];if(n&&(t=t.filter(function(e){return"branch"==e.node_type&&e.name==n})),t.forEach(function(e){return a(i,e,"")}),r&&(i=i.filter(function(e){return 0==e.fullName.indexOf(r)})),"core"!=e.appTarget.id){var o=e.appTarget.id+"/";i=i.filter(function(e){return e.fullName.indexOf("/")<0||e.fullName.substr(0,o.length)==o||e.fullName.indexOf("common-docs")>=0})}return i}t.KEY_VARIABLE="CROWDIN_KEY",t.downloadTranslationsAsync=function(t,r,i,a,s){void 0===s&&(s={});var c=n(t,r,i,"info",{json:"true"}),l={};return a=o(a),e.Util.httpGetTextAsync(c).then(function(o){var c=JSON.parse(o);if(!c)throw new Error("info failed");var u=c.languages;e.log("languages: "+u.map(function(e){return e.code}).join(", "));var f=function(){var o=u.pop();if(!o)return Promise.resolve();var c=n(t,r,i,"export-file",{file:a,language:o.code,export_translated_only:s.translatedOnly?"1":"0",export_approved_only:s.validatedOnly?"1":"0"});return e.log("downloading "+o.name+" - "+o.code+" ("+u.length+" more)"),e.Util.httpGetTextAsync(c).then(function(t){try{var n=JSON.parse(t);n&&(l[o.code]=n)}catch(t){e.log(c+" "+t)}return f()}).delay(1e3)};return f()}).then(function(){return l})},t.createDirectoryAsync=i,t.uploadTranslationAsync=function(t,a,s,c,l){function u(){return f("update-file",{update_option:"update_as_unapproved"})}function f(r,i){return i.type="auto",i.json="",i.escape_quotes="0",h(),e.Util.multipartPostAsync(n(t,a,s,r),i,c,l).then(function(e){return p(e)})}function p(n){var r=n.statusCode,o=JSON.parse(n.text);if(e.debug("upload result: "+r),404==r&&8==o.error.code)return e.log("create new translation file: "+c),f("add-file",{});if(404==r&&17==o.error.code)return i(t,a,s,c.replace(/\/[^\/]+$/,""),h).then(function(){return u()});if(200==r)return Promise.resolve();throw new Error("Error, upload translation: "+c+", "+n+", "+JSON.stringify(o))}e.Util.assert(!!a),e.Util.assert(!!s);var h=r(c=o(c));return u()},t.listFilesAsync=function(t,r,i,o){var a=n(t,r,i,"info",{json:"true"});return e.log("crowdin: listing files under "+o+" in branch "+(t||"master")),e.debug("uri: "+a),e.Util.httpGetTextAsync(a).then(function(n){var r=JSON.parse(n);if(!r)throw new Error("info failed");var i=s(r.files,t,o);return e.debug("crowdin: found "+i.length+" under "+o),i.map(function(e){return{fullName:e.fullName}})})},t.languageStatsAsync=function(t,r,i,o){var a=n(t,r,i,"language-status",{language:o,json:"true"});return e.Util.httpGetJsonAsync(a).then(function(e){return s(e.files,t)})}}(e.crowdin||(e.crowdin={}))}(pxt||(pxt={}));var pxt;!function(e){!function(t){function n(e,t,n){return e.split(t).join(n)}function r(e){return e=n(e,"&","&amp;"),e=n(e,"<","&lt;"),e=n(e,">","&gt;"),e=n(e,'"',"&quot;"),e=n(e,"'","&#39;")}function i(e){return e?r(e.replace(/\&([#a-z0-9A-Z]+);/g,function(e,t){switch(t){case"amp":return"&";case"lt":return"<";case"gt":return">";case"quot":return'"';default:return"#"==t[0]?String.fromCharCode(parseInt(t.slice(1))):e}})):e}function o(e){for(var t={};e.trim();){var n=/\s*([^=\s]+)=("([^"]*)"|'([^']*)'|(\S*))/.exec(e);if(n){var r=n[3]||n[4]||n[5]||"";t[n[1].toLowerCase()]=r}else t[(n=/^\s*(\S+)/.exec(e))[1]]="true";e=e.slice(n[0].length)}return t}function a(e){var t=d.clone(m),n=d.clone(v),r=d.clone(y),a={},c={},l=e.params,u=e.theme;e.boxes=t,e.macros=n,e.settings=r,e.html=e.html.replace(/<aside\s+([^<>]+)>([^]*?)<\/aside>/g,function(e,i,s){var l=o(i),u=l["data-name"]||l.id;return u?(/box/.test(l.class)?t[u]=s:/aside/.test(l.class)?t[u]="\x3c!-- BEGIN-ASIDE "+u+" --\x3e"+s+"\x3c!-- END-ASIDE --\x3e":/setting/.test(l.class)?r[u]=s:/menu/.test(l.class)?a[u]=s:/toc/.test(l.class)?c[u]=s:n[u]=s,"\x3c!-- macro "+u+" --\x3e"):x("id or data-name missing on macro")});var f=function(e,t){var n=a.item,r={NAME:e.name};if(e.subitems)n=0==t?a["top-dropdown"]:a["inner-dropdown"],r.ITEMS=e.subitems.map(function(e){return f(e,t+1)}).join("\n");else{if(/^-+$/.test(e.name)&&(n=a.divider),e.path&&!/^(https?:|\/)/.test(e.path))return x("Invalid link: "+e.path);r.LINK=e.path}return s(n,r,["ITEMS"])},p=[{name:g("Docs"),href:"/docs"}],h=[],b=function(t){for(var n=0,r=t.subitems||[];n<r.length;n++)if(b(r[n]))return h.push(t),!0;return!(!e.filepath||0!=e.filepath.indexOf(t.path))&&(h.push(t),!0)};(u.TOC||[]).forEach(b);var A,w=function(e,t){var n=c.item,r={NAME:e.name};return e.path&&!/^(https?:|\/)/.test(e.path)?x("Invalid link: "+e.path):(r.LINK=e.path,h.indexOf(e)>=0?(r.ACTIVE="active",r.EXPANDED="true",A=e,p.push({name:e.name,href:e.path})):r.EXPANDED="false",e.subitems&&e.subitems.length>0?(n=0==t?""!==e.name?c["top-dropdown"]:c["top-dropdown-noHeading"]:1==t?c["inner-dropdown"]:c["nested-dropdown"],r.ITEMS=e.subitems.map(function(e){return w(e,t+1)}).join("\n")):/^-+$/.test(e.name)&&(n=c.divider),s(n,r,["ITEMS"]))};l.menu=(u.docMenu||[]).map(function(e){return f(e,0)}).join("\n"),l.TOC=(u.TOC||[]).map(function(e){return w(e,0)}).join("\n"),u.appStoreID&&(l.appstoremeta='<meta name="apple-itunes-app" content="app-id='+d.htmlEscape(u.appStoreID)+'"/>');var E="";p.length>1&&(E='\n            <nav class="ui breadcrumb" aria-label="'+g("Breadcrumb")+'">\n                '+p.map(function(e,t){return'<a class="'+(t==p.length-1?"active":"")+' section"\n                        href="'+i(e.href)+'" aria-current="'+(t==p.length-1?"page":"")+'">'+i(e.name)+"</a>"}).join('<i class="right chevron icon divider"></i>')+"\n            </nav>"),l.breadcrumb=E,A&&(A.prevPath&&(l.prev='<a href="'+A.prevPath+'" class="navigation navigation-prev " title="'+A.prevName+'">\n                                    <i class="icon angle left"></i>\n                                </a>'),A.nextPath&&(l.next='<a href="'+A.nextPath+'" class="navigation navigation-next " title="'+A.nextName+'">\n                                    <i class="icon angle right"></i>\n                                </a>')),u.boardName&&(l.boardname=i(u.boardName)),u.driveDisplayName&&(l.drivename=i(u.driveDisplayName)),u.homeUrl&&(l.homeurl=i(u.homeUrl)),l.targetid=u.id||"???",l.targetname=u.name||"Microsoft MakeCode",l.targetlogo=u.docsLogo?'<img aria-hidden="true" role="presentation" class="ui mini image" src="'+d.toDataUri(u.docsLogo)+'" />':"";var k=e.ghEditURLs||[];if(k.length){for(var T='<p style="margin-top:1em">\n',_=g("Edit this page on GitHub"),S=0,U=k;S<U.length;S++)T+='<a href="'+U[S]+'"><i class="write icon"></i>'+_+"</a><br>\n",_=g("Edit template of this page on GitHub");T+="</p>\n",l.github=T}else l.github="";var O='\n            <a href="#maincontent" class="ui item link" tabindex="0" role="menuitem">'+g("Skip to main content")+"</a>\n        ";l.accMenu=O;var C='\n            <button id="printbtn" class="circular ui icon right floated button hideprint" title="'+g("Print this page")+'">\n                <i class="icon print"></i>\n            </button>\n        ';l.printBtn=C;var P='\n            <a id="togglesidebar" class="launch icon item" tabindex="0" title="Side menu" aria-label="'+g("Side menu")+'" role="menu" aria-expanded="false">\n                <i class="content icon"></i>\n            </a>\n        ';l.sidebarToggle=P;var I=["tocsearch1","tocsearch2"].map(function(e){return'\n                <input type="search" name="q" placeholder="'+g("Search...")+'" aria-label="'+g("Search Documentation")+'">\n                <i onclick="document.getElementById(\''+e+'\').submit();" tabindex="0" class="search link icon" aria-label="'+g("Search")+'" role="button"></i>\n            '});l.searchBar1=I[0],l.searchBar2=I[1];var N="";u.accentColor&&(N+="\n.ui.accent { color: "+u.accentColor+"; }\n.ui.inverted.accent { background: "+u.accentColor+"; }\n"),l.targetstyle=N;for(var F=0,L=Object.keys(u);F<L.length;F++){var M=L[F],R=u[M];void 0===l[M]&&"string"==typeof R&&(l[M]=R)}e.finish=function(){return s(e.html,l,["body","menu","accMenu","TOC","prev","next","printBtn","breadcrumb","targetlogo","github","JSON","appstoremeta","sidebarToggle","searchBar1","searchBar2"])}}function s(e,t,n){return void 0===n&&(n=[]),e?e.replace(/@(\w+)@/g,function(e,r){var o=d.lookup(t,r)||"";return o+="",n.indexOf(r)<0&&(o=i(o)),o}):""}function c(e,t){function n(e){var n=/^(\s*)([^]*?)(\s*)$/.exec(e),r=n[2].replace(/\s+/g," ");if(""==r||/^((IE=edge,.*|width=device-width.*|(https?:\/\/|\/)[\w@\/\.]+|@[\-\w]+@|\{[^\{\}]+\}|[^a-zA-Z]*|(&nbsp;)+)\s*)+$/.test(r))return null;var o=d.lookup(t,r);return o?r=o:i[r]="",n[1]+r+n[3]}function r(e){return e.replace(/&llt;/g,"<").replace(/&ggt;/g,">")}var i={};return e=e.replace(/<([\/\w]+)([^<>]*)>/g,function(e,t,n){var r=t.replace(/^\//,"").toLowerCase();return 1===A[r]?"&llt;"+t+n+"&ggt;":e}),e="<start>"+e,e=e.replace(/(<([\/\w]+)([^<>]*)>)([^<>]+)/g,function(e,t,i,o,a){if("script"==i||"style"==i)return r(e);var s=n(r(a));return null==s?r(e):t+s}),e=e.replace(/(<[^<>]*)(content|placeholder|alt|title)="([^"]+)"/g,function(e,t,r,i){return null==n(i)?e:t+r+'="'+i.replace(/"/g,"''")+'"'}),e=e.replace(/^<start>/g,""),{text:e,missing:i}}function l(e,t){if(e.id==t)return e;for(var n=0,r=e.children;n<r.length;n++){var i=l(r[n],t);if(i)return i}return null}function u(e,t){for(var n=0,r=[{level:0,id:"",title:"",start:n,text:"",children:[]}],i={},o=0,a=(e=e.replace(/\r/g,"")).split(/\n/);o<a.length;o++)!function(e){var o=/^\s*(#+)\s*(.*?)(#(\S+)\s*)?$/.exec(e),a=null;if(t&&o)if(o[4])if(i[o[4]])o=null;else{var s=function(e){e.id&&(i[e.id]=!0),e.children.forEach(s)};(a=l(t,o[4]))&&s(a)}else o=null;if(o){var c={level:t?1:o[1].length,title:o[2].trim(),id:o[4]||"",start:n,text:"",children:[]};if(a){e="";for(var u=0;u<a.level;++u)e+="#";e+=" ",e+=c.title||a.title,e+=" #"+c.id}for(;r[r.length-1].level>=c.level;)r.pop();r[r.length-1].children.push(c),r.push(c)}r[r.length-1].text+=e+"\n",n++}(a[o]);return r[0]}function f(e,t){if(w||p(),!t)return e;for(var n=u(e,null),r=u(t,n),i={},o={},a=0,s=r.children;a<s.length;a++){var c=s[a];d.assert(0==c.children.length),d.assert(!!c.id),i[c.id]=c.text}var l=function(e){e.id&&void 0!==i[e.id]&&(o[e.id]=!0,e.text=i[e.id],e.children=[]),e.children.forEach(l)};l(n);var f="",h=function(e){f+=e.text,e.children.forEach(h)};h(n);var g="",m=r.text.replace(/^\s*#+\s*@extends.*/gm,"").replace(/^\s*\n/gm,"");m.trim()&&(g+=m.trim()+"\n");for(var v=0,y=r.children;v<y.length;v++){var b=y[v];o[b.id]||(g+=b.text)}return g&&(f+="## Couldn't apply replacement logic to:\n"+g),f}function p(){function e(e,t,n){var r=f(e,t).trim();if(n=n.trim(),r!=n)throw console.log("*** Template:\n"+e+"\n*** Input:\n"+t+"\n*** Expected:\n"+n+"\n*** Output:\n"+r),new Error("augment docs test fail")}w=!0;var t="\n# T0\n## Examples #ex\n### Example 1\nTEx1\n### Example 2 #ex2\nTEx2\n### Example 3\nTEx3\n\n## See also #also\nTAlso\n";e(t,"",t),e(t," ",t),e(t,"\n# @extends\n# #ex2\nMy example\n## See Also These! #also\nMy links\n","\n# T0\n## Examples #ex\n### Example 1\nTEx1\n### Example 2 #ex2\nMy example\n### Example 3\nTEx3\n\n## See Also These! #also\nMy links\n"),e(t,"\n# @extends\n### #ex\nFoo\n#### Example 1\nEx1\n#### Example 2x #ex2\nEx2\n## See Also These! #also\nMy links\n","\n# T0\n## Examples #ex\nFoo\n#### Example 1\nEx1\n#### Example 2x #ex2\nEx2\n## See Also These! #also\nMy links\n")}var h,d=pxtc.Util,g=d.lf,m={},v={},y={parent:"\x3c!-- @CMD@ @ARGS@ --\x3e",short:"\x3c!-- @CMD@ @ARGS@ --\x3e",description:"\x3c!-- desc --\x3e"};t.htmlQuote=r,t.html2Quote=i;var b=[{rx:/^vimeo\.com\/(\d+)/i,cmd:"### @vimeo $1"},{rx:/^(www\.youtube\.com\/watch\?v=|youtu\.be\/)([\w\-]+(\#t=([0-9]+m[0-9]+s|[0-9]+m|[0-9]+s))?)/i,cmd:"### @youtube $2"}];t.requireMarked=function(){if(void 0!==h)return h;if("undefined"!=typeof require)return require("marked")};var x=function(e){return"<div class='ui negative message'>"+r(e)+"</div>"};t.prepTemplate=a,t.renderMarkdown=function(e){var n=!0;e.pubinfo||(n=!1,e.pubinfo={});var r=e.pubinfo;if(e.theme||(e.theme={}),delete e.pubinfo.private,r.time){var o=parseInt(r.time);r.timems||(r.timems=1e3*o+""),r.humantime||(r.humantime=d.isoTime(o))}r.name&&(r.dirname=r.name.replace(/[^A-Za-z0-9_]/g,"-"),r.title=r.name),n&&(r.JSON=JSON.stringify(r,null,4).replace(/</g,"\\u003c"));var l=e.template;l=(l=l.replace(/<!--\s*@include\s+(\S+)\s*-->/g,function(t,n){return"\x3c!-- include "+n+" --\x3e\n"+((e.theme.htmlDocIncludes||{})[n]||"")+"\n\x3c!-- end include --\x3e\n"})).replace(/<!--\s*@(ifn?def)\s+(\w+)\s*-->([^]*?)<!--\s*@endif\s*-->/g,function(e,t,n,i){return"ifdef"==t&&r[n]||"ifndef"==t&&!r[n]?"\x3c!-- "+t+" "+n+" --\x3e"+i+"\x3c!-- endif --\x3e":"\x3c!-- "+t+" "+n+" endif --\x3e"}),e.locale&&(l=c(l,e.locale).text);var u={html:l,theme:e.theme,filepath:e.filepath,ghEditURLs:e.ghEditURLs,params:r};if(a(u),!h){var f=new((h=t.requireMarked()).Renderer);f.image=function(e,t,n){var r='<img class="ui centered image" src="'+e+'" alt="'+n+'"';return t&&(r+=' title="'+t+'"'),r+=this.options.xhtml?"/>":">"},f.listitem=function(e){var t=/^\s*\[( |x)\]/i.exec(e);return t?'<li class="'+(" "==t[1]?"unchecked":"checked")+'">'+e.slice(t[0].length)+"</li>\n":"<li>"+e+"</li>\n"},f.heading=function(e,t,n){var r=/(.*)#([\w\-]+)\s*$/.exec(e),i="";return r?(e=r[1],i=r[2]):i=n.toLowerCase().replace(/[^\w]+/g,"-"),"<h"+t+' id="'+this.options.headerPrefix+i+'">'+e+"</h"+t+">"},h.setOptions({renderer:f,gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!0,smartLists:!0,smartypants:!0})}var p=e.markdown;e.repo&&(p+="\n```package\n"+e.repo.name.replace(/^pxt-/,"")+"=github:"+e.repo.fullName+"#"+(e.repo.tag||"master")+"\n```\n"),p=(p=p.replace(/^\s*https?:\/\/(\S+)\s*$/gm,function(e,t){for(var n=0,r=b;n<r.length;n++){var i=function(e){var n=e.rx.exec(t);if(n)return{value:e.cmd.replace(/\$(\d+)/g,function(e,t){return n[parseInt(t)]||""})+"\n"}}(r[n]);if("object"==typeof i)return i.value}return e})).replace(/@([a-z]+)@/gi,function(e,t){return r[t]||"unknown macro"});var g=h(p),m="";if(g=(g=g.replace(/&lt;br\s*\/&gt;/gi,"<br/>")).replace(/<h\d[^>]+>\s*([~@])\s*(.*?)<\/h\d>/g,function(e,t,n){var o=/^(\w+)\s+(.*)/.exec(n),a=o?o[1]:n,c=o?o[2]:"";if(c=i(c),a=i(a),"@"==t){var l=d.lookup(u.settings,a);if(null!=l)r[a]=c;else if(null==(l=d.lookup(u.macros,a)))return x("Unknown command: @"+a);return s(l,{ARGS:c,CMD:a},["ARGS","CMD"])}if(!a){var f=m;return m="",f}var p=d.lookup(u.boxes,a);if(p){var h=p.split("@BODY@");return m=h[1],h[0].replace("@ARGS@",c)}return x("Unknown box: ~"+a)}),!r.title){var v=/<h1[^<>]*>([^<>]+)<\/h1>/.exec(g);v&&(r.title=i(v[1]))}if(!r.description){var y=/<p>([^]+?)<\/p>/.exec(g);y&&(r.description=i(y[1]))}var A=/<div class="ui embed mdvid"[^<>]+?data-placeholder="([^"]+)"[^>]*\/?>/i.exec(g)||/<img class="ui [^"]*image" src="([^"]+)"[^>]*\/?>/i.exec(g);A&&(r.cardLogo=i(A[1])),r.twitter=i(e.theme.twitter||"@msmakecode");var w={};w.main="",g=(g=g.replace(/<!-- BEGIN-ASIDE (\S+) -->([^]*?)<!-- END-ASIDE -->/g,function(e,t,n){var r=d.lookup(w,t);return w[t]=(r||"")+n,"\x3c!-- aside --\x3e"})).replace(/\n<\/code>/g,"</code>"),w.main=g;g="";for(var E=0,k=Object.keys(w);E<k.length;E++)g+=function(e,t){return s(u.boxes[e]||"@BODY@",{BODY:t},["BODY"])}((S=k[E])+"-container",w[S]);r.body=g,r.name=r.title+" - "+r.targetname;for(var T=0,_=Object.keys(e.theme);T<_.length;T++){var S=_[T],U=e.theme[S];"string"==typeof U&&(r["theme_"+S]=U)}return u.finish()},t.embedUrl=function(e,t,n,r){return'<div style="position:relative;height:0;padding-bottom:70%;overflow:hidden;"><iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" src="'+e+"#"+t+":"+n+'" frameborder="0" sandbox="allow-popups allow-forms allow-scripts allow-same-origin"></iframe></div>'},t.runUrl=function(e,t,n){return'<div style="position:relative;height:0;padding-bottom:'+t+';overflow:hidden;"><iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" src="'+e+"?id="+encodeURIComponent(n)+'" allowfullscreen="allowfullscreen" sandbox="allow-popups allow-forms allow-scripts allow-same-origin" frameborder="0"></iframe></div>'},t.docsEmbedUrl=function(e,t,n){var r=e+"--docs?projectid="+t;return'<div style="position:relative;height:calc('+(n=Math.ceil(n||300))+'px + 5em);width:100%;overflow:hidden;"><iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" src="'+r+'" allowfullscreen="allowfullscreen" frameborder="0" sandbox="allow-popups allow-forms allow-scripts allow-same-origin"></iframe></div>'};var A={b:1,strong:1,em:1};t.translate=c,t.buildTOC=function(t){if(!t)return null;var n=e.docs.requireMarked(),r={renderer:new n.Renderer,gfm:!0,tables:!1,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!1,smartypants:!1},i={name:"dummy",subitems:[]},o=[];o.push(i),n.lexer(t,r).forEach(function(e){switch(e.type){case"heading":e.depth;break;case"list_start":break;case"list_item_start":case"loose_item_start":var t={name:"",subitems:[]};o.push(t);break;case"text":e.text.replace(/^\[(.*)\]\((.*)\)$/i,function(e,t,n){o[o.length-1].name=t,o[o.length-1].path=n.replace(".md","")});break;case"list_item_end":case"loose_item_end":var n=o.pop();o[o.length-1].subitems.push(n)}});var a=i.subitems;if(!a||0==a.length)return null;var s,c=function(e){s&&(e.prevName=s.name,e.prevPath=s.path,s.nextName=e.name,s.nextPath=e.path),e.path&&(s=e),e.subitems.forEach(function(e,t){c(e)})};return a.forEach(function(e,t){c(e)}),a},t.visitTOC=function(e,t){e.forEach(function(e){t(e),e.subitems&&e.subitems.forEach(t)})};var w=!1;t.augmentDocs=f}(e.docs||(e.docs={}))}(pxt||(pxt={}));var pxt;!function(e){!function(t){function n(t,n){return void 0===n&&(n="tags"),e.U.httpGetJsonAsync("https://api.github.com/repos/"+t+"/git/refs/"+n+"/?per_page=100").then(function(t){var n=t.map(function(e){return e.ref.replace(/^refs\/[^\/]+\//,"")});return n.sort(e.semver.strcmp),n},function(e){return 404==e.statusCode?[]:Promise.reject(e)})}function r(t){return"commit"==t.object.type?Promise.resolve(t.object.sha):"tag"==t.object.type?e.U.httpGetJsonAsync(t.object.url).then(function(e){return"commit"==e.object.type?e.object.sha:Promise.reject(new Error("Bad type (2nd order) "+e.object.type))}):Promise.reject(new Error("Bad type "+t.object.type))}function i(t,n){return/^[a-f0-9]{40}$/.test(n)?Promise.resolve(n):e.U.httpGetJsonAsync("https://api.github.com/repos/"+t+"/git/refs/tags/"+n).then(r,function(i){return e.U.httpGetJsonAsync("https://api.github.com/repos/"+t+"/git/refs/heads/"+n).then(r)})}function o(e,t,n){if(e){var r={owner:e.owner.login.toLowerCase(),fullName:e.full_name.toLowerCase(),name:e.name,description:e.description,defaultBranch:e.default_branch,tag:n};return r.status=a(r,t),r}}function a(e,t){return c(e,t)?g.Banned:u(e,t)?g.Approved:g.Unknown}function s(e,t){return!!t&&(!e||!e.owner||!(!t.bannedOrgs||!t.bannedOrgs.some(function(t){return t.toLowerCase()==e.owner.toLowerCase()})))}function c(e,t){return!!s(e,t)||!!t&&(!e||!e.fullName||!(!t.bannedRepos||!t.bannedRepos.some(function(t){return t.toLowerCase()==e.fullName.toLowerCase()})))}function l(e,t){return!(!e||!t)&&!!(e.owner&&t.approvedOrgs&&t.approvedOrgs.some(function(t){return t.toLowerCase()==e.owner.toLowerCase()}))}function u(e,t){return!!l(e,t)||!(!e||!t)&&!!(e.fullName&&t.approvedRepos&&t.approvedRepos.some(function(t){return t.toLowerCase()==e.fullName.toLowerCase()}))}function f(t,n){var r=h(t),i=a(r,n);return i==g.Banned?Promise.resolve(void 0):e.Util.httpGetJsonAsync(e.Cloud.apiRoot+"gh/"+r.fullName).then(function(e){if(e)return{github:!0,owner:r.owner,fullName:r.fullName,name:e.name,description:e.description,defaultBranch:"master",tag:r.tag,status:i}})}function p(e){if(e){var t=/^((https:\/\/)?github.com\/)?([^/]+\/[^/#]+)(#(\w+))?$/i.exec(e.trim());if(t){var n={repo:t?t[3].toLowerCase():null,tag:t?t[5]:null};return n.path=n.repo+(n.tag?"#"+n.tag:""),n}}}function h(e){if(e){e=e.replace(/^github:/i,"");var t=/([^#]+)(#(.*))?/.exec(e);return{owner:t?t[1].split("/")[0].toLowerCase():void 0,fullName:t?t[1].toLowerCase():e.toLowerCase(),tag:t?t[3]:null}}}function d(e){return e?"github:"+e.fullName.toLowerCase()+"#"+(e.tag||"master"):void 0}t.listRefsAsync=n,t.tagToShaAsync=i,t.pkgConfigAsync=function(t,n){void 0===n&&(n="master");var r="https://raw.githubusercontent.com/"+t+"/"+n+"/"+e.CONFIG_NAME;return e.U.httpGetTextAsync(r).then(function(e){return JSON.parse(e)})},t.downloadPackageAsync=function(t,n,r){void 0===r&&(r=null);var o=h(t);return o?c(o,n)?(e.tickEvent("github.download.banned"),e.log("Github repo is banned"),Promise.resolve(void 0)):i(o.fullName,o.tag).then(function(n){var i="https://raw.githubusercontent.com/"+o.fullName+"/"+n+"/";return r||(r={sha:"",files:{}}),r.sha===n?Promise.resolve(r):(e.log("Downloading "+t+" -> "+n),e.U.httpGetTextAsync(i+e.CONFIG_NAME).then(function(t){r.files={},r.sha="",r.files[e.CONFIG_NAME]=t;var o=JSON.parse(t);return Promise.map(o.files.concat(o.testFiles||[]),function(t){return e.U.httpGetTextAsync(i+t).then(function(e){r.files[t]=e})}).then(function(){return r.sha=n,r})}))}):(e.log("Unknown github syntax"),Promise.resolve(void 0))},function(e){e[e.Unknown=0]="Unknown",e[e.Approved=1]="Approved",e[e.Banned=2]="Banned"}(t.GitRepoStatus||(t.GitRepoStatus={}));var g=t.GitRepoStatus;t.repoIconUrl=function(t){if(t.status==g.Approved)return e.Cloud.apiRoot+"gh/"+t.fullName+"/icon"},t.repoStatus=a,t.repoAsync=f,t.searchAsync=function(t,n){if(!n)return Promise.resolve([]);var r=t.split("|").map(p).filter(function(e){return!!e});return r.length>0?Promise.all(r.map(function(e){return f(e.path,n)})).then(function(e){return e.filter(function(e){return e.status!=g.Banned})}):(t+=' in:name,description,readme "for PXT/'+(e.appTarget.platformid||e.appTarget.id)+'"',e.U.httpGetJsonAsync("https://api.github.com/search/repositories?q="+encodeURIComponent(t)).then(function(e){return e.items.map(function(e){return o(e,n)}).filter(function(e){return e.status==g.Approved||n.allowUnapproved&&e.status==g.Unknown})}).catch(function(e){return[]}))},t.parseRepoUrl=p,t.parseRepoId=h,t.isGithubId=function(e){return"github:"==e.slice(0,7)},t.stringifyRepo=d,t.noramlizeRepoId=function(e){return d(h(e))},t.latestVersionAsync=function(t,r){var o=h(t);return o?f(o.fullName,r).then(function(t){if(t)return n(t.fullName,"tags").then(function(n){return n.sort(e.semver.strcmp),n.reverse(),n[0]?Promise.resolve(n[0]):i(t.fullName,t.defaultBranch)})}):Promise.resolve(null)},t.publishGistAsync=function(t,n,r,i,o){var a,s={description:i,public:!1,files:r},c={},l="https://api.github.com/gists";return t&&(c.Authorization="token "+t),o&&t&&!n?(a="PATCH",l+="/"+o):a="POST",e.U.requestAsync({url:l,allowHttpErrors:!0,headers:c,method:a,data:s||{}}).then(function(e){return 200!=e.statusCode&&201!=e.statusCode||!e.json.id?404==e.statusCode&&"PATCH"==a?Promise.reject(e.statusCode):404==e.statusCode?Promise.reject("Make sure to add the ``gist`` scope to your token. "+e.text):Promise.reject(e.text):Promise.resolve(e.json.id)})}}(e.github||(e.github={}))}(pxt||(pxt={}));var pxt;!function(e){!function(t){function n(e,t,n){e[t+0]=n>>0&255,e[t+1]=n>>8&255,e[t+2]=n>>16&255,e[t+3]=n>>24&255}function r(e,t,n){e[t+0]=n>>0&255,e[t+1]=n>>8&255}function i(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function o(e,t){return e[t]|e[t+1]<<8}function a(e){for(var t=new Uint8Array(4*e.length),r=0;r<e.length;++r)n(t,4*r,e[r]);return t}function s(t){u?e.log("HF2: "+t):e.debug("HF2: "+t)}function c(t){return e.appTarget.compile.flashChecksumAddr?t(e.appTarget.compile.flashChecksumAddr,12).then(function(n){var r=pxtc.hex.parseChecksumBlock(n);return r?t(r.endMarkerPos,1).then(function(t){return i(t,0)!=r.endMarker?(e.log("end-marker mismatch"),null):r}):null}):Promise.resolve(null)}function l(t,n){if(!e.appTarget.compile.flashChecksumAddr)return Promise.resolve(t);var r=pxtc.UF2.readBytes(t,e.appTarget.compile.flashChecksumAddr,48),i=pxtc.hex.parseChecksumBlock(r);return i?c(n).then(function(e){if(!e)return t;var n=e.regions.filter(function(e){return i.regions.some(function(t){return e.checksum==t.checksum&&e.length==t.length&&e.start==t.start})});if(0==n.length)return t;s("skipping flash at: "+n.map(function(e){return pxtc.assembler.tohex(e.start)+" ("+e.length/1024+"kB)"}).join(", "));var r=function(e){return n.some(function(t){return t.start<=e&&e<t.start+t.length})};return t.filter(function(e){return!(r(e.targetAddr)&&r(e.targetAddr+e.payloadSize-1))})}):Promise.resolve(t)}t.HF2_CMD_BININFO=1,t.HF2_MODE_BOOTLOADER=1,t.HF2_MODE_USERSPACE=2,t.HF2_CMD_INFO=2,t.HF2_CMD_RESET_INTO_APP=3,t.HF2_CMD_RESET_INTO_BOOTLOADER=4,t.HF2_CMD_START_FLASH=5,t.HF2_CMD_WRITE_FLASH_PAGE=6,t.HF2_CMD_CHKSUM_PAGES=7,t.HF2_CMD_READ_WORDS=8,t.HF2_CMD_WRITE_WORDS=9,t.HF2_CMD_DMESG=16,t.HF2_FLAG_SERIAL_OUT=128,t.HF2_FLAG_SERIAL_ERR=192,t.HF2_FLAG_CMDPKT_LAST=64,t.HF2_FLAG_CMDPKT_BODY=0,t.HF2_FLAG_MASK=192,t.HF2_SIZE_MASK=63,t.HF2_STATUS_OK=0,t.HF2_STATUS_INVALID_CMD=1,t.HF2_STATUS_EXEC_ERR=2,t.HF2_STATUS_EVENT=128,t.HF2_EV_MASK=8388608,t.write32=n,t.write16=r,t.read32=i,t.read16=o,t.encodeU32LE=a,t.decodeU32LE=function(e){for(var t=[],n=0;n<e.length;n+=4)t.push(i(e,n));return t};var u=!1;t.enableLog=function(){u=!0};var f=function(){function c(n){var r=this;this.io=n,this.cmdSeq=e.U.randomUint32(),this.lock=new e.U.PromiseQueue,this.rawMode=!1,this.maxMsgSize=63,this.bootloaderMode=!1,this.reconnectTries=0,this.autoReconnect=!1,this.msgs=new e.U.PromiseBuffer,this.eventHandlers={},this.onSerial=function(e,t){};var o=[];n.onSerial=function(e,t){return r.onSerial(e,t)},n.onData=function(i){var a=i[0]&t.HF2_FLAG_MASK,s=63&i[0],c=new Uint8Array(s);if(e.U.memcpy(c,0,i,1,s),a&t.HF2_FLAG_SERIAL_OUT)r.onSerial(c,a==t.HF2_FLAG_SERIAL_ERR);else if(o.push(c),a!=t.HF2_FLAG_CMDPKT_BODY){e.U.assert(a==t.HF2_FLAG_CMDPKT_LAST);for(var l=0,u=0,f=o;u<f.length;u++)l+=(m=f[u]).length;for(var p=new Uint8Array(l),h=0,d=0,g=o;d<g.length;d++){var m=g[d];e.U.memcpy(p,h,m),h+=m.length}o=[],p[2]&t.HF2_STATUS_EVENT?n.onEvent(p):r.msgs.push(p)}},n.onEvent=function(t){var n=i(t,0),o=e.U.lookup(r.eventHandlers,n+"");o?o(t.slice(4)):s("unhandled event: "+n.toString(16))},n.onError=function(e){s("recv error: "+e.message),r.autoReconnect&&(r.autoReconnect=!1,r.reconnectAsync().then(function(){r.autoReconnect=!0},function(e){s("reconnect error: "+e.message)}))}}return c.prototype.resetState=function(){this.lock=new e.U.PromiseQueue,this.info=null,this.infoRaw=null,this.pageSize=null,this.flashSize=null,this.maxMsgSize=63,this.bootloaderMode=!1,this.msgs.drain()},c.prototype.onEvent=function(n,r){e.U.assert(!!(n&t.HF2_EV_MASK)),this.eventHandlers[n+""]=r},c.prototype.reconnectAsync=function(e){var t=this;return void 0===e&&(e=!1),this.resetState(),e?this.initAsync():(s("reconnect raw="+this.rawMode),this.io.reconnectAsync().then(function(){return t.initAsync()}).catch(function(e){if(t.reconnectTries<5)return t.reconnectTries++,s("error "+e.message+"; reconnecting attempt #"+t.reconnectTries),Promise.delay(500).then(function(){return t.reconnectAsync()});throw e}))},c.prototype.disconnectAsync=function(){return s("disconnect"),this.io.disconnectAsync()},c.prototype.error=function(e){return this.io.error(e)},c.prototype.talkAsync=function(i,a){var c=this;if(this.io.talksAsync)return this.io.talksAsync([{cmd:i,data:a}]).then(function(e){return e[0]});var l=8;a&&(l+=a.length);var u=new Uint8Array(l),f=65535&++this.cmdSeq;n(u,0,i),r(u,4,f),r(u,6,0),a&&e.U.memcpy(u,8,a,0,a.length);var p=0,h=function(){return c.msgs.shiftAsync(1e3).then(function(e){if(o(e,0)!=f){if(p<3)return p++,s("message out of sync, ("+f+" vs "+o(e,0)+"); will re-try"),h();c.error("out of sync")}var n="";switch(e[3]&&(n="; info="+e[3]),e[2]){case t.HF2_STATUS_OK:return e.slice(4);case t.HF2_STATUS_INVALID_CMD:c.error("invalid command"+n);break;case t.HF2_STATUS_EXEC_ERR:c.error("execution error"+n);break;default:c.error("error "+e[2]+n)}return null})};return this.sendMsgAsync(u).then(h)},c.prototype.sendMsgAsync=function(e){return this.sendMsgCoreAsync(e)},c.prototype.sendSerialAsync=function(e,t){return void 0===t&&(t=!1),this.io.sendSerialAsync?this.io.sendSerialAsync(e,t):this.sendMsgCoreAsync(e,t?2:1)},c.prototype.sendMsgCoreAsync=function(e,n){var r=this;void 0===n&&(n=0);var i=new Uint8Array(64),o=function(a){var s=e.length-a;if(s<=0)return Promise.resolve();s>63?(s=63,i[0]=t.HF2_FLAG_CMDPKT_BODY):i[0]=t.HF2_FLAG_CMDPKT_LAST,n&&(i[0]=1==n?t.HF2_FLAG_SERIAL_OUT:t.HF2_FLAG_SERIAL_ERR),i[0]|=s;for(var c=0;c<s;++c)i[c+1]=e[a+c];return r.io.sendPacketAsync(i).then(function(){return o(a+s)})};return this.lock.enqueue("out",function(){return o(0)})},c.prototype.switchToBootloaderAsync=function(){var e=this;return this.bootloaderMode?Promise.resolve():(s("Switching into bootloader mode"),this.talkAsync(t.HF2_CMD_START_FLASH).then(function(){return e.initAsync()}).then(function(){e.bootloaderMode||e.error("cannot switch into bootloader mode")}))},c.prototype.reflashAsync=function(e){var t=this;return s("reflash"),this.flashAsync(e).then(function(){return Promise.delay(100)}).then(function(){return t.reconnectAsync()})},c.prototype.writeWordsAsync=function(n,r){return e.U.assert(r.length<=64),this.talkAsync(t.HF2_CMD_WRITE_WORDS,a([n,r.length].concat(r))).then(function(){})},c.prototype.readWordsAsync=function(r,i){var o=new Uint8Array(8);return n(o,0,r),n(o,4,i),e.U.assert(i<=64),this.talkAsync(t.HF2_CMD_READ_WORDS,o)},c.prototype.pingAsync=function(){return this.rawMode?Promise.resolve():this.talkAsync(t.HF2_CMD_BININFO).then(function(e){})},c.prototype.flashAsync=function(r){var i=this,o=Date.now(),a=0,c=function(o){if(o>=r.length)return Promise.resolve();var a=r[o];e.U.assert(a.payloadSize==i.pageSize);var s=new Uint8Array(4+a.payloadSize);return n(s,0,a.targetAddr),e.U.memcpy(s,4,a.data,0,a.payloadSize),i.talkAsync(t.HF2_CMD_WRITE_FLASH_PAGE,s).then(function(){return c(o+1)})};return this.switchToBootloaderAsync().then(function(){var e=r.length*i.pageSize;return s("Starting flash ("+Math.round(e/1024)+"kB)."),a=Date.now(),l(r,function(e,t){return i.readWordsAsync(e,t)})}).then(function(e){if(e.length!=r.length){var t=(r=e).length*i.pageSize;s("Performing partial flash ("+Math.round(t/1024)+"kB).")}}).then(function(){return c(0)}).then(function(){var e=Date.now(),t=e-o,n=e-a;s("Flashing done at "+Math.round(r.length*i.pageSize/n*1e3/1024)+" kB/s in "+t+"ms (reset "+(t-n)+"ms). Resetting.")}).then(function(){return i.talkAsync(t.HF2_CMD_RESET_INTO_APP).catch(function(e){})}).then(function(){})},c.prototype.initAsync=function(){var n=this;return this.rawMode?Promise.resolve():Promise.resolve().then(function(){return n.talkAsync(t.HF2_CMD_BININFO)}).then(function(e){return n.bootloaderMode=e[0]==t.HF2_MODE_BOOTLOADER,n.pageSize=i(e,4),n.flashSize=i(e,8)*n.pageSize,n.maxMsgSize=i(e,12),s("Connected; msgSize "+n.maxMsgSize+"B; flash "+n.flashSize/1024+"kB; "+(n.bootloaderMode?"bootloader":"application")+" mode"),n.talkAsync(t.HF2_CMD_INFO)}).then(function(t){n.infoRaw=e.U.fromUTF8(e.U.uint8ArrayToString(t));var r={};("Header: "+n.infoRaw).replace(/^([\w\-]+):\s*([^\n\r]*)/gm,function(e,t,n){return r[t.replace(/-/g,"")]=n,""}),n.info=r;var i=/v(\d\S+)\s+(\S+)/.exec(n.info.Header);n.info.Parsed={Version:i[1],Features:i[2]},s("Board-ID: "+n.info.BoardID+" v"+n.info.Parsed.Version+" f"+n.info.Parsed.Features)}).then(function(){n.reconnectTries=0})},c}();t.Wrapper=f,t.onlyChangedBlocksAsync=l}(e.HF2||(e.HF2={}))}(pxt||(pxt={}));var pxt;!function(e){e.REF_TAG_STRING=1,e.REF_TAG_BUFFER=2,e.REF_TAG_IMAGE=3,e.REF_TAG_NUMBER=32,e.REF_TAG_ACTION=33}(pxt||(pxt={}));var pxt;!function(e){!function(t){function n(e){return e<<2|2}function r(){return I=!1,m=null,b=null,Promise.resolve()}function i(e){if(1&e)return e>>1;if(0!=e)return 2&e?e==t.taggedNull?null:e!=t.taggedFalse&&(e==t.taggedTrue||{tagged:e>>2}):{ptr:e}}function o(e,t){if(k.assert(!(3&e)),k.assert(e>=0),e<2097152){var n=new Uint8Array(t);return e-=w.start,k.memcpy(n,0,w.buf,e,t),Promise.resolve(n)}var r=E.maxMsgSize-32;if(t>r){for(var i=[];t>0;){var a=Math.min(r,t);i.push(o(e,a)),t-=a,e+=a}return Promise.all(i).then(k.uint8ArrayConcat)}return E.readWordsAsync(e,Math.ceil(t/4)).then(function(e){return e.length>t?e.slice(0,t):e})}function a(t){if("object"!=typeof t||!t)return Promise.resolve(t);if("number"==typeof t.ptr){if(3&t.ptr)return Promise.resolve({unalignedPtr:t.ptr});var n=0;return o(t.ptr,56).then(function(r){n=T.read16(r,2);var i=r.length;return n==e.REF_TAG_STRING||n==e.REF_TAG_BUFFER?i=T.read16(r,4)+6:n==e.REF_TAG_IMAGE?i=T.read16(r,4)*T.read16(r,8)+8:n==e.REF_TAG_NUMBER&&(i=12),i>r.length?o(t.ptr+r.length,i-r.length).then(function(e){return k.uint8ArrayConcat([r,e])}):i<r.length?r.slice(0,i):r}).then(function(t){return n==e.REF_TAG_STRING?k.uint8ArrayToString(t.slice(6)):n==e.REF_TAG_STRING?{type:"buffer",data:t.slice(6)}:n==e.REF_TAG_IMAGE?{type:"image",data:t.slice(8),width:T.read16(t,4),height:T.read16(t,8)}:n==e.REF_TAG_NUMBER?new Float64Array(t.buffer.slice(4))[0]:{type:"unknown",tag:n,refcnt:T.read16(t,0),data:t.slice(4)}})}return Promise.resolve(t)}function s(e){for(var t=[],n=0,r=Object.keys(e);n<r.length;n++)!function(n){t.push(a(e[n]).then(function(t){e[n]=t}))}(r[n]);return Promise.all(t).then(function(){})}function c(e,t){for(var n=x.binAddr,r=0,o=m.procDebugInfo.filter(function(e){return e.codeStartLoc<=n&&n<=e.codeEndLoc})[0];;){if(!o)break;if(o==m.procDebugInfo[0])break;var a=l(n),s=k.clone(a);s.functionName=o.name,t.stackframes.push({locals:{},funcInfo:s,breakpointId:a.id});for(var c=t.stackframes[t.stackframes.length-1],u=0,f=0,p=o.locals;f<p.length;f++){v=p[f];k.assert(v.index==u++),c.locals[v.name]=i(e[r++])}n=2147483646&e[r++];for(var h=A[n+""],d=0,g=o.args;d<g.length;d++){var v=g[d];c.locals[v.name]=i(e[r+(o.args.length-1-v.index)])}if(!h)break;o=h.from,r+=h.stack-o.localsMark}}function l(e){for(var t=m.breakpoints,n=t[0],r=1/0,i=0,o=t;i<o.length;i++){var a=o[i],s=e-a.binAddr;s>=0&&s<r&&(r=s,n=a)}return n}function u(e){if(I)return Promise.resolve();I=!0;var n;return g().then(function(t){for(var r=T.decodeU32LE(e)[0],o={},a=0,s=m.procDebugInfo[0].locals;a<s.length;a++)!function(e){var n=t.globals,r=function(){switch(e.type){case"uint32":return T.read32(n,e.index);case"int32":return 0|T.read32(n,e.index);case"uint16":return T.read16(n,e.index);case"int16":return T.read16(n,e.index)<<16>>16;case"uint8":return n[e.index];case"int8":return n[e.index]<<24>>24;default:return null}}();null===r&&(k.assert(0==(3&e.index)),r=i(T.read32(n,e.index))),o[e.name]=r}(s[a]);return x=l(r),n={type:"debugger",subtype:"breakpoint",breakpointId:x.id,globals:o,stackframes:[]},y(),E.talkAsync(O)}).then(function(e){c(T.decodeU32LE(e),n);var t=[n.globals].concat(n.stackframes.map(function(e){return e.locals}));return Promise.map(t,s)}).then(function(){return t.postMessage(n)})}function f(){I=!1,v=new Promise(function(e,t){y=e})}function p(e){return void 0===e&&(e=!1),Promise.resolve().then(function(){return E.talkAsync(S,T.encodeU32LE([e?1:3]))}).then(f)}function h(){return v||(v=Promise.resolve()),v}function d(){return b?Promise.resolve(b):E.talkAsync(_).then(function(e){return b={numGlobals:P(e,0),globalsPtr:P(e,4)}})}function g(){return d().then(function(e){return E.readWordsAsync(e.globalsPtr,e.numGlobals)}).then(function(e){return{staticState:b,globals:e}})}var m,v,y,b,x,A,w,E,k=e.Util,T=e.HF2,_=1409050336,S=665147697,U=287358355,O=1888490768,C=915601917,P=T.read32,I=!1;t.taggedUndefined=0,t.taggedNull=n(1),t.taggedFalse=n(2),t.taggedTrue=n(16),t.postMessage=function(e){return console.log(e)},t.decodeValue=i,t.heapExpandAsync=a,t.heapExpandMapAsync=s,t.startDebugAsync=function(e,t){return(E=t).onEvent(C,u),r().then(function(){m=e,A={};for(var t=[],n=0,r=e.procDebugInfo;n<r.length;n++)t[(a=r[n]).idx]=a;for(var i=0,o=e.procDebugInfo;i<o.length;i++)for(var a=o[i],s=0,c=a.calls;s<c.length;s++){var l=c[s];A[l.addr+""]={from:a,to:t[l.procIndex],stack:l.stack}}}).then(function(){var e=m.outfiles[pxtc.BINARY_UF2],t=k.stringToUint8Array(atob(e));w=pxtc.UF2.toBin(t);var n=pxtc.UF2.parseFile(t);return E.reflashAsync(n)}).then(function(){return E.talkAsync(U).catch(function(e){})}).then(function(){return Promise.delay(200)}).then(function(){return E.reconnectAsync()}).then(f).then(h)},t.handleMessage=function(e){if(console.log("HWDBGMSG",e),"debugger"==e.type){var t=!1;switch(e.subtype){case"stepinto":t=!0;case"stepover":p(t)}}},t.resumeAsync=p,t.waitForHaltAsync=h,t.getHwStateAsync=g}(e.HWDBG||(e.HWDBG={}))}(pxt||(pxt={}));var pxt;!function(e){!function(t){function n(e){return e.length>20&&/\n/.test(e)?"`"+e.replace(/[\\`${}]/g,function(e){return"\\"+e})+"`":JSON.stringify(e)}function r(e,t,n){return{type:e,op:t,children:n}}function i(){return r(p.NewLine,"",[])}function o(e,t){return r(p.Prefix,e,t)}function a(e,t,n){return r(p.Infix,t,null==e?[n]:[e,n])}function s(e){return o(e,[])}function c(e){return r(p.Block,"",e)}function l(e){return o("",e)}function u(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var n=e[e.length-1];return n&&n.type==p.Block||e.push(i()),l(e)}function f(e,t){void 0===t&&(t=!1);for(var n=[],r=0,o=e;r<o.length;r++){var a=o[r];t?(n.length>0&&n.push(s(",")),n.push(i())):n.length>0&&n.push(s(", ")),n.push(a)}return t&&n.push(i()),l(n)}!function(e){e[e.Prefix=0]="Prefix",e[e.Infix=1]="Infix",e[e.Block=2]="Block",e[e.NewLine=3]="NewLine"}(t.NT||(t.NT={}));var p=t.NT;!function(e){e[e.None=0]="None",e[e.WithSpace=1]="WithSpace",e[e.NoSpace=2]="NoSpace"}(t.GlueMode||(t.GlueMode={}));var h=t.GlueMode,d=["break","case","catch","class","const","continue","debugger","default","delete","do","else","enum","export","extends","false","finally","for","function","if","import","in","instanceof","new","null","return","super","switch","this","throw","true","try","typeof","var","void","while","with"];t.stringLit=n,t.mkNode=r,t.mkNewLine=i,t.mkPrefix=o,t.mkInfix=a,t.mkText=s,t.mkBlock=c,t.mkGroup=l,t.mkStmt=u,t.mkCommaSep=f;var g;!function(t){function r(e,t,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!1),l(r?[a(t[0],".",s(e)),s("("),f(t.slice(1),n),s(")")]:[s(e),s("("),f(t,n),s(")")])}function i(e,t,n,i){return r(e+"."+t,n,i)}function o(t,n){return e.U.assert(2==n.length),a(n[0],t,n[1])}t.mkArrayLiteral=function(e){return l([s("["),f(e,!1),s("]")])},t.mkNumberLiteral=function(e){return s(e.toString())},t.mkBooleanLiteral=function(e){return s(e?"true":"false")},t.mkStringLiteral=function(e){return s(n(e))},t.mkPropertyAccess=function(e,t){return l([a(t,".",s(e))])},t.mkCall=r,t.stdCall=function(e,t,n){return r(e,t,n)},t.extensionCall=function(e,t,n){return r(e,t,n,!0)},t.namespaceCall=i,t.mathCall=function(e,t){return i("Math",e,t,!1)},t.mkGlobalRef=function(e){return s(e)},t.mkSimpleCall=o,t.mkWhile=function(e,t){return l([s("while ("),e,s(")"),c(t)])},t.mkComment=function(e){return u(s("// "+e))},t.mkAssign=function(e,t){return u(o("=",[e,t]))},t.mkParenthesizedExpression=function(e){return l([s("("),e,s(")")])}}(g=t.Helpers||(t.Helpers={})),t.H=g;var m={"=":3,"+=":3,"-=":3,"?":4,":":4,"||":5,"&&":6,"|":7,"^":8,"&":9,"==":10,"!=":10,"===":10,"!==":10,"<":11,">":11,"<=":11,">=":11,">>":12,">>>":12,"<<":12,"+":13,"-":13,"*":14,"/":14,"%":14,"**":15,"!":16,"~":16,"P-":16,"P+":16,"++":16,"--":16,".":18};t.flattenNode=function(t){function n(t){t.glueToBlock&&(o(),t.glueToBlock==h.WithSpace&&(f+=" "));var i=r();switch(t.type){case p.Infix:e.U.oops("no infix should be left");break;case p.NewLine:f+="\n"+d;break;case p.Block:a(t);break;case p.Prefix:t.canIndentInside?f+=t.op.replace(/\n/g,"\n"+d+"    "):f+=t.op,t.children.forEach(n)}var s=r();if(t.id)if(u[t.id]){var l=u[t.id];l.start=Math.min(l.start,i),l.end=Math.max(l.end,s)}else{var g={id:t.id,start:i,end:s};u[t.id]=g,c.push(g)}}function r(){var e=0;return f.replace(/\n/g,function(t){return e++,t}),e}function i(e){f+=e.replace(/\n/g,"\n"+d)}function o(){f=f.replace(/\n *$/,"")}function a(t){var r=t.noFinalNewline?"":"\n";if(0!=t.children.length){var a=e.U.clone(g[g.length-1]||{});g.push(a),d+="    "," "!=f[f.length-1]&&i(" "),i("{\n");for(var s=0,c=t.children;s<c.length;s++)n(c[s]);d=d.slice(4),o(),i("\n}"+r),g.pop()}else i(" {\n\t\n}"+r)}var c=[],u={},f="",d="",g=[{}],v=l(t);return function(t){function n(t,r){function i(e){"P"==e[0]&&(e=e.slice(1)),o.push(s(e))}if(t.type==p.Infix){var o=[],a=e.U.lookup(m,t.op);if(null==a&&e.U.oops("bad infix op: "+t.op),a<r&&i("("),1==t.children.length)i(t.op),n(t.children[0],a),o.push(t.children[0]);else{var c=3!=a&&"**"!=t.op;n(t.children[0],c?a:a+.1),o.push(t.children[0]),i("."==t.op?".":" "+t.op+" "),n(t.children[1],c?a+.1:a),o.push(t.children[1])}a<r&&i(")"),t.type=p.Prefix,t.op="",t.children=o}else for(var l=0,u=t.children;l<u.length;l++)n(u[l],-1)}n(v,-1)}(),n(v),f||(f+="\n"),{output:f,sourceMap:c}},t.isReservedWord=function(e){return-1!==d.indexOf(e)}}(e.blocks||(e.blocks={}))}(pxt||(pxt={}));var pxt;!function(e){var t=e.U.lf,n=function(){function n(e,t,n,r){this.id=e,this._verspec=t,this.parent=n,this.level=-1,this.isLoaded=!1,r&&(this.level=r.level+1),this.addedBy=[r]}return n.getConfigAsync=function(t,r){return Promise.resolve().then(function(){if(e.github.isGithubId(r)){var i=e.github.parseRepoId(r);return e.packagesConfigAsync().then(function(t){return e.github.repoAsync(i.fullName,t)}).then(function(t){return t?e.github.pkgConfigAsync(i.fullName,i.tag):null})}return JSON.parse(e.appTarget.bundledpkgs[n.upgradePackageReference(t,r)][e.CONFIG_NAME])})},n.upgradePackageReference=function(t,n){if("*"!=n)return t;var r=e.appTarget.compile?e.appTarget.compile.upgrades:void 0,i=t;return r&&r.filter(function(e){return"package"==e.type}).forEach(function(e){for(var t in e.map)i==t&&(i=e.map[t])}),i},n.prototype.version=function(){return this.resolvedVersion||this._verspec},n.prototype.verProtocol=function(){var e=this.version().split(":");return e.length>1?e[0]:""},n.prototype.verArgument=function(){var e=this.verProtocol();return e?this.version().slice(e.length+1):this.version()},n.prototype.commonDownloadAsync=function(){var t=this,n=this.verProtocol();if("pub"==n)return e.Cloud.downloadScriptFilesAsync(this.verArgument());if("github"==n)return e.packagesConfigAsync().then(function(n){return e.github.downloadPackageAsync(t.verArgument(),n)}).then(function(e){return e.files});if("embed"==n){var r=e.getEmbeddedScript(this.verArgument());return Promise.resolve(r)}return Promise.resolve(null)},n.prototype.host=function(){return this.parent._host},n.prototype.readFile=function(e){return this.host().readFile(this,e)},n.prototype.resolveDep=function(e){return this.parent.deps.hasOwnProperty(e)?this.parent.deps[e]:null},n.prototype.saveConfig=function(){var t=JSON.stringify(this.config,null,4)||"\n";this.host().writeFile(this,e.CONFIG_NAME,t)},n.prototype.parseJRes=function(t){void 0===t&&(t={});for(var n=0,r=this.getFiles();n<r.length;n++){var i=r[n];if(e.U.endsWith(i,".jres"))for(var o=JSON.parse(this.readFile(i)),a=o["*"],s=0,c=Object.keys(o);s<c.length;s++){var l=c[s];if("*"!=l){var u=o[l];"string"==typeof u&&(u={data:u});var f=u.namespace||a.namespace||"";f&&(f+=".");var p=u.id||f+l,h=u.icon,d=u.mimeType||a.mimeType,g=u.dataEncoding||a.dataEncoding||"base64";h||"base64"!=g||"image/png"!=d&&"image/jpeg"!=d||(h="data:"+d+";base64,"+u.data),t[p]={id:p,data:u.data,dataEncoding:u.dataEncoding||a.dataEncoding||"base64",icon:h,namespace:f,mimeType:d}}}}return t},n.prototype.resolveVersionAsync=function(){var n=this._verspec;return e.getEmbeddedScript(this.id)?this.resolvedVersion=n="embed:"+this.id:n&&"*"!=n||e.U.userError(t("version not specified for {0}",this.id)),Promise.resolve(n)},n.prototype.downloadAsync=function(){var t=this;return this.resolveVersionAsync().then(function(n){if(/^embed:/.test(n)||!t.config||t.config.installedVersion!=n)return e.debug("downloading "+n),t.host().downloadPackageAsync(t).then(function(){var n=t.readFile(e.CONFIG_NAME);n||e.U.userError("package "+t.id+" is missing "+e.CONFIG_NAME),t.parseConfig(n),0!=t.level&&(t.config.installedVersion=t.version()),t.saveConfig()}).then(function(){e.debug("installed "+t.id+" /"+n)})})},n.prototype.validateConfig=function(){this.config.dependencies||e.U.userError("Missing dependencies in config of: "+this.id),Array.isArray(this.config.files)||e.U.userError("Missing files in config of: "+this.id),("string"!=typeof this.config.name||!this.config.name||this.config.public&&!/^[a-z][a-z0-9\-_]+$/i.test(this.config.name))&&e.U.userError("Invalid package name: "+this.config.name),this.config.targetVersions&&this.config.targetVersions.target&&e.semver.strcmp(this.config.targetVersions.target,e.appTarget.versions.target)>0&&e.U.userError(t("Package {0} requires target version {1} (you are running {2})",this.config.name,this.config.targetVersions.target,e.appTarget.versions.target))},n.prototype.isPackageInUse=function(t,n){void 0===n&&(n=this.readFile("main.ts"));var r=null,i=e.appTarget.compile?e.appTarget.compile.upgrades:void 0;return i&&i.filter(function(e){return"missingPackage"==e.type}).forEach(function(e){Object.keys(e.map).forEach(function(n){e.map[n]===t&&(r=new RegExp(n,"g"))})}),r||(r=new RegExp(t+"\\.","g")),r.test(n)},n.prototype.getMissingPackages=function(t,n){var r=e.appTarget.compile?e.appTarget.compile.upgrades:void 0,i={};return n&&r&&r.filter(function(e){return"missingPackage"==e.type}).forEach(function(e){for(var r in e.map)!function(r){var o=new RegExp(r,"g"),a=e.map[r];n.replace(o,function(e){return t.dependencies[a]||(i[a]="*"),""})}(r)}),i},n.prototype.findConflictsAsync=function(r,i){var o,a=this,s=[];return Promise.resolve().then(function(){return"string"==typeof r?n.getConfigAsync(r,i):Promise.resolve(r)}).then(function(n){if(o=n){var r=o.yotta?e.U.jsonFlatten(o.yotta.config):null;a.parent.sortedDeps().forEach(function(n){if(o.core&&n.config.core)return(g=new e.cpp.PkgConflictError(t("conflict between core packages {0} and {1}",o.name,n.id))).pkg0=n,void s.push(g);var a=!1;if(r){var c=n.config||JSON.parse(n.readFile(e.CONFIG_NAME));if(!!c&&!!c.yotta&&!!n.config.yotta.config)for(var l=e.U.jsonFlatten(c.yotta.config),u=0,f=Object.keys(r);u<f.length;u++){var p=f[u],h=l[p],d=o.yotta.configIsJustDefaults||c.yotta.configIsJustDefaults;!l.hasOwnProperty(p)||h===r[p]||d||n.parent.config.yotta&&n.parent.config.yotta.ignoreConflicts||((g=new e.cpp.PkgConflictError(t("conflict on yotta setting {0} between packages {1} and {2}",p,o.name,n.id))).pkg0=n,g.settingName=p,s.push(g),a=!0)}}if(!a&&o.name===n.id&&n._verspec!=i&&!/^file:/.test(n._verspec)&&!/^file:/.test(i)){var g=new e.cpp.PkgConflictError(t("version mismatch for package {0} (installed: {1}, installing: {2})",n,n._verspec,i));g.pkg0=n,g.isVersionConflict=!0,s.push(g)}})}return Object.keys(o.dependencies).reduce(function(e,t){return e.then(function(){return a.findConflictsAsync(t,o.dependencies[t])}).then(function(e){return s.push.apply(s,e)})},Promise.resolve())}).then(function(){var n=function(e){var t=[];return e.addedBy.forEach(function(e){e.id!==a.id&&(t.push.apply(n(e)),t.push(e))}),t},r=[];return s.forEach(function(a){r.push.apply(r,n(a.pkg0).map(function(n){var r=new e.cpp.PkgConflictError(a.isVersionConflict?t("a dependency of {0} has a version mismatch with package {1} (installed: {1}, installing: {2})",n.id,o.name,a.pkg0._verspec,i):t("conflict on yotta setting {0} between packages {1} and {2}",a.settingName,o.name,a.pkg0.id));return r.pkg0=n,r}))}),s.push.apply(s,r),s=s.filter(function(e,t){for(var n=0;n<t;++n)if(e.pkg0.id===s[n].pkg0.id)return!1;return!0})})},n.prototype.upgradeAPI=function(t){var n=e.appTarget.compile?e.appTarget.compile.upgrades:void 0,r=t;return n&&n.filter(function(e){return"api"==e.type}).forEach(function(e){for(var t in e.map){var n=new RegExp(t,"g");r=r.replace(n,e.map[t])}}),r},n.prototype.parseConfig=function(e){var t=JSON.parse(e);this.config=t;var r=JSON.stringify(this.config);for(var i in this.config.dependencies){var o=n.upgradePackageReference(i,this.config.dependencies[i]);o!=i&&(delete this.config.dependencies[i],o&&(this.config.dependencies[o]="*"))}JSON.stringify(this.config)!=r&&this.saveConfig(),this.validateConfig()},n.prototype.loadAsync=function(t){var r=this;if(void 0===t&&(t=!1),this.isLoaded)return Promise.resolve();var i=Promise.resolve();this.isLoaded=!0;var o=this.readFile(e.CONFIG_NAME);null==o?t||e.U.userError("Package not installed: "+this.id+", did you forget to run `pxt install`?"):i=i.then(function(){return r.parseConfig(o)}),t&&(i=i.then(function(){return r.downloadAsync()})),e.appTarget.simulator&&e.appTarget.simulator.dynamicBoardDefinition&&(i=i.then(function(){if(!(r.config.files.indexOf("board.json")<0)){e.appTarget.simulator.boardDefinition=JSON.parse(r.readFile("board.json"));var t=function(t){var n=/^pkg:\/\/(.*)/.exec(t);if(n){var i=n[1],o=r.readFile(i);return e.U.toDataUri(o,e.U.getMime(i))}return t},n=e.appTarget.simulator.boardDefinition;if("object"==typeof n.visual){var i=n.visual;i.image=t(i.image),i.outlineImage=t(i.outlineImage)}}}));var a=function(i){return e.U.mapStringMapAsync(i,function(i,o){var a=r.resolveDep(i);return o=o||"*",a?(a._verspec==o||/^file:/.test(a._verspec)||/^file:/.test(o)||e.U.userError("Version spec mismatch on "+i),a.level=Math.min(a.level,r.level+1),a.addedBy.push(r),Promise.resolve()):(a=new n(i,o,r.parent,r),r.parent.deps[i]=a,a.loadAsync(t))})};return i.then(function(){return a(r.config.dependencies)}).then(function(){if(0===r.level){var t=r.readFile("main.ts");if(!t)return Promise.resolve(null);var n=r.getMissingPackages(r.config,t),i=!1;Promise.resolve();Object.keys(n).reduce(function(t,o){return t.then(function(){return r.findConflictsAsync(o,n[o])}).then(function(t){if(t.length){var s=t.map(function(e){return e.pkg0.id}).join(", "),c=t.map(function(e){return e.settingName}).filter(function(e){return!!e}).join(", ");return e.log("skipping missing package "+o+" because it conflicts with the following packages: "+s+" (conflicting settings: "+c+")"),Promise.resolve(null)}e.log("adding missing package "+o),i=!0,r.config.dependencies[o]="*";var l={};return l[o]=n[o],a(l)})},Promise.resolve(null)).then(function(){return i&&(r.saveConfig(),r.validateConfig()),Promise.resolve(null)})}return Promise.resolve(null)}).then(function(){return null})},n.prototype.getFiles=function(){return 0==this.level?this.config.files.concat(this.config.testFiles||[]):this.config.files.slice(0)},n.prototype.addSnapshot=function(t,n){void 0===n&&(n=[""]);for(var r=this,i=0,o=this.getFiles();i<o.length;i++)!function(i){n.some(function(t){return e.U.endsWith(i,t)})&&(t[r.id+"/"+i]=r.readFile(i))}(o[i]);t[this.id+"/"+e.CONFIG_NAME]=this.readFile(e.CONFIG_NAME)},n.prototype.packageLocalizationStringsAsync=function(t){var n=this,r=e.appTarget.id,i=[this.id+"-jsdoc",this.id],o={},a=e.appTarget.appTheme||{};if(e.Util.localizeLive&&"this"!=this.id&&e.appTarget.bundledpkgs[this.id]){e.log("loading live translations for "+this.id);var s=e.Util.userLanguage();return Promise.all(i.map(function(t){return e.Util.downloadLiveTranslationsAsync(s,r+"/"+t+"-strings.json",a.crowdinBranch).then(function(t){return e.Util.jsonMergeFrom(o,t)}).catch(function(n){return e.log("error while downloading "+r+"/"+t+"-strings.json")})})).then(function(){return o})}var c=this.config.files;return i.map(function(e){var r="_locales/"+t.toLowerCase()+"/"+e+"-strings.json";return c.indexOf(r)>-1?JSON.parse(n.readFile(r)):t.length>2&&(r="_locales/"+t.substring(0,2).toLowerCase()+"/"+e+"-strings.json",c.indexOf(r)>-1)?JSON.parse(n.readFile(r)):void 0}).filter(function(e){return!!e}).forEach(function(t){return e.Util.jsonMergeFrom(o,t)}),Promise.resolve(o)},n}();e.Package=n;var r=function(n){function r(e){n.call(this,"this","file:.",null,null),this._host=e,this.deps={},this.parent=this,this.addedBy=[this],this.level=0,this.deps[this.id]=this}return __extends(r,n),r.prototype.installAllAsync=function(){return this.loadAsync(!0)},r.prototype.sortedDeps=function(){var t=this,n={},r=[],i=function(o){if(o&&!e.U.lookup(n,o.id)&&(n[o.id]=!0,o.config&&o.config.dependencies)){var a=Object.keys(o.config.dependencies);a.sort(function(t,n){return e.U.strcmp(t,n)}),a.forEach(function(e){return i(t.resolveDep(e))}),r.push(o.id)}};return i(this),r.map(function(e){return t.resolveDep(e)})},r.prototype.localizationStringsAsync=function(t){var n={};return Promise.all(e.Util.values(this.deps).map(function(e){return e.packageLocalizationStringsAsync(t).then(function(e){if(e)for(var t in e)n[t]||(n[t]=e[t])})})).then(function(){return n})},r.prototype.getTargetOptions=function(){var t=e.U.clone(e.appTarget.compile);return e.U.assert(!!t),t},r.prototype.getJRes=function(){if(!this._jres){this._jres={};for(var e=0,t=this.sortedDeps();e<t.length;e++)t[e].parseJRes(this._jres)}return this._jres},r.prototype.getCompileOptionsAsync=function(n){var r=this;void 0===n&&(n=this.getTargetOptions());var i={sourceFiles:[],fileSystem:{},target:n,hexinfo:{hex:[]}},o=function(n,i){r.config.files.indexOf(n)<0&&e.U.userError(t("please add '{0}' to \"files\" in {1}",n,e.CONFIG_NAME)),i="// Auto-generated. Do not edit.\n"+i+"\n// Auto-generated. Do not edit. Really.\n",r.host().readFile(r,n)!==i&&(e.debug("updating "+n+" (size="+i.length+")..."),r.host().writeFile(r,n,i))},a=function(t,n){var i=r.upgradeAPI(n);return i!=n&&(e.debug("updating APIs in "+t+" (size="+n.length+")..."),r.host().writeFile(r,t,i,!0)),i};return this.loadAsync().then(function(){e.debug("building: "+r.sortedDeps().map(function(e){return e.config.name}).join(", "));var t=e.cpp.getExtensionInfo(r);return t.shimsDTS&&o("shims.d.ts",t.shimsDTS),t.enumsDTS&&o("enums.d.ts",t.enumsDTS),(n.isNative?r.host().getHexInfoAsync(t):Promise.resolve(null)).then(function(n){delete(t=e.U.flatClone(t)).compileData,delete t.generatedFiles,delete t.extensionFiles,i.extinfo=t,i.hexinfo=n})}).then(function(){return r.config.binaryonly||e.appTarget.compile.shortPointers||!i.target.isNative?null:r.filesToBePublishedAsync(!0)}).then(function(t){if(t){t=e.U.mapMap(t,a);var o=JSON.stringify({name:r.config.name,comment:r.config.description,status:"unpublished",scriptId:r.config.installedVersion,cloudId:e.CLOUD_ID+e.appTarget.id,editor:n.preferredEditor?n.preferredEditor:e.U.lookup(t,"main.blocks")?e.BLOCKS_PROJECT_NAME:e.JAVASCRIPT_PROJECT_NAME,targetVersions:e.appTarget.versions}),s=JSON.stringify(t);return e.lzmaCompressAsync(o+s).then(function(t){i.embedMeta=JSON.stringify({compression:"LZMA",headerSize:o.length,textSize:s.length,name:r.config.name,eURL:e.appTarget.appTheme.embedUrl,eVER:e.appTarget.versions?e.appTarget.versions.target:"",pxtTarget:e.appTarget.id}),i.embedBlob=btoa(e.U.uint8ArrayToString(t))})}return Promise.resolve()}).then(function(){for(var e=0,t=r.sortedDeps();e<t.length;e++)for(var n=t[e],o=0,a=n.getFiles();o<a.length;o++){var s=a[o];if(/\.(ts|asm)$/.test(s)){var c=s;n.level>0&&(c="pxt_modules/"+n.id+"/"+s),i.sourceFiles.push(c),i.fileSystem[c]=n.readFile(s)}}return i.jres=r.getJRes(),i})},r.prototype.filesToBePublishedAsync=function(t){var n=this;void 0===t&&(t=!1);var r={};return this.loadAsync().then(function(){t||n.config.public||e.U.userError('Only packages with "public":true can be published');var i=e.U.clone(n.config);delete i.installedVersion,delete i.additionalFilePath,e.U.iterMap(i.dependencies,function(e,t){(!t||/^file:/.test(t)||/^workspace:/.test(t))&&(i.dependencies[e]="*")}),r[e.CONFIG_NAME]=JSON.stringify(i,null,4);for(var o=0,a=n.getFiles();o<a.length;o++){var s=a[o],c=n.readFile(s);null==c&&e.U.userError("referenced file missing: "+s),r[s]=c}return e.U.sortObjectFields(r)})},r.prototype.compressToFileAsync=function(t){var n=this;return this.filesToBePublishedAsync(!0).then(function(r){var i={meta:{cloudId:e.CLOUD_ID+e.appTarget.id,targetVersions:e.appTarget.versions,editor:t||e.BLOCKS_PROJECT_NAME,name:n.config.name},source:JSON.stringify(r,null,2)};return e.lzmaCompressAsync(JSON.stringify(i,null,2))})},r.prototype.computePartDefinitions=function(t){if(!t||!t.length)return{};var n={};return this.sortedDeps().forEach(function(r){var i=r.readFile("pxtparts.json");if(i)try{var o=JSON.parse(i);for(var a in o)if(t.indexOf(a)>=0){var s=n[a]=o[a];if("string"==typeof s.visual.image&&/\.svg$/i.test(s.visual.image)){var c=r.readFile(s.visual.image);c||e.reportError("parts","invalid part definition",{error:"missing visual "+s.visual.image}),s.visual.image="data:image/svg+xml,"+encodeURIComponent(c)}}}catch(t){e.reportError("parts","invalid pxtparts.json file")}}),n},r}(n);e.MainPackage=r}(pxt||(pxt={}));var pxt;!function(e){!function(t){function n(t,n){if(t){if(n){var r=t.major-n.major||t.minor-n.minor||t.patch-n.patch;if(r)return r;if(0==t.pre.length&&n.pre.length>0)return 1;if(t.pre.length>0&&0==n.pre.length)return-1;for(var i=0;i<t.pre.length+1;++i){var o=t.pre[i],a=n.pre[i];if(!o)return a?-1:0;if(!a)return 1;if(/^\d+$/.test(o)){if(!/^\d+$/.test(a))return-1;if(r=parseInt(o)-parseInt(a))return r}else{if(/^\d+$/.test(a))return 1;if(r=e.U.strcmp(o,a))return r}}return 0}return-1}return n?1:0}function r(t){var n=i(t);return n||e.U.userError(e.U.lf("'{0}' doesn't look like a semantic version number",t)),n}function i(e){/^v\d/i.test(e)&&(e=e.slice(1));var t=/^(\d+)\.(\d+)\.(\d+)(-([0-9a-zA-Z\-\.]+))?(\+([0-9a-zA-Z\-\.]+))?$/.exec(e);return t?{major:parseInt(t[1]),minor:parseInt(t[2]),patch:parseInt(t[3]),pre:t[5]?t[5].split("."):[],build:t[7]?t[7].split("."):[]}:null}function o(e){var t=e.major+"."+e.minor+"."+e.patch;return e.pre.length&&(t+="-"+e.pre.join(".")),e.build.length&&(t+="+"+e.build.join(".")),t}t.cmp=n,t.parse=r,t.tryParse=i,t.stringify=o,t.majorCmp=function(e,t){var n=i(e),r=i(t);return n.major-r.major},t.strcmp=function(t,r){var o=i(t),a=i(r);return o||a?n(o,a):e.U.strcmp(t,r)},t.test=function(){console.log("Test semver");for(var t=["0.9.0","1.0.0-0.3.7","1.0.0-alpha","1.0.0-alpha.1","1.0.0-alpha.beta","1.0.0-beta","1.0.0-beta.2","1.0.0-beta.11","1.0.0-rc.1","1.0.0-x.7.z.92","1.0.0","1.0.1","1.9.0","1.10.0","1.11.0"],i=0;i<t.length;++i){var a=r(t[i]);console.log(t[i],a),e.U.assert(o(a)==t[i]);for(var s=0;s<t.length;++s){var c=n(a,r(t[s]));console.log(t[i],t[s],c),i<s?e.U.assert(c<0):i>s?e.U.assert(c>0):e.U.assert(0==c)}}}}(e.semver||(e.semver={}))}(pxt||(pxt={}));var ts;!function(e){!function(e){e.assert=e.Util.assert,e.oops=e.Util.oops,e.U=e.Util,e.ON_START_TYPE="pxt-on-start",e.ON_START_COMMENT=e.U.lf("on start"),e.HANDLER_COMMENT=e.U.lf("code goes here"),e.TS_STATEMENT_TYPE="typescript_statement",e.TS_OUTPUT_TYPE="typescript_expression",e.BINARY_JS="binary.js",e.BINARY_CS="binary.cs",e.BINARY_ASM="binary.asm",e.BINARY_HEX="binary.hex",e.BINARY_UF2="binary.uf2",e.BINARY_ELF="binary.elf",e.NATIVE_TYPE_THUMB="thumb",e.NATIVE_TYPE_AVR="AVR",e.NATIVE_TYPE_CS="C#",e.NATIVE_TYPE_AVRVM="AVRVM",function(e){e[e.None=0]="None",e[e.Method=1]="Method",e[e.Property=2]="Property",e[e.Function=3]="Function",e[e.Variable=4]="Variable",e[e.Module=5]="Module",e[e.Enum=6]="Enum",e[e.EnumMember=7]="EnumMember",e[e.Class=8]="Class",e[e.Interface=9]="Interface"}(e.SymbolKind||(e.SymbolKind={}));e.SymbolKind;e.computeUsedParts=function(e,t){if(void 0===t&&(t=!1),!e.usedSymbols||!pxt.appTarget.simulator||!pxt.appTarget.simulator.parts)return[];var n=[];for(var r in e.usedSymbols){var i=e.usedSymbols[r];if(i&&i.attributes.parts){var o=i.attributes.parts;o&&o.split(/[ ,]+/).forEach(function(e){0<e.length&&n.indexOf(e)<0&&n.push(e)})}}if(t){var a=pxt.appTarget.simulator.boardDefinition.onboardComponents;a&&(n=n.filter(function(e){return a.indexOf(e)<0}))}return n.sort(),n=n.reverse()},e.blocksCategory=function(t){var n=t?t.attributes.blockNamespace||t.namespace:void 0;return n?e.Util.capitalize(n.split(".")[0]):void 0},e.getBlocksInfo=function(t){var n=e.Util.values(t.byQName).filter(function(t){return!!t.attributes.block&&!!t.attributes.blockId&&t.kind!=e.SymbolKind.EnumMember});return{apis:t,blocks:n,blocksById:pxt.Util.toDictionary(n,function(e){return e.attributes.blockId})}},e.localizeApisAsync=function(t,n){var r=e.Util.userLanguage();return"en"==e.Util.userLanguage()?Promise.resolve(t):n.localizationStringsAsync(r).then(function(n){return e.Util.values(t.byQName).forEach(function(t){var r=n[t.qName];r&&(t.attributes.jsDoc=r,t.parameters&&t.parameters.forEach(function(e){return e.description=n[t.qName+"|param|"+e.name]||e.description}));var i=n["{id:category}"+e.Util.capitalize(t.qName)],o=n[t.qName+"|block"];if(i)t.attributes.block?t.attributes.block=o||t.attributes.block:t.attributes.block=i;else if(t.attributes.block&&o){var a=pxt.blocks.parameterNames(t).attrNames,s=t.attributes.block;if(t.attributes.block=pxt.blocks.normalizeBlock(o),s!=t.attributes.block){var c=pxt.blocks.parameterNames(t).attrNames;JSON.stringify(a)!=JSON.stringify(c)&&(pxt.log("block has non matching arguments: "+s+" vs "+t.attributes.block),t.attributes.block=s)}}})}).then(function(){return t})},e.emptyExtInfo=function(){var e=pxt.appTarget.compileService;e||(e={});var t=!!e.platformioIni,n="dockermake"==e.buildEngine,r={functions:[],generatedFiles:{},extensionFiles:{},sha:"",compileData:"",shimsDTS:"",enumsDTS:"",onlyPublic:!0};return t?r.platformio={dependencies:{}}:n?r.npmDependencies={}:r.yotta={config:{},dependencies:{}},r};var t=["weight","imageLiteral"],n=["advanced","handlerStatement","afterOnStart","optionalVariableArgs","blockHidden"];e.parseCommentString=function(r){for(var i={paramDefl:{},callingConvention:e.ir.CallingConvention.Plain,_source:r},o=!0;o;)o=!1,r=r.replace(/\/\/%[ \t]*([\w\.]+)(=(("[^"\n]*")|'([^'\n]*)'|([^\s]*)))?/,function(t,n,r,a,s,c,l){var u=s?JSON.parse(s):r?s||c||l:"true";if(u||(u=""),e.U.endsWith(n,".defl"))u.indexOf(" ")>-1?i.paramDefl[n.slice(0,n.length-5)]='"'+u+'"':i.paramDefl[n.slice(0,n.length-5)]=u;else if(e.U.endsWith(n,".fieldEditor"))i.paramFieldEditor||(i.paramFieldEditor={}),i.paramFieldEditor[n.slice(0,n.length-12)]=u;else if(e.U.contains(n,".fieldOptions.")){i.paramFieldEditorOptions||(i.paramFieldEditorOptions={});var f=n.slice(0,n.indexOf(".fieldOptions.")),p=n.slice(n.indexOf(".fieldOptions.")+14,n.length);i.paramFieldEditorOptions[f]||(i.paramFieldEditorOptions[f]={}),i.paramFieldEditorOptions[f][p]=u}else if(e.U.contains(n,".shadowOptions.")){i.paramShadowOptions||(i.paramShadowOptions={});var f=n.slice(0,n.indexOf(".shadowOptions.")),p=n.slice(n.indexOf(".shadowOptions.")+15,n.length);i.paramShadowOptions[f]||(i.paramShadowOptions[f]={}),i.paramShadowOptions[f][p]=u}else e.U.endsWith(n,".min")?(i.paramMin||(i.paramMin={}),i.paramMin[n.slice(0,n.length-4)]=u):e.U.endsWith(n,".max")?(i.paramMax||(i.paramMax={}),i.paramMax[n.slice(0,n.length-4)]=u):i[n]=u;return o=!0,"//% "});for(var a=0,s=t;a<s.length;a++)u=s[a],"string"==typeof i[u]&&(i[u]=parseInt(i[u]));for(var c=0,l=n;c<l.length;c++){var u=l[c];"string"==typeof i[u]&&(i[u]="true"==i[u]||"1"==i[u])}if(i.trackArgs&&(i.trackArgs=i.trackArgs.split(/[ ,]+/).map(function(e){return parseInt(e)||0})),i.blockExternalInputs&&!i.inlineInputMode&&(i.inlineInputMode="external"),i.paramHelp={},i.jsDoc="",r=r.replace(/\/\*\*([^]*?)\*\//g,function(e,t){return t=t.replace(/\n\s*(\*\s*)?/g,"\n"),t=t.replace(/^\s*@param\s+(\w+)\s+(.*)$/gm,function(e,t,n){if(i.paramHelp[t]=n,!i.paramDefl[t]){var r=/\beg\.?:\s*(.+)/.exec(n);if(r&&r[1]){var o=/(?:"([^"]*)")|(?:'([^']*)')|(?:([^\s,]+))/g.exec(r[1]);if(o){var a=o[1]||o[2]||o[3];a||(a=""),a.indexOf(" ")>-1?i.paramDefl[t]='"'+a+'"':i.paramDefl[t]=a}}}return""}),i.jsDoc+=t,""}),i.jsDoc=i.jsDoc.trim(),i.async&&(i.callingConvention=e.ir.CallingConvention.Async),i.promise&&(i.callingConvention=e.ir.CallingConvention.Promise),i.jres&&(i.whenUsed=!0),i.subcategories)try{i.subcategories=JSON.parse(i.subcategories)}catch(e){i.subcategories=void 0}if(i.groups)try{i.groups=JSON.parse(i.groups)}catch(e){i.groups=void 0}return i};!function(e){e.isSetupFor=function(t){return e.currentSetup==t.sha},e.currentSetup=null,e.parseChecksumBlock=function(e,t){void 0===t&&(t=0);var n=pxt.HF2.read32(e,t);if(133083260!=(2147483647&n))return pxt.log("no checksum block magic"),null;var r=pxt.HF2.read32(e,t+4),i=pxt.HF2.read32(e,t+8);if(3&r)return pxt.log("invalid end marker position"),null;var o=1<<(255&i);if(o!=pxt.appTarget.compile.flashCodeAlign)return pxt.log("invalid page size: "+o),null;for(var a={magic:n,endMarkerPos:r,endMarker:i,regions:[]},s=t+12;s<e.length-7;s+=8){var c={start:o*pxt.HF2.read16(e,s),length:o*pxt.HF2.read16(e,s+2),checksum:pxt.HF2.read32(e,s+4)};if(!c.length||!c.checksum)break;a.regions.push(c)}return a}}(e.hex||(e.hex={})),e.decodeBase64=function(e){return atob(e)};!function(t){function n(n){var r=function(e){return n[e]+(n[e+1]<<8)+(n[e+2]<<16)+(n[e+3]<<24)>>>0};if(!n||512!=n.length||r(0)!=t.UF2_MAGIC_START0||r(4)!=t.UF2_MAGIC_START1||r(n.length-4)!=t.UF2_MAGIC_END)return null;var i=r(8),o=r(16);o>476&&(o=256);var a=null;if(i&t.UF2_FLAG_FILE){var s=n.slice(32+o),c=s.indexOf(0);c>=0&&(s=s.slice(0,c)),a=e.U.fromUTF8(e.U.uint8ArrayToString(s))}return{flags:i,targetAddr:r(12),payloadSize:o,blockNo:r(20),numBlocks:r(24),fileSize:r(28),data:n.slice(32,32+o),filename:a}}function r(e,t){return!!e&&(e.targetAddr<=t&&t<e.targetAddr+e.payloadSize)}function i(e,t,n){e[t]=255&n,e[t+1]=n>>8&255,e[t+2]=n>>16&255,e[t+3]=n>>24&255}function o(){return{currBlock:null,currPtr:-1,blocks:[],ptrs:[],filesize:0}}function a(e){for(var t=0;t<e.blocks.length;++t)i(e.blocks[t],20,t),i(e.blocks[t],24,e.blocks.length),e.filename&&i(e.blocks[t],28,e.filesize)}function s(t,n,r){var i,o=n>>8;if(o==t.currPtr)i=t.currBlock;else{for(var a=0;a<t.ptrs.length;++a)if(t.ptrs[a]==o){i=t.blocks[a];break}i&&(t.currPtr=o,t.currBlock=i)}if(!i)return null;var c=new Uint8Array(r),l=Math.min(r,256-(255&n));e.U.memcpy(c,0,i,32+(255&n),l);var u=r-l;if(u>0){var f=s(t,n+l,u);e.U.memcpy(c,l,f)}return c}function c(n,r,o){var a=n.currBlock,s=r>>8,l=256-(255&r);if(o.length>l){var u=new Uint8Array(o);for(c(n,r,u.slice(0,l));l<o.length;){var f=Math.min(l+256,o.length);c(n,r+l,u.slice(l,f)),l=f}}else{if(s!=n.currPtr){d=0;a=null;for(var p=0;p<n.ptrs.length;++p)if(n.ptrs[p]==s){a=n.blocks[p];break}a||(i(a=new Uint8Array(512),0,t.UF2_MAGIC_START0),i(a,4,t.UF2_MAGIC_START1),i(a,8,n.filename?t.UF2_FLAG_FILE:t.UF2_FLAG_NONE),i(a,12,s<<8),i(a,16,256),i(a,20,n.blocks.length),i(a,508,t.UF2_MAGIC_END),n.filename&&e.U.memcpy(a,288,e.U.stringToUint8Array(e.U.toUTF8(n.filename))),n.blocks.push(a),n.ptrs.push(s)),n.currPtr=s,n.currBlock=a}for(var h=32+(255&r),d=0;d<o.length;++d)a[h+d]=o[d];n.filesize=Math.max(n.filesize,o.length+r)}}t.UF2_MAGIC_START0=171066965,t.UF2_MAGIC_START1=2656915799,t.UF2_MAGIC_END=179400496,t.UF2_FLAG_NONE=0,t.UF2_FLAG_NOFLASH=1,t.UF2_FLAG_FILE=4096,t.parseBlock=n,t.parseFile=function(e){for(var t=[],r=0;r<e.length;r+=512){var i=n(e.slice(r,r+512));i&&t.push(i)}return t},t.toBin=function(e){if(e.length<512)return null;for(var t=-1,r=-1,i=[],o=0;o<e.length;++o){var a=512*o,s=n(e.slice(a,a+512));if(s){-1==t&&(r=t=s.targetAddr);var c=s.targetAddr-t;c<0||c%4||c>1048576||(c>0&&i.push(new Uint8Array(c)),i.push(e.slice(a+32,a+32+s.payloadSize)),t=s.targetAddr+s.payloadSize)}}for(var l=0,u=0,f=i;u<f.length;u++)l+=(m=f[u]).length;if(0==l)return null;for(var p=new Uint8Array(l),h=0,d=0,g=i;d<g.length;d++)for(var m=g[d],o=0;o<m.length;++o)p[h++]=m[o];return{buf:p,start:r}},t.readBytes=function(e,t,n){for(var i,o=new Uint8Array(n),a=0;a<n;++a,++t)r(i,t)||(i=e.filter(function(e){return r(e,t)})[0]),i&&(o[a]=i.data[t-i.targetAddr]);return o},t.newBlockFile=o,t.finalizeFile=a,t.concatFiles=function(t){for(var n=0,r=t;n<r.length;n++)a(l=r[n]),l.filename=null;var i=o();i.blocks=e.U.concat(t.map(function(e){return e.blocks}));for(var s=0,c=t;s<c.length;s++){var l=c[s];l.blocks=[]}return i},t.serializeFile=function(t){a(t);for(var n="",r=0,i=t.blocks;r<i.length;r++){var o=i[r];n+=e.Util.uint8ArrayToString(o)}return n},t.readBytesFromFile=s,t.writeBytes=c,t.writeHex=function(e,t){for(var n="0000",r=0;r<t.length;++r){var i=/:02000004(....)/.exec(t[r]);if(i&&(n=i[1]),i=/^:..(....)00(.*)[0-9A-F][0-9A-F]$/.exec(t[r])){for(var o=parseInt(n+i[1],16),a=i[2],s=[],l=0;l<a.length;l+=2)s.push(parseInt(a[l]+a[l+1],16));c(e,o,s)}}}}(e.UF2||(e.UF2={}))}(e.pxtc||(e.pxtc={}))}(ts||(ts={}));var ts;!function(e){!function(e){!function(e){!function(e){e[e.Plain=0]="Plain",e[e.Async=1]="Async",e[e.Promise=2]="Promise"}(e.CallingConvention||(e.CallingConvention={}));e.CallingConvention}(e.ir||(e.ir={}))}(e.pxtc||(e.pxtc={}))}(ts||(ts={}));var pxt;!function(e){!function(t){t.createStreamAsync=function(t,n){return e.Cloud.privatePostAsync("streams",{target:t,name:n||"data"}).then(function(e){return e})},t.postPayloadAsync=function(t,n){return e.Util.assert(!!t.privatekey),e.Cloud.privatePostAsync(t.id+"/data?privatekey="+t.privatekey,n)}}(e.streams||(e.streams={}))}(pxt||(pxt={}));var ts;!function(e){!function(t){function n(e,t){return t>=o.ES5?i(e,a):i(e,c)}function r(e,t){return t>=o.ES5?i(e,s):i(e,l)}function i(e,t){if(e<t[0])return!1;for(var n,r=0,i=t.length;r+1<i;){if(n=r+(i-r)/2,n-=n%2,t[n]<=e&&e<=t[n+1])return!0;e<t[n]?i=n:r=n+2}return!1}t.flattenDiagnosticMessageText=function(e,t){if("string"==typeof e)return e;for(var n=e,r="",i=0;n;){if(i){r+=t;for(var o=0;o<i;o++)r+="  "}r+=n.messageText,i++,n=n.next}return r},function(e){e[e.ES3=0]="ES3",e[e.ES5=1]="ES5",e[e.ES6=2]="ES6",e[e.ES2015=2]="ES2015",e[e.Latest=2]="Latest"}(t.ScriptTarget||(t.ScriptTarget={}));var o=t.ScriptTarget;t.isIdentifierStart=function(e,t){return e>=65&&e<=90||e>=97&&e<=122||36===e||95===e||e>127&&n(e,t)},t.isIdentifierPart=function(e,t){return e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||36===e||95===e||e>127&&r(e,t)},t.reservedWords=["abstract","any","as","break","case","catch","class","continue","const","constructor","debugger","declare","default","delete","do","else","enum","export","extends","false","finally","for","from","function","get","if","implements","import","in","instanceof","interface","is","let","module","namespace","new","null","package","private","protected","public","require","global","return","set","static","super","switch","symbol","this","throw","true","try","type","typeof","var","void","while","with","yield","async","await","of","Math"],t.escapeIdentifier=function(n){if(!n)return"_";var r=n.replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_$]/g,function(t){return e.pxtc.isIdentifierPart(t.charCodeAt(0),e.pxtc.ScriptTarget.ES5)?t:""});return r&&e.pxtc.isIdentifierStart(r.charCodeAt(0),e.pxtc.ScriptTarget.ES5)&&-1===t.reservedWords.indexOf(r)||(r="_"+r),r};var a=[170,170,181,181,186,186,192,214,216,246,248,705,710,721,736,740,748,748,750,750,880,884,886,887,890,893,902,902,904,906,908,908,910,929,931,1013,1015,1153,1162,1319,1329,1366,1369,1369,1377,1415,1488,1514,1520,1522,1568,1610,1646,1647,1649,1747,1749,1749,1765,1766,1774,1775,1786,1788,1791,1791,1808,1808,1810,1839,1869,1957,1969,1969,1994,2026,2036,2037,2042,2042,2048,2069,2074,2074,2084,2084,2088,2088,2112,2136,2208,2208,2210,2220,2308,2361,2365,2365,2384,2384,2392,2401,2417,2423,2425,2431,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2493,2493,2510,2510,2524,2525,2527,2529,2544,2545,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2649,2652,2654,2654,2674,2676,2693,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2749,2749,2768,2768,2784,2785,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2869,2873,2877,2877,2908,2909,2911,2913,2929,2929,2947,2947,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,3001,3024,3024,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3133,3133,3160,3161,3168,3169,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3261,3261,3294,3294,3296,3297,3313,3314,3333,3340,3342,3344,3346,3386,3389,3389,3406,3406,3424,3425,3450,3455,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3585,3632,3634,3635,3648,3654,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3760,3762,3763,3773,3773,3776,3780,3782,3782,3804,3807,3840,3840,3904,3911,3913,3948,3976,3980,4096,4138,4159,4159,4176,4181,4186,4189,4193,4193,4197,4198,4206,4208,4213,4225,4238,4238,4256,4293,4295,4295,4301,4301,4304,4346,4348,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4744,4746,4749,4752,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4822,4824,4880,4882,4885,4888,4954,4992,5007,5024,5108,5121,5740,5743,5759,5761,5786,5792,5866,5870,5872,5888,5900,5902,5905,5920,5937,5952,5969,5984,5996,5998,6e3,6016,6067,6103,6103,6108,6108,6176,6263,6272,6312,6314,6314,6320,6389,6400,6428,6480,6509,6512,6516,6528,6571,6593,6599,6656,6678,6688,6740,6823,6823,6917,6963,6981,6987,7043,7072,7086,7087,7098,7141,7168,7203,7245,7247,7258,7293,7401,7404,7406,7409,7413,7414,7424,7615,7680,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8305,8305,8319,8319,8336,8348,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8505,8508,8511,8517,8521,8526,8526,8544,8584,11264,11310,11312,11358,11360,11492,11499,11502,11506,11507,11520,11557,11559,11559,11565,11565,11568,11623,11631,11631,11648,11670,11680,11686,11688,11694,11696,11702,11704,11710,11712,11718,11720,11726,11728,11734,11736,11742,11823,11823,12293,12295,12321,12329,12337,12341,12344,12348,12353,12438,12445,12447,12449,12538,12540,12543,12549,12589,12593,12686,12704,12730,12784,12799,13312,19893,19968,40908,40960,42124,42192,42237,42240,42508,42512,42527,42538,42539,42560,42606,42623,42647,42656,42735,42775,42783,42786,42888,42891,42894,42896,42899,42912,42922,43e3,43009,43011,43013,43015,43018,43020,43042,43072,43123,43138,43187,43250,43255,43259,43259,43274,43301,43312,43334,43360,43388,43396,43442,43471,43471,43520,43560,43584,43586,43588,43595,43616,43638,43642,43642,43648,43695,43697,43697,43701,43702,43705,43709,43712,43712,43714,43714,43739,43741,43744,43754,43762,43764,43777,43782,43785,43790,43793,43798,43808,43814,43816,43822,43968,44002,44032,55203,55216,55238,55243,55291,63744,64109,64112,64217,64256,64262,64275,64279,64285,64285,64287,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65136,65140,65142,65276,65313,65338,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500],s=[170,170,181,181,186,186,192,214,216,246,248,705,710,721,736,740,748,748,750,750,768,884,886,887,890,893,902,902,904,906,908,908,910,929,931,1013,1015,1153,1155,1159,1162,1319,1329,1366,1369,1369,1377,1415,1425,1469,1471,1471,1473,1474,1476,1477,1479,1479,1488,1514,1520,1522,1552,1562,1568,1641,1646,1747,1749,1756,1759,1768,1770,1788,1791,1791,1808,1866,1869,1969,1984,2037,2042,2042,2048,2093,2112,2139,2208,2208,2210,2220,2276,2302,2304,2403,2406,2415,2417,2423,2425,2431,2433,2435,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2492,2500,2503,2504,2507,2510,2519,2519,2524,2525,2527,2531,2534,2545,2561,2563,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2620,2620,2622,2626,2631,2632,2635,2637,2641,2641,2649,2652,2654,2654,2662,2677,2689,2691,2693,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2748,2757,2759,2761,2763,2765,2768,2768,2784,2787,2790,2799,2817,2819,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2869,2873,2876,2884,2887,2888,2891,2893,2902,2903,2908,2909,2911,2915,2918,2927,2929,2929,2946,2947,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,3001,3006,3010,3014,3016,3018,3021,3024,3024,3031,3031,3046,3055,3073,3075,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3133,3140,3142,3144,3146,3149,3157,3158,3160,3161,3168,3171,3174,3183,3202,3203,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3260,3268,3270,3272,3274,3277,3285,3286,3294,3294,3296,3299,3302,3311,3313,3314,3330,3331,3333,3340,3342,3344,3346,3386,3389,3396,3398,3400,3402,3406,3415,3415,3424,3427,3430,3439,3450,3455,3458,3459,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3530,3530,3535,3540,3542,3542,3544,3551,3570,3571,3585,3642,3648,3662,3664,3673,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3769,3771,3773,3776,3780,3782,3782,3784,3789,3792,3801,3804,3807,3840,3840,3864,3865,3872,3881,3893,3893,3895,3895,3897,3897,3902,3911,3913,3948,3953,3972,3974,3991,3993,4028,4038,4038,4096,4169,4176,4253,4256,4293,4295,4295,4301,4301,4304,4346,4348,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4744,4746,4749,4752,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4822,4824,4880,4882,4885,4888,4954,4957,4959,4992,5007,5024,5108,5121,5740,5743,5759,5761,5786,5792,5866,5870,5872,5888,5900,5902,5908,5920,5940,5952,5971,5984,5996,5998,6e3,6002,6003,6016,6099,6103,6103,6108,6109,6112,6121,6155,6157,6160,6169,6176,6263,6272,6314,6320,6389,6400,6428,6432,6443,6448,6459,6470,6509,6512,6516,6528,6571,6576,6601,6608,6617,6656,6683,6688,6750,6752,6780,6783,6793,6800,6809,6823,6823,6912,6987,6992,7001,7019,7027,7040,7155,7168,7223,7232,7241,7245,7293,7376,7378,7380,7414,7424,7654,7676,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8204,8205,8255,8256,8276,8276,8305,8305,8319,8319,8336,8348,8400,8412,8417,8417,8421,8432,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8505,8508,8511,8517,8521,8526,8526,8544,8584,11264,11310,11312,11358,11360,11492,11499,11507,11520,11557,11559,11559,11565,11565,11568,11623,11631,11631,11647,11670,11680,11686,11688,11694,11696,11702,11704,11710,11712,11718,11720,11726,11728,11734,11736,11742,11744,11775,11823,11823,12293,12295,12321,12335,12337,12341,12344,12348,12353,12438,12441,12442,12445,12447,12449,12538,12540,12543,12549,12589,12593,12686,12704,12730,12784,12799,13312,19893,19968,40908,40960,42124,42192,42237,42240,42508,42512,42539,42560,42607,42612,42621,42623,42647,42655,42737,42775,42783,42786,42888,42891,42894,42896,42899,42912,42922,43e3,43047,43072,43123,43136,43204,43216,43225,43232,43255,43259,43259,43264,43309,43312,43347,43360,43388,43392,43456,43471,43481,43520,43574,43584,43597,43600,43609,43616,43638,43642,43643,43648,43714,43739,43741,43744,43759,43762,43766,43777,43782,43785,43790,43793,43798,43808,43814,43816,43822,43968,44010,44012,44013,44016,44025,44032,55203,55216,55238,55243,55291,63744,64109,64112,64217,64256,64262,64275,64279,64285,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65024,65039,65056,65062,65075,65076,65101,65103,65136,65140,65142,65276,65296,65305,65313,65338,65343,65343,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500],c=[170,170,181,181,186,186,192,214,216,246,248,543,546,563,592,685,688,696,699,705,720,721,736,740,750,750,890,890,902,902,904,906,908,908,910,929,931,974,976,983,986,1011,1024,1153,1164,1220,1223,1224,1227,1228,1232,1269,1272,1273,1329,1366,1369,1369,1377,1415,1488,1514,1520,1522,1569,1594,1600,1610,1649,1747,1749,1749,1765,1766,1786,1788,1808,1808,1810,1836,1920,1957,2309,2361,2365,2365,2384,2384,2392,2401,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2524,2525,2527,2529,2544,2545,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2649,2652,2654,2654,2674,2676,2693,2699,2701,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2749,2749,2768,2768,2784,2784,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2870,2873,2877,2877,2908,2909,2911,2913,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,2997,2999,3001,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3168,3169,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3294,3294,3296,3297,3333,3340,3342,3344,3346,3368,3370,3385,3424,3425,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3585,3632,3634,3635,3648,3654,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3760,3762,3763,3773,3773,3776,3780,3782,3782,3804,3805,3840,3840,3904,3911,3913,3946,3976,3979,4096,4129,4131,4135,4137,4138,4176,4181,4256,4293,4304,4342,4352,4441,4447,4514,4520,4601,4608,4614,4616,4678,4680,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4742,4744,4744,4746,4749,4752,4782,4784,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4814,4816,4822,4824,4846,4848,4878,4880,4880,4882,4885,4888,4894,4896,4934,4936,4954,5024,5108,5121,5740,5743,5750,5761,5786,5792,5866,6016,6067,6176,6263,6272,6312,7680,7835,7840,7929,7936,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8319,8319,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8497,8499,8505,8544,8579,12293,12295,12321,12329,12337,12341,12344,12346,12353,12436,12445,12446,12449,12538,12540,12542,12549,12588,12593,12686,12704,12727,13312,19893,19968,40869,40960,42124,44032,55203,63744,64045,64256,64262,64275,64279,64285,64285,64287,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65136,65138,65140,65140,65142,65276,65313,65338,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500],l=[170,170,181,181,186,186,192,214,216,246,248,543,546,563,592,685,688,696,699,705,720,721,736,740,750,750,768,846,864,866,890,890,902,902,904,906,908,908,910,929,931,974,976,983,986,1011,1024,1153,1155,1158,1164,1220,1223,1224,1227,1228,1232,1269,1272,1273,1329,1366,1369,1369,1377,1415,1425,1441,1443,1465,1467,1469,1471,1471,1473,1474,1476,1476,1488,1514,1520,1522,1569,1594,1600,1621,1632,1641,1648,1747,1749,1756,1759,1768,1770,1773,1776,1788,1808,1836,1840,1866,1920,1968,2305,2307,2309,2361,2364,2381,2384,2388,2392,2403,2406,2415,2433,2435,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2492,2492,2494,2500,2503,2504,2507,2509,2519,2519,2524,2525,2527,2531,2534,2545,2562,2562,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2620,2620,2622,2626,2631,2632,2635,2637,2649,2652,2654,2654,2662,2676,2689,2691,2693,2699,2701,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2748,2757,2759,2761,2763,2765,2768,2768,2784,2784,2790,2799,2817,2819,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2870,2873,2876,2883,2887,2888,2891,2893,2902,2903,2908,2909,2911,2913,2918,2927,2946,2947,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,2997,2999,3001,3006,3010,3014,3016,3018,3021,3031,3031,3047,3055,3073,3075,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3134,3140,3142,3144,3146,3149,3157,3158,3168,3169,3174,3183,3202,3203,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3262,3268,3270,3272,3274,3277,3285,3286,3294,3294,3296,3297,3302,3311,3330,3331,3333,3340,3342,3344,3346,3368,3370,3385,3390,3395,3398,3400,3402,3405,3415,3415,3424,3425,3430,3439,3458,3459,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3530,3530,3535,3540,3542,3542,3544,3551,3570,3571,3585,3642,3648,3662,3664,3673,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3769,3771,3773,3776,3780,3782,3782,3784,3789,3792,3801,3804,3805,3840,3840,3864,3865,3872,3881,3893,3893,3895,3895,3897,3897,3902,3911,3913,3946,3953,3972,3974,3979,3984,3991,3993,4028,4038,4038,4096,4129,4131,4135,4137,4138,4140,4146,4150,4153,4160,4169,4176,4185,4256,4293,4304,4342,4352,4441,4447,4514,4520,4601,4608,4614,4616,4678,4680,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4742,4744,4744,4746,4749,4752,4782,4784,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4814,4816,4822,4824,4846,4848,4878,4880,4880,4882,4885,4888,4894,4896,4934,4936,4954,4969,4977,5024,5108,5121,5740,5743,5750,5761,5786,5792,5866,6016,6099,6112,6121,6160,6169,6176,6263,6272,6313,7680,7835,7840,7929,7936,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8255,8256,8319,8319,8400,8412,8417,8417,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8497,8499,8505,8544,8579,12293,12295,12321,12335,12337,12341,12344,12346,12353,12436,12441,12442,12445,12446,12449,12542,12549,12588,12593,12686,12704,12727,13312,19893,19968,40869,40960,42124,44032,55203,63744,64045,64256,64262,64275,64279,64285,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65056,65059,65075,65076,65101,65103,65136,65138,65140,65140,65142,65276,65296,65305,65313,65338,65343,65343,65345,65370,65381,65470,65474,65479,65482,65487,65490,65495,65498,65500];t.isUnicodeIdentifierStart=n,function(e){e[e.Warning=0]="Warning",e[e.Error=1]="Error",e[e.Message=2]="Message"}(t.DiagnosticCategory||(t.DiagnosticCategory={}));t.DiagnosticCategory}(e.pxtc||(e.pxtc={}))}(ts||(ts={}));var pxt;!function(e){!function(t){function n(){return navigator.usb.requestDevice({filters:[]})}function r(){return n().then(function(e){var t=new s(e);return t.initAsync().then(function(){return t})})}function i(){return r().then(function(t){var n=new e.HF2.Wrapper(t);return n.reconnectAsync(!0).then(function(){return n})})}var o=function(e){function t(t){e.call(this,t),this.message=t}return __extends(t,e),t}(Error);t.USBError=o;var a,s=function(){function t(e){this.dev=e,this.ready=!1,this.onData=function(e){},this.onError=function(e){},this.onEvent=function(e){},this.readLoop()}return t.prototype.error=function(t){throw new o(e.U.lf("USB error on device {0} ({1})",this.dev.productName,t))},t.prototype.disconnectAsync=function(){var e=this;return this.dev?(this.ready=!1,this.dev.close().then(function(){return e.dev=null,Promise.delay(500)})):Promise.resolve()},t.prototype.reconnectAsync=function(){var e=this;return this.disconnectAsync().then(n).then(function(t){return e.dev=t,e.initAsync()})},t.prototype.sendPacketAsync=function(t){var n=this;return e.Util.assert(t.length<=64),this.dev.transferOut(this.epOut.endpointNumber,t).then(function(e){"ok"!=e.status&&n.error("USB OUT transfer failed")})},t.prototype.readLoop=function(){var e=this,t=function(){e.ready?e.recvPacketAsync().then(function(n){e.onData(n),t()},function(n){e.onError(n),Promise.delay(300).then(t)}):Promise.delay(300).then(t)};t()},t.prototype.recvPacketAsync=function(){var e=this;return this.dev.transferIn(this.epIn.endpointNumber,64).then(function(t){"ok"!=t.status&&e.error("USB IN transfer failed");var n=new Uint8Array(t.data.buffer);return 0==n.length?e.recvPacketAsync():n})},t.prototype.initAsync=function(){var t=this,n=this.dev;return n.open().then(function(){return n.selectConfiguration(1)}).then(function(){var r=n.configurations[0].interfaces.filter(function(e){return 255==e.alternates[0].interfaceClass&&42==e.alternates[0].interfaceSubclass})[0];return r||t.error("cannot find USB HID interface"),t.altIface=r.alternates[0],t.epIn=t.altIface.endpoints.filter(function(e){return"in"==e.direction})[0],t.epOut=t.altIface.endpoints.filter(function(e){return"out"==e.direction})[0],e.Util.assert(64==t.epIn.packetSize),e.Util.assert(64==t.epOut.packetSize),n.claimInterface(r.interfaceNumber)}).then(function(){t.ready=!0})},t}();t.initAsync=function(){return a||(a=i()),a}}(e.usb||(e.usb={}))}(pxt||(pxt={}));var pxt;!function(e){!function(t){function n(e){var t={},n=0,r=new i.PromiseQueue,o=new Promise(function(e,n){t.ready=e});r.enqueue("main",function(){return o});return{opAsync:function(i,o){return r.enqueue("main",function(){return new Promise(function(r,a){var s=""+n++;t[s]=function(e){e?e.errorMessage?a(new Error(e.errorMessage)):r(e):a(new Error("no response"))},e({id:s,op:i,arg:o})})})},recvHandler:function(e){if(t.hasOwnProperty(e.id)){var n=t[e.id];delete t[e.id],n(e.result)}}}}function r(e){var t=new Worker(e),r=n(function(e){return t.postMessage(e)});return t.onmessage=function(e){r.recvHandler(e.data)},r}var i=e.Util,o={};t.getWorker=function(e){var t=o[e];return t||(t=o[e]=r(e)),t},t.wrap=n,t.makeWebWorker=r,t.makeWebSocket=function(t,r){void 0===r&&(r=null);var i=new WebSocket(t),o=[],a=n(function(e){var t=JSON.stringify(e);o?o.push(t):i.send(t)});return i.onmessage=function(e){var t=JSON.parse(e.data);r&&null==t.id?r(t):a.recvHandler(t)},i.onopen=function(t){e.debug("socket opened");for(var n=0,r=o;n<r.length;n++){var a=r[n];i.send(a)}o=null},i.onclose=function(t){e.debug("socket closed")},a}}(e.worker||(e.worker={}))}(pxt||(pxt={}));var ts;!function(e){!function(e){!function(t){function n(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return e.replace(/{(\d+)}/g,function(e,n){return t[+n]})}function r(e){var t=[],n="";e:for(var r=0;r<e.length;++r)switch(e[r]){case"[":case"]":case"!":case"{":case"}":case",":n&&(t.push(n),n=""),t.push(e[r]);break;case" ":case"\t":case"\r":case"\n":n&&(t.push(n),n="");break;case";":break e;default:n+=e[r]}return n&&(t.push(n),n=""),t[0]?t:null}function i(e){e=e.replace(/\\\\/g,"\\B").replace(/\\(['\?])/g,function(e,t){return t}).replace(/\\[z0]/g,"\0").replace(/\\x([0-9a-f][0-9a-f])/gi,function(e,t){return"\\u00"+t}).replace(/\\B/g,"\\\\");try{return JSON.parse(e)}catch(e){return null}}function o(e,t){return{stack:null,opcode:null,error:e,errorAt:t}}function a(e){return e<0||e>65535?("0x"+e.toString(16)).toLowerCase():("0x"+("000"+e.toString(16)).slice(-4)).toLowerCase()}t.lf=n;var s=o("opcode name doesn't match","<name>"),c=function(){function t(t,n,i,o,a){var s=this;this.opcode=i,this.mask=o,this.is32bit=a,this.canBeShared=!1,e.assert((i&o)==i),this.ei=t,this.code=n.replace(/\s+/g," "),this.friendlyFmt=n.replace(/\$\w+/g,function(e){return s.ei.encoders[e]?s.ei.encoders[e].pretty:e});var c=r(n);this.name=c[0],this.args=c.slice(1)}return t.prototype.emit=function(t){var n=t.words;if(n[0]!=this.name)return s;for(var r=this.opcode,i=1,a=0,c=[],l=null,u=null,f=null,p=0;p<this.args.length;++p){var h=this.args[p],d=n[i++];if("$"==h[0]){var g=this.ei.encoders[h],m=null;if(g.isRegister){if(null==(m=this.ei.registerNo(d)))return o("expecting register name",d);this.ei.isPush(this.opcode)?a++:this.ei.isPop(this.opcode)&&a--}else if(g.isImmediate){if(d=d.replace(/^#/,""),null==(m=t.bin.parseOneInt(d)))return o("expecting number",d);this.ei.isAddSP(this.opcode)?a=-m/this.ei.wordSize():this.ei.isSubSP(this.opcode)&&(a=m/this.ei.wordSize())}else if(g.isRegList){if("{"!=d)return o("expecting {",d);for(m=0;"}"!=n[i];){if(!(d=n[i++]))return o("expecting }",n[i-2]);var v=this.ei.registerNo(d);if(null==v)return o("expecting register name",d);if(m&1<<v)return o("duplicate register name",d);m|=1<<v,this.ei.isPush(this.opcode)?a++:this.ei.isPop(this.opcode)&&a--,","==n[i]&&i++}d=n[i++]}else if(g.isLabel){if(d=d.replace(/^#/,""),/^[+-]?\d+$/.test(d))l="rel"+(m=parseInt(d,10));else if(/^0x[0-9a-fA-F]+$/.test(d))l="abs"+(m=parseInt(d,16));else if(l=d,null==(m=this.ei.getAddressFromLabel(t.bin,this,d,g.isWordAligned))){if(t.bin.finalEmit)return o("unknown label",d);m=8}if(this.ei.is32bit(this)){u=m,f=d;continue}}else e.oops();if(null==m)return o("didn't understand it",d);if(c.push(m),null==(m=g.encode(m)))return o("argument out of range or mis-aligned",d);e.assert(0==(r&m)),r|=m}else if(h!=d)return o("expecting "+h,d)}return n[i]?o("trailing tokens",n[i]):this.ei.is32bit(this)?this.ei.emit32(r,u,t.bin.normalizeExternalLabel(f)):{stack:a,opcode:r,numArgs:c,labelName:t.bin.normalizeExternalLabel(l)}},t.prototype.toString=function(){return this.friendlyFmt},t}();t.Instruction=c;var l=function(){function e(e,t){this.bin=e,this.text=t}return e.prototype.getOpExt=function(){return this.instruction?this.instruction.code:""},e.prototype.getOp=function(){return this.instruction?this.instruction.name:""},e.prototype.update=function(e){this.bin.peepOps++,(e=e.replace(/^\s*/,""))||this.bin.peepDel++,e&&(e+="      "),e="    "+e,this.text=e+"; WAS: "+this.text.trim(),this.instruction=null,this.numArgs=null,this.words=r(e)||[],0==this.words.length?this.type="empty":"@"==this.words[0][0]&&(this.type="directive")},e}();t.Line=l;var u=function(){function t(e){this.baseOffset=0,this.checkStack=!0,this.inlineMode=!1,this.normalizeExternalLabel=function(e){return e},this.currLineNo=0,this.scope="",this.scopeId=0,this.errors=[],this.labels={},this.stackpointers={},this.stack=0,this.peepOps=0,this.peepDel=0,this.peepCounts={},this.stats="",this.throwOnError=!1,this.disablePeepHole=!1,this.stackAtLabel={},this.currLine=new l(this,"<start>"),this.currLine.lineNo=0,this.ei=e,this.ei.file=this}return t.prototype.emitShort=function(t){e.assert(0<=t&&t<=65535),this.buf.push(t)},t.prototype.emitOpCode=function(e){this.emitShort(e)},t.prototype.location=function(){return 2*this.buf.length},t.prototype.pc=function(){return this.location()+this.baseOffset},t.prototype.parseOneInt=function(t){if(!t)return null;if("0"==t)return 0;var r=1;if(t.indexOf("*")>=0)for(var i=null;i=/^([^\*]*)\*(.*)$/.exec(t);){var o=this.parseOneInt(i[1]);if(null==o)return null;r*=o,t=i[2]}"-"==t[0]?(r*=-1,t=t.slice(1)):"+"==t[0]&&(t=t.slice(1));var a=null;if(e.U.endsWith(t,"|1"))return 1|this.parseOneInt(t.slice(0,t.length-2));if(e.U.endsWith(t,"-1"))return this.parseOneInt(t.slice(0,t.length-2))-1;if(e.U.endsWith(t,"+1"))return this.parseOneInt(t.slice(0,t.length-2))+1;if("0"==t[0])if("x"==t[1]||"X"==t[1]){var s=/^0x([a-f0-9]+)$/i.exec(t);s&&(a=parseInt(s[1],16))}else if("b"==t[1]||"B"==t[1]){var c=/^0b([01]+)$/i.exec(t);c&&(a=parseInt(c[1],2))}var l=/^(\d+)$/i.exec(t);return l&&(a=parseInt(l[1],10)),t.indexOf("@")>=0&&((l=/^(\w+)@(-?\d+)$/.exec(t))&&(1!=r&&this.directiveError(n("multiplication not supported with saved stacks")),this.stackpointers.hasOwnProperty(l[1])?a=this.ei.wordSize()*this.ei.computeStackOffset(l[1],this.stack-this.stackpointers[l[1]]+parseInt(l[2])):this.directiveError(n("saved stack not found"))),(l=/^(.*)@(hi|lo|fn)$/.exec(t))&&this.looksLikeLabel(l[1])&&null!=(a=this.lookupLabel(l[1],!0))&&("fn"==l[2]?a=this.ei.toFnPtr(a,this.baseOffset):0<=(a>>=1)&&a<=65535?"hi"==l[2]?a=a>>8&255:"lo"==l[2]?a&=255:e.oops():(this.directiveError(n("@hi/lo out of range")),a=null))),null==a&&this.looksLikeLabel(t)&&null!=(a=this.lookupLabel(t,!0))&&1==this.ei.postProcessRelAddress(this,1)&&(a+=this.baseOffset),null==a||isNaN(a)?null:a*r},t.prototype.looksLikeLabel=function(e){return!/^(r\d|pc|sp|lr)$/i.test(e)&&/^[\.a-zA-Z_][\.:\w+]*$/.test(e)},t.prototype.scopedName=function(e){return"."==e[0]&&this.scope?this.scope+"$"+e:e},t.prototype.lookupLabel=function(e,t){void 0===t&&(t=!1);var r=null,i=this.scopedName(e);return this.labels.hasOwnProperty(i)?(r=this.labels[i],r=this.ei.postProcessRelAddress(this,r)):this.lookupExternalLabel&&null!=(r=this.lookupExternalLabel(e))&&(r=this.ei.postProcessAbsAddress(this,r)),null==r&&t&&(this.finalEmit?this.directiveError(n("unknown label: {0}",e)):r=33333),r},t.prototype.align=function(t){for(e.assert(2==t||4==t||8==t||16==t);this.location()%t!=0;)this.emitOpCode(0)},t.prototype.pushError=function(e,t){void 0===t&&(t="");var r={scope:this.scope,message:n("  -> Line {2} ('{1}'), error: {0}\n{3}",e,this.currLine.text,this.currLine.lineNo,t),lineNo:this.currLine.lineNo,line:this.currLine.text,coremsg:e,hints:t};if(this.errors.push(r),this.throwOnError)throw new Error(r.message)},t.prototype.directiveError=function(e){this.pushError(e)},t.prototype.emitString=function(e){function t(e,t){return 255&(e.charCodeAt(t)||0)}var r,o=/^\s*([\w\.]+\s*:\s*)?.\w+\s+(".*")\s*$/.exec(e);if(o&&null!=(r=i(o[2]))){this.align(2);for(var a=0;a<r.length+1;a+=2)this.emitShort(t(r,a+1)<<8|t(r,a))}else this.directiveError(n("expecting string"))},t.prototype.parseNumber=function(e){var t=this.parseOneInt(e.shift());return null==t?null:t},t.prototype.parseNumbers=function(e){e=e.slice(1);for(var t=[];;){var r=this.parseNumber(e);if(null==r){this.directiveError(n("cannot parse number at '{0}'",e[0]));break}if(t.push(r),","!=e[0]){if(null==e[0])break;this.directiveError(n("expecting number, got '{0}'",e[0]));break}if(e.shift(),null==e[0])break}return t},t.prototype.emitSpace=function(e){var t=this.parseNumbers(e);if(1==t.length&&t.push(0),2!=t.length)this.directiveError(n("expecting one or two numbers"));else if(t[0]%2!=0)this.directiveError(n("only even space supported"));else{var r=255&t[1];r|=r<<8;for(var i=0;i<t[0];i+=2)this.emitShort(r)}},t.prototype.emitBytes=function(e){var t=this.parseNumbers(e);t.length%2!=0&&(this.directiveError(".bytes needs an even number of arguments"),t.push(0));for(var r=0;r<t.length;r+=2){var i=t[r],o=t[r+1];0<=i&&o<=255&&0<=o&&i<=255?this.emitShort(255&i|(255&o)<<8):this.directiveError(n("expecting uint8"))}},t.prototype.emitHex=function(e){var t=this;e.slice(1).forEach(function(e){if(","!=e)if(e.length%4!=0)t.directiveError(".hex needs an even number of bytes");else if(/^[a-f0-9]+$/i.test(e))for(var n=0;n<e.length;n+=4){var r=parseInt(e.slice(n,n+4),16);r=(255&r)<<8|r>>8&255,t.emitShort(r)}else t.directiveError(".hex needs a hex number")})},t.prototype.handleDirective=function(e){var t,r=this,i=e.words,o=function(){2!=i.length&&r.directiveError(n("expecting one argument"))};switch(i[0]){case".ascii":case".asciz":case".string":this.emitString(e.text);break;case".align":if(o(),null!=(t=this.parseOneInt(i[1]))){if(0==t)return;t<=4?this.align(1<<t):this.directiveError(n("expecting 1, 2, 3 or 4 (for 2, 4, 8, or 16 byte alignment)"))}else this.directiveError(n("expecting number"));break;case".balign":if(o(),null!=(t=this.parseOneInt(i[1]))){if(1==t)return;2==t||4==t||8==t||16==t?this.align(t):this.directiveError(n("expecting 2, 4, 8, or 16"))}else this.directiveError(n("expecting number"));break;case".byte":this.emitBytes(i);break;case".hex":this.emitHex(i);break;case".hword":case".short":case".2bytes":this.parseNumbers(i).forEach(function(e){-32768<=e&&e<=65535?r.emitShort(65535&e):r.directiveError(n("expecting int16"))});break;case".word":case".4bytes":this.parseNumbers(i).forEach(function(e){-2147483648<=e&&e<=4294967295?(r.emitShort(65535&e),r.emitShort(e>>16&65535)):r.directiveError(n("expecting int32"))});break;case".skip":case".space":this.emitSpace(i);break;case".startaddr":this.location()&&this.directiveError(n(".startaddr can be only be specified at the beginning of the file")),o(),this.baseOffset=this.parseOneInt(i[1]);break;case"@stackmark":o(),this.stackpointers[i[1]]=this.stack;break;case"@stackempty":null==this.stackpointers[i[1]]?this.directiveError(n("no such saved stack")):this.stackpointers[i[1]]!=this.stack&&this.directiveError(n("stack mismatch"));break;case"@scope":this.scope=i[1]||"",this.currLineNo=this.scope?0:this.realCurrLineNo;break;case"@nostackcheck":this.checkStack=!1;break;case"@dummystack":o(),this.stack+=this.parseOneInt(i[1]);break;case".section":case".global":this.stackpointers={},this.stack=0,this.scope="$S"+this.scopeId++;break;case".file":case".text":case".cpu":case".fpu":case".eabi_attribute":case".code":case".thumb_func":case".type":case"@":break;default:/^\.cfi_/.test(i[0])||this.directiveError(n("unknown directive"))}},t.prototype.handleOneInstruction=function(e,t){var r=t.emit(e);return!r.error&&(this.stack+=r.stack,this.checkStack&&this.stack<0&&this.pushError(n("stack underflow")),e.location=this.location(),e.opcode=r.opcode,e.stack=r.stack,this.emitOpCode(r.opcode),null!=r.opcode2&&this.emitOpCode(r.opcode2),null!=r.opcode3&&this.emitOpCode(r.opcode3),e.instruction=t,e.numArgs=r.numArgs,!0)},t.prototype.handleInstruction=function(e){var t=this;if(!e.instruction||!this.handleOneInstruction(e,e.instruction)){var r=function(e){return t.ei.instructions.hasOwnProperty(e)?t.ei.instructions[e]:[]};if(!e.instruction)for(var i=r(e.words[0]),o=0;o<i.length;++o)if(this.handleOneInstruction(e,i[o]))return;var a=e.words[0].toLowerCase().replace(/s$/,"").replace(/[^a-z]/g,""),s="",c=r(a).concat(r(a+"s"));c.length>0&&c.forEach(function(t){var r=t.emit(e);s+=n("   Maybe: {0} ({1} at '{2}')\n",t.toString(),r.error,r.errorAt)}),this.pushError(n("assembly error"),s)}},t.prototype.buildLine=function(e,t){var n=this,i=function(e){var r=new l(n,e);return r.scope=n.scope,r.lineNo=n.currLineNo,t.push(r),r},o=i(e),a=r(o.text)||[];o.words=a;var s=a[0]||"";if(":"==s.charAt(s.length-1)){var c=/^([\.\w]+):$/.exec(a[0]);if(c){if(o.type="label",o.text=c[1]+":",o.words=[c[1]],!(a.length>1))return;a.shift(),(o=i(e.replace(/^[^:]*:/,""))).words=a,s=a[0]||""}}var u=s.charAt(0);"."==u||"@"==u?(o.type="directive","@scope"==o.words[0]&&this.handleDirective(o)):0==o.words.length?o.type="empty":o.type="instruction"},t.prototype.prepLines=function(e){var t=this;this.currLineNo=0,this.realCurrLineNo=0,this.lines=[],e.split(/\r?\n/).forEach(function(e){t.errors.length>10||(t.currLineNo++,t.realCurrLineNo++,t.buildLine(e,t.lines))})},t.prototype.iterLines=function(){var t=this;this.stack=0,this.buf=[],this.scopeId=0,this.lines.forEach(function(r){if(!(t.errors.length>10)&&(t.currLine=r,0!=r.words.length))if("label"==r.type){var i=t.scopedName(r.words[0]);if(t.prevLabel=i,t.finalEmit){var o=t.labels[i];null==o&&e.oops(),e.assert(t.errors.length>0||o==t.location()),t.reallyFinalEmit&&(t.stackAtLabel[i]=t.stack)}else t.labels.hasOwnProperty(i)?t.directiveError(n("label redefinition")):t.inlineMode&&/^_/.test(i)?t.directiveError(n("labels starting with '_' are reserved for the compiler")):t.labels[i]=t.location();r.location=t.location()}else"directive"==r.type?t.handleDirective(r):"instruction"==r.type?t.handleInstruction(r):"empty"==r.type||e.oops()})},t.prototype.getSource=function(t,r,i){var o=this;void 0===r&&(r=1),void 0===i&&(i=0);var a=this.buf?this.location():0,s=this.labels._program_end||a,c=this.labels._frag_start||0;c&&(c=this.labels._js_end-c);var l=this.labels._program_end;l&&(l-=this.labels._js_end);var u=a+this.baseOffset;i&&u>i&&e.U.userError(n("program too big by {0} bytes!",u-i));var f=n("; total bytes: {0} ({1}% of {2}k flash with {3} free)",u,(100*u/(i=i||131072)).toFixed(1),(i/1024).toFixed(1),i-u),p=n("; code sizes (bytes): {0} (incl. {1} frags, and {2} lits); src size {3}\n",s,c,l,a-s)+n("; assembly: {0} lines; density: {1} bytes/stmt\n",this.lines.length,Math.round(100*(s-l)/r)/100)+f+"\n"+this.stats+"\n\n",h=!1;return this.lines.forEach(function(e,n){if("_stored_program"==e.words[0])return p+='_stored_program: .string "..."\n',void(h=!0);if(h)h=!1;else{var r=e.text;if(t){if("@stackempty"==e.words[0]&&o.lines[n-1].text==e.text)return;if(!(r=r.replace(/; WAS: .*/,"")).trim())return}o.location()==o.buf.length&&("label"!=e.type&&"instruction"!=e.type||(r+=" \t; 0x"+(e.location+o.baseOffset).toString(16))),p+=r+"\n"}}),p},t.prototype.peepHole=function(){for(var e=this.lines.filter(function(e){return"empty"!=e.type}),t=0;t<e.length;++t){var n=e[t];if(!/^user/.test(n.scope)){var r=e[t+1];if(r){var i=e[t+2];"instruction"==n.type&&this.ei.peephole(n,r,i)}}}},t.prototype.peepPass=function(t){this.disablePeepHole||(this.peepOps=0,this.peepDel=0,this.peepCounts={},this.peepHole(),this.throwOnError=!0,this.finalEmit=!1,this.labels={},this.iterLines(),e.assert(!this.checkStack||0==this.stack),this.finalEmit=!0,this.reallyFinalEmit=t||0==this.peepOps,this.iterLines(),this.stats+=n("; peep hole pass: {0} instructions removed and {1} updated\n",this.peepDel,this.peepOps-this.peepDel))},t.prototype.getLabels=function(){var t=this;return this.userLabelsCache||(this.userLabelsCache=e.U.mapMap(this.labels,function(e,n){return n+t.baseOffset})),this.userLabelsCache},t.prototype.emit=function(t){if(e.assert(null==this.buf),this.prepLines(t),!(this.errors.length>0||(this.labels={},this.iterLines(),this.checkStack&&0!=this.stack&&this.directiveError(n("stack misaligned at the end of the file")),this.errors.length>0||(this.ei.expandLdlit(this),this.ei.commonalize(this),this.labels={},this.iterLines(),this.finalEmit=!0,this.reallyFinalEmit=this.disablePeepHole,this.iterLines(),this.errors.length>0))))for(var r=0;r<5&&(pxt.debug("Peephole OPT, pass "+r),this.peepPass(5==r),0!=this.peepOps);++r);},t}();t.File=u;var f=function(t){function n(e){t.call(this,e)}return __extends(n,t),n.prototype.location=function(){return this.buf.length},n.prototype.emitShort=function(t){e.assert(0<=t&&t<=65535),this.buf.push(255&t),this.buf.push(t>>8)},n.prototype.emitOpCode=function(t){e.assert(0<=t&&t<=255),this.buf.push(t)},n}(u);t.VMFile=f;var p=function(){function t(){var e=this;this.file=null,this.addEnc=function(t,n,r){var i={name:t,pretty:n,encode:r,isRegister:/^\$r\d/.test(t),isImmediate:/^\$i\d/.test(t),isRegList:/^\$rl\d/.test(t),isLabel:/^\$l[a-z]/.test(t)};return e.encoders[t]=i,i},this.inrange=function(e,t,n){return Math.floor(t)!=t?null:t<0?null:t>e?null:n},this.inminmax=function(e,t,n,r){return Math.floor(n)!=n?null:n<e?null:n>t?null:r},this.inseq=function(e,t){var n=e.indexOf(t);return n<0?null:n},this.inrangeSigned=function(e,t,n){return Math.floor(t)!=t?null:t<-(e+1)?null:t>e?null:n&(e<<1|1)},this.addInst=function(t,n,r,i){var o=new c(e,t,n,r,i);return e.instructions.hasOwnProperty(o.name)||(e.instructions[o.name]=[]),e.instructions[o.name].push(o),o},this.encoders={},this.instructions={}}return t.prototype.toFnPtr=function(e,t){return e},t.prototype.wordSize=function(){return-1},t.prototype.computeStackOffset=function(e,t){return t},t.prototype.is32bit=function(e){return!1},t.prototype.emit32=function(e,t,n){return null},t.prototype.postProcessRelAddress=function(e,t){return t},t.prototype.postProcessAbsAddress=function(e,t){return t},t.prototype.peephole=function(e,t,n){},t.prototype.registerNo=function(e){return null},t.prototype.getAddressFromLabel=function(e,t,n,r){return void 0===r&&(r=!1),null},t.prototype.isPop=function(e){return!1},t.prototype.isPush=function(e){return!1},t.prototype.isAddSP=function(e){return!1},t.prototype.isSubSP=function(e){return!1},t.prototype.testAssembler=function(){e.assert(!1)},t.prototype.commonalize=function(e){},t.prototype.expandLdlit=function(e){},t}();t.AbstractProcessor=p,t.emitErr=o,t.expectError=function(t,n){var r=new u(t);r.emit(n),0==r.errors.length&&e.oops("ASMTEST: expecting error for: "+n)},t.tohex=a,t.expect=function(t,n){var r=[],i=n.replace(/^([0-9a-fA-F]{4,8})\s/gm,function(e,t){return r.push(parseInt(t.slice(0,4),16)),8==t.length&&r.push(parseInt(t.slice(4,8),16)),""}),o=new u(t);o.throwOnError=!0,o.disablePeepHole=!0,o.emit(i),o.errors.length>0&&(console.debug(o.errors[0].message),e.oops("ASMTEST: not expecting errors")),o.buf.length!=r.length&&e.oops("ASMTEST: wrong buf len");for(var s=0;s<r.length;++s)o.buf[s]!=r[s]&&e.oops("ASMTEST: wrong buf content at "+s+" , exp:"+a(r[s])+", got: "+a(o.buf[s]))}}(e.assembler||(e.assembler={}))}(e.pxtc||(e.pxtc={}))}(ts||(ts={}));var pxt;!function(e){!function(t){function n(e){var t=new Error(a.lf("Cannot access {0} while offline",e));return t.isOffline=!0,Promise.delay(1e3).then(function(){return Promise.reject(t)})}function r(e){return e.url=t.apiRoot+e.url,e.allowGzipPost=!0,t.isOnline()?(t.accessToken&&(e.headers||(e.headers={}),e.headers["x-td-access-token"]=t.accessToken),a.requestAsync(e).catch(function(r){return 0==r.statusCode?(s&&(s=!1,t.onOffline()),n(e.url)):Promise.reject(r)})):n(e.url)}function i(e){return r({url:e}).then(function(e){return e.text})}function o(){return navigator&&navigator.onLine}var a=pxtc.Util;t.apiRoot="https://makecode.com/api/",t.accessToken="",t.localToken="";var s=!0;t.onOffline=function(){},t.hasAccessToken=function(){return!!t.accessToken},t.isLocalHost=function(){try{return/^http:\/\/(localhost|127\.0\.0\.1):\d+\//.test(window.location.href)&&!/nolocalhost=1/.test(window.location.href)&&!e.webConfig.isStatic}catch(e){return!1}},t.privateRequestAsync=r,t.privateGetTextAsync=i,t.privateGetAsync=function(e){return r({url:e}).then(function(e){return e.json})},t.downloadTargetConfigAsync=function(){if(!t.isOnline())return Promise.resolve(void 0);var n="config/"+e.appTarget.id+"/targetconfig";return t.isLocalHost()?a.requestAsync({url:"/api/"+n,headers:{Authorization:t.localToken},method:"GET",allowHttpErrors:!0}).then(function(e){return e.json}):t.privateGetAsync(n)},t.downloadScriptFilesAsync=function(e){return r({url:e+"/text"}).then(function(e){return JSON.parse(e.text)})},t.downloadMarkdownAsync=function(n,r,o){n=n.replace(/^\//,"");var s="md/"+e.appTarget.id+"/"+n+"?targetVersion="+encodeURIComponent(e.webConfig.targetVersion);return"en"!=r&&(s+="&lang="+encodeURIComponent(a.userLanguage()),o&&(s+="&live=1")),t.isLocalHost()&&!o?a.requestAsync({url:"/api/"+s,headers:{Authorization:t.localToken},method:"GET",allowHttpErrors:!0}).then(function(e){return 404==e.statusCode?i(s):e.text}):i(s)},t.privateDeleteAsync=function(e){return r({url:e,method:"DELETE"}).then(function(e){return e.json})},t.privatePostAsync=function(e,t){return r({url:e,data:t||{}}).then(function(e){return e.json})},t.isLoggedIn=function(){return!!t.accessToken},t.isNavigatorOnline=o,t.isOnline=function(){return"undefined"!=typeof navigator&&o()&&(s=!0),s},t.getServiceUrl=function(){return t.apiRoot.replace(/\/api\/$/,"")},t.getUserId=function(){var e=/^0(\w+)\./.exec(t.accessToken);return e?e[1]:null},t.parseScriptId=function(t){var n=e.appTarget;if(t&&n.appTheme&&n.cloud&&n.cloud.sharing){var r=["makecode.com"];n.appTheme.embedUrl&&r.push(n.appTheme.embedUrl),n.appTheme.shareUrl&&r.push(n.appTheme.shareUrl),n.appTheme.legacyDomain&&r.push(n.appTheme.legacyDomain);var i="^((https://)?(?:"+(r=a.unique(r,function(e){return e}).map(function(e){return a.escapeForRegex(a.stripUrlProtocol(e).replace(/\/$/,"")).toLowerCase()})).join("|")+")/)?(api/oembed?url=.*%2F([^&]*)&.*?|([a-z0-9-_]+))$",o=new RegExp(i,"i").exec(t.trim());return o&&(!o[1]||r.indexOf(a.escapeForRegex(o[1].replace(/https:\/\//,"").replace(/\/$/,"")).toLowerCase())>=0)&&(o[3]||o[4])?o[3]?o[3]:o[4]:null}}}(e.Cloud||(e.Cloud={}))}(pxt||(pxt={}));