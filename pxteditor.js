var pxt;!function(e){!function(e){!function(e){e[e.Hidden=0]="Hidden",e[e.Visible=1]="Visible",e[e.Disabled=2]="Disabled"}(e.FilterState||(e.FilterState={}));e.FilterState}(e.editor||(e.editor={}))}(pxt||(pxt={}));var pxt;!function(e){!function(t){function o(e,t,o,r){e.response&&window.parent.postMessage({type:e.type,id:e.id,resp:t,success:o,error:r},"*")}function r(t){return new Promise(function(o,r){var a=e.Util.clone(t);a.id=e.Util.guidGen(),t.response&&(n[a.id]={resolve:o,reject:r}),window.parent.postMessage(a,"*"),t.response||o(void 0)})}var n={};t.bindEditorMessages=function(t){var r=e.appTarget.appTheme.allowParentController&&e.BrowserUtils.isIFrame(),a=e.appTarget.appTheme.allowPackageExtensions,s=e.appTarget.appTheme.allowSimulatorTelemetry;(r||a||s)&&window.addEventListener("message",function(i){var c=i.data;if(!c||!/^pxt(host|editor|pkgext|sim)$/.test(c.type))return!1;if("pxtpkgext"===c.type&&a)t.handleExtensionRequest(c);else if("pxtsim"===c.type&&s){var l=c;"event"===l.action&&(l.category||l.message?e.reportError(l.category,l.message,l.data):e.tickEvent(l.tick,l.data))}else if(r){var p=Promise.resolve(),u=void 0;if("pxthost"==c.type){var d=n[c.id];d?p=p.then(function(){return d.resolve(c)}):e.debug("pxthost: unknown request "+c.id)}else if("pxteditor"==c.type){var f=c;switch(e.debug("pxteditor: "+f.action),f.action.toLowerCase()){case"switchjavascript":p=p.then(function(){return t.openJavaScript()});break;case"switchblocks":p=p.then(function(){return t.openBlocks()});break;case"startsimulator":p=p.then(function(){return t.startSimulator()});break;case"restartsimulator":p=p.then(function(){return t.restartSimulator()});break;case"hidesimulator":p=p.then(function(){return t.collapseSimulator()});break;case"showsimulator":p=p.then(function(){return t.expandSimulator()});break;case"closeflyout":p=p.then(function(){return t.closeFlyout()});break;case"redo":p=p.then(function(){var e=t.editor;e&&e.hasRedo()&&e.redo()});break;case"undo":p=p.then(function(){var e=t.editor;e&&e.hasUndo()&&e.undo()});break;case"stopsimulator":var m=c;p=p.then(function(){return t.stopSimulator(m.unload)});break;case"newproject":var g=c;p=p.then(function(){return t.newProject(g.options)});break;case"importproject":var b=c;p=p.then(function(){return t.importProjectAsync(b.project,{filters:b.filters,searchBar:b.searchBar})});break;case"proxytosim":var y=c;p=p.then(function(){return t.proxySimulatorMessage(y.content)});break;case"renderblocks":var h=c;p=p.then(function(){return t.renderBlocksAsync(h)}).then(function(e){u=e});break;case"toggletrace":var v=c;p=p.then(function(){return t.toggleTrace(v.intervalSpeed)})}}p.done(function(){return o(c,u,!0,void 0)},function(e){return o(c,u,!1,e)})}return!0},!1)},t.enableControllerAnalytics=function(){if(e.appTarget.appTheme.allowParentController&&e.BrowserUtils.isIFrame()){var t=e.tickEvent;e.tickEvent=function(e,o){t&&t(e,o),r({type:"pxthost",action:"event",tick:e,response:!1,data:o})};var o=e.reportException;e.reportException=function(e,t){o&&o(e,t);try{r({type:"pxthost",action:"event",tick:"error",message:e.message,response:!1,data:t})}catch(e){}};var n=e.reportError;e.reportError=function(e,t,o){n&&n(e,t,o),r({type:"pxthost",action:"event",tick:"error",category:e,message:t,data:o})}}},t.postHostMessageAsync=r}(e.editor||(e.editor={}))}(pxt||(pxt={}));var pxt;!function(e){!function(e){!function(e){e[e.Granted=0]="Granted",e[e.Denied=1]="Denied",e[e.NotAvailable=2]="NotAvailable"}(e.PermissionResponses||(e.PermissionResponses={}));e.PermissionResponses}(e.editor||(e.editor={}))}(pxt||(pxt={}));var pxt;!function(e){!function(t){function o(){return e.appTarget?e.appTarget.id:window.pxtConfig?window.pxtConfig.targetId:""}function r(){if(!s){var t=o(),r=!1;if(!e.shell.isSandboxMode())try{window.localStorage[t]="1";window.localStorage[t];r=!0}catch(e){}r?(s=new a(t),e.debug("storage: local under "+t)):(s=new n,e.debug("storage: in memory"))}}var n=function(){function e(){this.items={}}return e.prototype.removeItem=function(e){delete this.items[e]},e.prototype.getItem=function(e){return this.items[e]},e.prototype.setItem=function(e,t){this.items[e]=t},e.prototype.clear=function(){this.items={}},e}(),a=function(){function e(e){this.storageId=e}return e.prototype.targetKey=function(e){return this.storageId+"/"+e},e.prototype.removeItem=function(e){window.localStorage.removeItem(this.targetKey(e))},e.prototype.getItem=function(e){return window.localStorage[this.targetKey(e)]},e.prototype.setItem=function(e,t){window.localStorage[this.targetKey(e)]=t},e.prototype.clear=function(){for(var e=this.targetKey(""),t=[],o=0;o<window.localStorage.length;++o){var r=window.localStorage.key(o);0==r.indexOf(e)&&t.push(r)}t.forEach(function(e){return window.localStorage.removeItem(e)})},e}();t.storageId=o;var s;t.setLocal=function(e,t){r(),s.setItem(e,t)},t.getLocal=function(e){return r(),s.getItem(e)},t.removeLocal=function(e){r(),s.removeItem(e)},t.clearLocal=function(){r(),s.clear()}}(e.storage||(e.storage={}))}(pxt||(pxt={}));var pxt;!function(e){!function(t){function o(){monaco.languages.typescript&&(n(),monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSyntaxValidation:!0,noSemanticValidation:!0}),monaco.languages.typescript.typescriptDefaults.setCompilerOptions({allowUnreachableCode:!0,noImplicitAny:!0,allowJs:!1,allowUnusedLabels:!0,target:monaco.languages.typescript.ScriptTarget.ES5,outDir:"built",rootDir:".",noLib:!0,mouseWheelZoom:!0}),monaco.languages.typescript.typescriptDefaults.setMaximunWorkerIdleTime(12e5))}function r(t){var o=e.appTarget.appTheme.invertedMonaco,r=monaco.editor.create(t,{model:null,ariaLabel:e.Util.lf("JavaScript editor"),fontFamily:"'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', 'monospace'",scrollBeyondLastLine:!1,language:"typescript",mouseWheelZoom:!0,wordBasedSuggestions:!0,lineNumbersMinChars:3,formatOnPaste:!0,minimap:{enabled:!1},autoIndent:!0,dragAndDrop:!0,matchBrackets:!0,occurrencesHighlight:!1,mouseWheelScrollSensitivity:.5,quickSuggestionsDelay:200,theme:o?"vs-dark":"vs",accessibilityHelpUrl:""});return r.layout(),r}function n(){monaco.languages.register({id:"asm",extensions:[".asm"]}),monaco.languages.setMonarchTokensProvider("asm",{tokenPostfix:"",keywords:["movs","mov","adds","add","adcs","adr","subs","sbcs","sub","rsbs","muls","cmp","cmn","ands","eors","orrs","bics","mvns","tst","lsls","lsrs","asrs","rors","ldr","ldrh","ldrb","ldrsh","ldrsb","ldm","str","strh","strb","stm","push","pop","cbz","cbnz","b","bl","bx","blx","sxth","sxtb","uxth","uxtb","rev","rev16","revsh","svc","cpsid","cpsie","setend","bkpt","nop","sev","wfe","wfi","yield","beq","bne","bcs","bhs","bcc","blo","bmi","bpl","bvs","bvc","bhi","bls","bge","blt","bgt","ble","bal","r0","r1","r2","r3","r4","r5","r6","r7","r8","r9","r10","r11","r12","r13","r14","r15","pc","sp","lr"],typeKeywords:[".startaddr",".hex",".short",".space",".section",".string",".byte"],operators:[],symbols:/[:\*]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,tokenizer:{root:[[/(\.)?[a-z_$\.][\w$]*/,{cases:{"@typeKeywords":"keyword","@keywords":"keyword","@default":"identifier"}}],{include:"@whitespace"},[/[{}()\[\]]/,"@brackets"],[/[<>](?!@symbols)/,"@brackets"],[/@symbols/,{cases:{"@operators":"operator","@default":""}}],[/@\s*[a-zA-Z_\$][\w\$]*/,{token:"annotation"}],[/(#|(0[xX]))?[0-9a-fA-F]+/,"number"],[/[;,.]/,"delimiter"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/"/,{token:"string.quote",bracket:"@open",next:"@string"}],[/'[^\\']'/,"string"],[/(')(@escapes)(')/,["string","string.escape","string"]],[/'/,"string.invalid"]],comment:[],string:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,{token:"string.quote",bracket:"@close",next:"@pop"}]],whitespace:[[/[ \t\r\n]+/,"white"],[/\/\*/,"comment","@comment"],[/;.*$/,"comment"]]}})}t.syncModels=function(e,t,o,r){if(!r){var n=monaco.languages.typescript.typescriptDefaults.getExtraLibs(),a={};e.sortedDeps().forEach(function(e){e.getFiles().forEach(function(r){var n=e.id+"/"+r;if(/\.(ts)$/.test(r)&&n!=o){if(!monaco.languages.typescript.typescriptDefaults.getExtraLibs()[n]){var s=e.readFile(r)||" ";t[n]=monaco.languages.typescript.typescriptDefaults.addExtraLib(s,n)}a[n]="1"}})}),Object.keys(n).filter(function(e){return/\.(ts)$/.test(e)&&!a[e]}).forEach(function(e){t[e].dispose()})}},t.initMonacoAsync=function(e){return new Promise(function(t,n){if("object"!=typeof window.monaco){var a=window.MonacoPaths,s=function(){var n=window.require;n.config({paths:a}),n(["vs/editor/editor.main"],function(){o(),t(r(e))})};if(window.require)s();else{var i=document.createElement("script");i.type="text/javascript",i.src=a["vs/loader"],i.addEventListener("load",s),document.body.appendChild(i)}}else t(r(e))})},t.createEditor=r}(e.vs||(e.vs={}))}(pxt||(pxt={}));var pxt;!function(e){!function(t){function o(){if(void 0===a){var t=/sandbox=1|#sandbox|#sandboxproject/i.test(window.location.href)||e.BrowserUtils.isIFrame(),o=/nosandbox=1/i.test(window.location.href),r=/editorlayout=(widget|sandbox|ide)/i.exec(window.location.href);if(a=s.IDE,o?a=s.Widget:t&&(a=s.Sandbox),r)switch(r[1].toLowerCase()){case"widget":a=s.Widget;break;case"sandbox":a=s.Sandbox;break;case"ide":a=s.IDE}e.debug("shell: layout type "+s[a]+", readonly "+n())}}function r(){return o(),a==s.Sandbox}function n(){return r()&&!/[?&]edit=1/i.test(window.location.href)}!function(e){e[e.IDE=0]="IDE",e[e.Sandbox=1]="Sandbox",e[e.Widget=2]="Widget"}(t.EditorLayoutType||(t.EditorLayoutType={}));var a,s=t.EditorLayoutType;t.layoutTypeClass=function(){return o(),e.shell.EditorLayoutType[a].toLowerCase()},t.isSandboxMode=r,t.isReadOnly=n}(e.shell||(e.shell={}))}(pxt||(pxt={}));